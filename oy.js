//OYSTER DEPENDENCY HACKTIMER
//https://github.com/turuslan/HackTimer
(function(s){var w,f={},o=window,l=console,m=Math,z='postMessage',x='',v='Initialisation failed',p=0,r='hasOwnProperty',y=[].slice,b=o.Worker;function d(){do{p=0x7FFFFFFF>p?p+1:0}while(f[r](p));return p}if(!/MSIE 10/i.test(navigator.userAgent)){try{s=o.URL.createObjectURL(new Blob(["var f={},p=postMessage,r='hasOwnProperty';onmessage=function(e){var d=e.data,i=d.i,t=d[r]('t')?d.t:0;switch(d.n){case'a':f[i]=setInterval(function(){p(i)},t);break;case'b':if(f[r](i)){clearInterval(f[i]);delete f[i]}break;case'c':f[i]=setTimeout(function(){p(i);if(f[r](i))delete f[i]},t);break;case'd':if(f[r](i)){clearTimeout(f[i]);delete f[i]}break}}"]))}catch(e){}}if(typeof(b)!=='undefined'){try{w=new b(s);o.setInterval=function(c,t){var i=d();f[i]={c:c,p:y.call(arguments,2)};w[z]({n:'a',i:i,t:t});return i};o.clearInterval=function(i){if(f[r](i))delete f[i],w[z]({n:'b',i:i})};o.setTimeout=function(c,t){var i=d();f[i]={c:c,p:y.call(arguments,2),t:!0};w[z]({n:'c',i:i,t:t});return i};o.clearTimeout=function(i){if(f[r](i))delete f[i],w[z]({n:'d',i:i})};w.onmessage=function(e){var i=e.data,c,n;if(f[r](i)){n=f[i];c=n.c;if(n[r]('t'))delete f[i]}if(typeof(c)=='string')try{c=new Function(c)}catch(k){l.log(x+'Error parsing callback code string: ',k)}if(typeof(c)=='function')c.apply(o,n.p)};w.onerror=function(e){l.log(e)};}catch(e){l.log(x+v);l.error(e)}}else l.log(x+v+' - HTML5 Web Worker is not supported')})('HackTimerWorker.min.js');

//OYSTER DEPENDENCY SHA1
/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
    n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;a=a.sigBytes;this.clamp();if(d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-8*(b%4)&255)<<24-8*((d+b)%4);else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
            32-8*(c%4);a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-8*(d%4)&255;b.push((f>>>4).toString(16));b.push((f&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,
            2),16)<<24-4*(d%8);return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-8*(d%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(a.charCodeAt(d)&255)<<24-8*(d%4);return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},
    k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h=a?e.ceil(h):e.max((h|0)-this._minBufferSize,0);a=h*f;d=e.min(4*a,d);if(a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a);c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);
            a._data=this._data.clone();return a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){k.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return(new a.init(b)).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return(new s.HMAC.init(a,
        f)).finalize(b)}}});var s=p.algo={};return p}(Math);
(function(){var e=CryptoJS,m=e.lib,p=m.WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=f[n+a]|0;else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a];c=20>a?c+((g&e|~g&k)+1518500249):40>a?c+((g^e^k)+1859775393):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^
        k)-899497514);j=k;k=e;e=g<<30|g>>>2;g=h;h=c}b[0]=b[0]+h|0;b[1]=b[1]+g|0;b[2]=b[2]+e|0;b[3]=b[3]+k|0;b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;e[h>>>5]|=128<<24-h%32;e[(h+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(h+64>>>9<<4)+15]=b;f.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=j.clone.call(this);e._hash=this._hash.clone();return e}});e.SHA1=j._createHelper(m);e.HmacSHA1=j._createHmacHelper(m)})();

//OYSTER DEPENDENCY AES
/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(u,p){var d={},l=d.lib={},s=function(){},t=l.Base={extend:function(a){s.prototype=this;var c=new s;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
    r=l.WordArray=t.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=p?c:4*a.length},toString:function(a){return(a||v).stringify(this)},concat:function(a){var c=this.words,e=a.words,j=this.sigBytes;a=a.sigBytes;this.clamp();if(j%4)for(var k=0;k<a;k++)c[j+k>>>2]|=(e[k>>>2]>>>24-8*(k%4)&255)<<24-8*((j+k)%4);else if(65535<e.length)for(k=0;k<a;k+=4)c[j+k>>>2]=e[k>>>2];else c.push.apply(c,e);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
            32-8*(c%4);a.length=u.ceil(c/4)},clone:function(){var a=t.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],e=0;e<a;e+=4)c.push(4294967296*u.random()|0);return new r.init(c,a)}}),w=d.enc={},v=w.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++){var k=c[j>>>2]>>>24-8*(j%4)&255;e.push((k>>>4).toString(16));e.push((k&15).toString(16))}return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j+=2)e[j>>>3]|=parseInt(a.substr(j,
            2),16)<<24-4*(j%8);return new r.init(e,c/2)}},b=w.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var e=[],j=0;j<a;j++)e.push(String.fromCharCode(c[j>>>2]>>>24-8*(j%4)&255));return e.join("")},parse:function(a){for(var c=a.length,e=[],j=0;j<c;j++)e[j>>>2]|=(a.charCodeAt(j)&255)<<24-8*(j%4);return new r.init(e,c)}},x=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(b.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return b.parse(unescape(encodeURIComponent(a)))}},
    q=l.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=x.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,e=c.words,j=c.sigBytes,k=this.blockSize,b=j/(4*k),b=a?u.ceil(b):u.max((b|0)-this._minBufferSize,0);a=b*k;j=u.min(4*a,j);if(a){for(var q=0;q<a;q+=k)this._doProcessBlock(e,q);q=e.splice(0,a);c.sigBytes-=j}return new r.init(q,j)},clone:function(){var a=t.clone.call(this);
            a._data=this._data.clone();return a},_minBufferSize:0});l.Hasher=q.extend({cfg:t.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){q.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,e){return(new a.init(e)).finalize(b)}},_createHmacHelper:function(a){return function(b,e){return(new n.HMAC.init(a,
        e)).finalize(b)}}});var n=d.algo={};return d}(Math);
(function(){var u=CryptoJS,p=u.lib.WordArray;u.enc.Base64={stringify:function(d){var l=d.words,p=d.sigBytes,t=this._map;d.clamp();d=[];for(var r=0;r<p;r+=3)for(var w=(l[r>>>2]>>>24-8*(r%4)&255)<<16|(l[r+1>>>2]>>>24-8*((r+1)%4)&255)<<8|l[r+2>>>2]>>>24-8*((r+2)%4)&255,v=0;4>v&&r+0.75*v<p;v++)d.push(t.charAt(w>>>6*(3-v)&63));if(l=t.charAt(64))for(;d.length%4;)d.push(l);return d.join("")},parse:function(d){var l=d.length,s=this._map,t=s.charAt(64);t&&(t=d.indexOf(t),-1!=t&&(l=t));for(var t=[],r=0,w=0;w<
    l;w++)if(w%4){var v=s.indexOf(d.charAt(w-1))<<2*(w%4),b=s.indexOf(d.charAt(w))>>>6-2*(w%4);t[r>>>2]|=(v|b)<<24-8*(r%4);r++}return p.create(t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();
(function(u){function p(b,n,a,c,e,j,k){b=b+(n&a|~n&c)+e+k;return(b<<j|b>>>32-j)+n}function d(b,n,a,c,e,j,k){b=b+(n&c|a&~c)+e+k;return(b<<j|b>>>32-j)+n}function l(b,n,a,c,e,j,k){b=b+(n^a^c)+e+k;return(b<<j|b>>>32-j)+n}function s(b,n,a,c,e,j,k){b=b+(a^(n|~c))+e+k;return(b<<j|b>>>32-j)+n}for(var t=CryptoJS,r=t.lib,w=r.WordArray,v=r.Hasher,r=t.algo,b=[],x=0;64>x;x++)b[x]=4294967296*u.abs(u.sin(x+1))|0;r=r.MD5=v.extend({_doReset:function(){this._hash=new w.init([1732584193,4023233417,2562383102,271733878])},
    _doProcessBlock:function(q,n){for(var a=0;16>a;a++){var c=n+a,e=q[c];q[c]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360}var a=this._hash.words,c=q[n+0],e=q[n+1],j=q[n+2],k=q[n+3],z=q[n+4],r=q[n+5],t=q[n+6],w=q[n+7],v=q[n+8],A=q[n+9],B=q[n+10],C=q[n+11],u=q[n+12],D=q[n+13],E=q[n+14],x=q[n+15],f=a[0],m=a[1],g=a[2],h=a[3],f=p(f,m,g,h,c,7,b[0]),h=p(h,f,m,g,e,12,b[1]),g=p(g,h,f,m,j,17,b[2]),m=p(m,g,h,f,k,22,b[3]),f=p(f,m,g,h,z,7,b[4]),h=p(h,f,m,g,r,12,b[5]),g=p(g,h,f,m,t,17,b[6]),m=p(m,g,h,f,w,22,b[7]),
        f=p(f,m,g,h,v,7,b[8]),h=p(h,f,m,g,A,12,b[9]),g=p(g,h,f,m,B,17,b[10]),m=p(m,g,h,f,C,22,b[11]),f=p(f,m,g,h,u,7,b[12]),h=p(h,f,m,g,D,12,b[13]),g=p(g,h,f,m,E,17,b[14]),m=p(m,g,h,f,x,22,b[15]),f=d(f,m,g,h,e,5,b[16]),h=d(h,f,m,g,t,9,b[17]),g=d(g,h,f,m,C,14,b[18]),m=d(m,g,h,f,c,20,b[19]),f=d(f,m,g,h,r,5,b[20]),h=d(h,f,m,g,B,9,b[21]),g=d(g,h,f,m,x,14,b[22]),m=d(m,g,h,f,z,20,b[23]),f=d(f,m,g,h,A,5,b[24]),h=d(h,f,m,g,E,9,b[25]),g=d(g,h,f,m,k,14,b[26]),m=d(m,g,h,f,v,20,b[27]),f=d(f,m,g,h,D,5,b[28]),h=d(h,f,
            m,g,j,9,b[29]),g=d(g,h,f,m,w,14,b[30]),m=d(m,g,h,f,u,20,b[31]),f=l(f,m,g,h,r,4,b[32]),h=l(h,f,m,g,v,11,b[33]),g=l(g,h,f,m,C,16,b[34]),m=l(m,g,h,f,E,23,b[35]),f=l(f,m,g,h,e,4,b[36]),h=l(h,f,m,g,z,11,b[37]),g=l(g,h,f,m,w,16,b[38]),m=l(m,g,h,f,B,23,b[39]),f=l(f,m,g,h,D,4,b[40]),h=l(h,f,m,g,c,11,b[41]),g=l(g,h,f,m,k,16,b[42]),m=l(m,g,h,f,t,23,b[43]),f=l(f,m,g,h,A,4,b[44]),h=l(h,f,m,g,u,11,b[45]),g=l(g,h,f,m,x,16,b[46]),m=l(m,g,h,f,j,23,b[47]),f=s(f,m,g,h,c,6,b[48]),h=s(h,f,m,g,w,10,b[49]),g=s(g,h,f,m,
            E,15,b[50]),m=s(m,g,h,f,r,21,b[51]),f=s(f,m,g,h,u,6,b[52]),h=s(h,f,m,g,k,10,b[53]),g=s(g,h,f,m,B,15,b[54]),m=s(m,g,h,f,e,21,b[55]),f=s(f,m,g,h,v,6,b[56]),h=s(h,f,m,g,x,10,b[57]),g=s(g,h,f,m,t,15,b[58]),m=s(m,g,h,f,D,21,b[59]),f=s(f,m,g,h,z,6,b[60]),h=s(h,f,m,g,C,10,b[61]),g=s(g,h,f,m,j,15,b[62]),m=s(m,g,h,f,A,21,b[63]);a[0]=a[0]+f|0;a[1]=a[1]+m|0;a[2]=a[2]+g|0;a[3]=a[3]+h|0},_doFinalize:function(){var b=this._data,n=b.words,a=8*this._nDataBytes,c=8*b.sigBytes;n[c>>>5]|=128<<24-c%32;var e=u.floor(a/
        4294967296);n[(c+64>>>9<<4)+15]=(e<<8|e>>>24)&16711935|(e<<24|e>>>8)&4278255360;n[(c+64>>>9<<4)+14]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;b.sigBytes=4*(n.length+1);this._process();b=this._hash;n=b.words;for(a=0;4>a;a++)c=n[a],n[a]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360;return b},clone:function(){var b=v.clone.call(this);b._hash=this._hash.clone();return b}});t.MD5=v._createHelper(r);t.HmacMD5=v._createHmacHelper(r)})(Math);
(function(){var u=CryptoJS,p=u.lib,d=p.Base,l=p.WordArray,p=u.algo,s=p.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:p.MD5,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,r){for(var p=this.cfg,s=p.hasher.create(),b=l.create(),u=b.words,q=p.keySize,p=p.iterations;u.length<q;){n&&s.update(n);var n=s.update(d).finalize(r);s.reset();for(var a=1;a<p;a++)n=s.finalize(n),s.reset();b.concat(n)}b.sigBytes=4*q;return b}});u.EvpKDF=function(d,l,p){return s.create(p).compute(d,
    l)}})();
CryptoJS.lib.Cipher||function(u){var p=CryptoJS,d=p.lib,l=d.Base,s=d.WordArray,t=d.BufferedBlockAlgorithm,r=p.enc.Base64,w=p.algo.EvpKDF,v=d.Cipher=t.extend({cfg:l.extend(),createEncryptor:function(e,a){return this.create(this._ENC_XFORM_MODE,e,a)},createDecryptor:function(e,a){return this.create(this._DEC_XFORM_MODE,e,a)},init:function(e,a,b){this.cfg=this.cfg.extend(b);this._xformMode=e;this._key=a;this.reset()},reset:function(){t.reset.call(this);this._doReset()},process:function(e){this._append(e);return this._process()},
    finalize:function(e){e&&this._append(e);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(b,k,d){return("string"==typeof k?c:a).encrypt(e,b,k,d)},decrypt:function(b,k,d){return("string"==typeof k?c:a).decrypt(e,b,k,d)}}}});d.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var b=p.mode={},x=function(e,a,b){var c=this._iv;c?this._iv=u:c=this._prevBlock;for(var d=0;d<b;d++)e[a+d]^=
    c[d]},q=(d.BlockCipherMode=l.extend({createEncryptor:function(e,a){return this.Encryptor.create(e,a)},createDecryptor:function(e,a){return this.Decryptor.create(e,a)},init:function(e,a){this._cipher=e;this._iv=a}})).extend();q.Encryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize;x.call(this,e,a,c);b.encryptBlock(e,a);this._prevBlock=e.slice(a,a+c)}});q.Decryptor=q.extend({processBlock:function(e,a){var b=this._cipher,c=b.blockSize,d=e.slice(a,a+c);b.decryptBlock(e,a);x.call(this,
        e,a,c);this._prevBlock=d}});b=b.CBC=q;q=(p.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,l=[],n=0;n<c;n+=4)l.push(d);c=s.create(l,c);a.concat(c)},unpad:function(a){a.sigBytes-=a.words[a.sigBytes-1>>>2]&255}};d.BlockCipher=v.extend({cfg:v.cfg.extend({mode:b,padding:q}),reset:function(){v.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,
        this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var n=d.CipherParams=l.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),b=(p.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;a=a.salt;return(a?s.create([1398893684,
        1701076831]).concat(a).concat(b):b).toString(r)},parse:function(a){a=r.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=s.create(b.slice(2,4));b.splice(0,4);a.sigBytes-=16}return n.create({ciphertext:a,salt:c})}},a=d.SerializableCipher=l.extend({cfg:l.extend({format:b}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var l=a.createEncryptor(c,d);b=l.finalize(b);l=l.cfg;return n.create({ciphertext:b,key:c,iv:l.iv,algorithm:a,mode:l.mode,padding:l.padding,blockSize:a.blockSize,formatter:d.format})},
    decrypt:function(a,b,c,d){d=this.cfg.extend(d);b=this._parse(b,d.format);return a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),p=(p.kdf={}).OpenSSL={execute:function(a,b,c,d){d||(d=s.random(8));a=w.create({keySize:b+c}).compute(a,d);c=s.create(a.words.slice(b),4*c);a.sigBytes=4*b;return n.create({key:a,iv:c,salt:d})}},c=d.PasswordBasedCipher=a.extend({cfg:a.cfg.extend({kdf:p}),encrypt:function(b,c,d,l){l=this.cfg.extend(l);d=l.kdf.execute(d,
        b.keySize,b.ivSize);l.iv=d.iv;b=a.encrypt.call(this,b,c,d.key,l);b.mixIn(d);return b},decrypt:function(b,c,d,l){l=this.cfg.extend(l);c=this._parse(c,l.format);d=l.kdf.execute(d,b.keySize,b.ivSize,c.salt);l.iv=d.iv;return a.decrypt.call(this,b,c,d.key,l)}})}();
(function(){for(var u=CryptoJS,p=u.lib.BlockCipher,d=u.algo,l=[],s=[],t=[],r=[],w=[],v=[],b=[],x=[],q=[],n=[],a=[],c=0;256>c;c++)a[c]=128>c?c<<1:c<<1^283;for(var e=0,j=0,c=0;256>c;c++){var k=j^j<<1^j<<2^j<<3^j<<4,k=k>>>8^k&255^99;l[e]=k;s[k]=e;var z=a[e],F=a[z],G=a[F],y=257*a[k]^16843008*k;t[e]=y<<24|y>>>8;r[e]=y<<16|y>>>16;w[e]=y<<8|y>>>24;v[e]=y;y=16843009*G^65537*F^257*z^16843008*e;b[k]=y<<24|y>>>8;x[k]=y<<16|y>>>16;q[k]=y<<8|y>>>24;n[k]=y;e?(e=z^a[a[a[G^z]]],j^=a[a[j]]):e=j=1}var H=[0,1,2,4,8,
    16,32,64,128,27,54],d=d.AES=p.extend({_doReset:function(){for(var a=this._key,c=a.words,d=a.sigBytes/4,a=4*((this._nRounds=d+6)+1),e=this._keySchedule=[],j=0;j<a;j++)if(j<d)e[j]=c[j];else{var k=e[j-1];j%d?6<d&&4==j%d&&(k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255]):(k=k<<8|k>>>24,k=l[k>>>24]<<24|l[k>>>16&255]<<16|l[k>>>8&255]<<8|l[k&255],k^=H[j/d|0]<<24);e[j]=e[j-d]^k}c=this._invKeySchedule=[];for(d=0;d<a;d++)j=a-d,k=d%4?e[j]:e[j-4],c[d]=4>d||4>=j?k:b[l[k>>>24]]^x[l[k>>>16&255]]^q[l[k>>>
    8&255]]^n[l[k&255]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,t,r,w,v,l)},decryptBlock:function(a,c){var d=a[c+1];a[c+1]=a[c+3];a[c+3]=d;this._doCryptBlock(a,c,this._invKeySchedule,b,x,q,n,s);d=a[c+1];a[c+1]=a[c+3];a[c+3]=d},_doCryptBlock:function(a,b,c,d,e,j,l,f){for(var m=this._nRounds,g=a[b]^c[0],h=a[b+1]^c[1],k=a[b+2]^c[2],n=a[b+3]^c[3],p=4,r=1;r<m;r++)var q=d[g>>>24]^e[h>>>16&255]^j[k>>>8&255]^l[n&255]^c[p++],s=d[h>>>24]^e[k>>>16&255]^j[n>>>8&255]^l[g&255]^c[p++],t=
        d[k>>>24]^e[n>>>16&255]^j[g>>>8&255]^l[h&255]^c[p++],n=d[n>>>24]^e[g>>>16&255]^j[h>>>8&255]^l[k&255]^c[p++],g=q,h=s,k=t;q=(f[g>>>24]<<24|f[h>>>16&255]<<16|f[k>>>8&255]<<8|f[n&255])^c[p++];s=(f[h>>>24]<<24|f[k>>>16&255]<<16|f[n>>>8&255]<<8|f[g&255])^c[p++];t=(f[k>>>24]<<24|f[n>>>16&255]<<16|f[g>>>8&255]<<8|f[h&255])^c[p++];n=(f[n>>>24]<<24|f[g>>>16&255]<<16|f[h>>>8&255]<<8|f[k&255])^c[p++];a[b]=q;a[b+1]=s;a[b+2]=t;a[b+3]=n},keySize:8});u.AES=p._createHelper(d)})();

//OYSTER DEPENDENCY PBKDF2
/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/
var CryptoJS=CryptoJS||function(g,j){var e={},d=e.lib={},m=function(){},n=d.Base={extend:function(a){m.prototype=this;var c=new m;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},
    q=d.WordArray=n.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=j?c:4*a.length},toString:function(a){return(a||l).stringify(this)},concat:function(a){var c=this.words,p=a.words,f=this.sigBytes;a=a.sigBytes;this.clamp();if(f%4)for(var b=0;b<a;b++)c[f+b>>>2]|=(p[b>>>2]>>>24-8*(b%4)&255)<<24-8*((f+b)%4);else if(65535<p.length)for(b=0;b<a;b+=4)c[f+b>>>2]=p[b>>>2];else c.push.apply(c,p);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<
            32-8*(c%4);a.length=g.ceil(c/4)},clone:function(){var a=n.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*g.random()|0);return new q.init(c,a)}}),b=e.enc={},l=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],f=0;f<a;f++){var d=c[f>>>2]>>>24-8*(f%4)&255;b.push((d>>>4).toString(16));b.push((d&15).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],f=0;f<c;f+=2)b[f>>>3]|=parseInt(a.substr(f,
            2),16)<<24-4*(f%8);return new q.init(b,c/2)}},k=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],f=0;f<a;f++)b.push(String.fromCharCode(c[f>>>2]>>>24-8*(f%4)&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],f=0;f<c;f++)b[f>>>2]|=(a.charCodeAt(f)&255)<<24-8*(f%4);return new q.init(b,c)}},h=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},
    u=d.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=h.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var b=this._data,d=b.words,f=b.sigBytes,l=this.blockSize,e=f/(4*l),e=a?g.ceil(e):g.max((e|0)-this._minBufferSize,0);a=e*l;f=g.min(4*a,f);if(a){for(var h=0;h<a;h+=l)this._doProcessBlock(d,h);h=d.splice(0,a);b.sigBytes-=f}return new q.init(h,f)},clone:function(){var a=n.clone.call(this);
            a._data=this._data.clone();return a},_minBufferSize:0});d.Hasher=u.extend({cfg:n.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){u.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,d){return(new a.init(d)).finalize(b)}},_createHmacHelper:function(a){return function(b,d){return(new w.HMAC.init(a,
        d)).finalize(b)}}});var w=e.algo={};return e}(Math);
(function(){var g=CryptoJS,j=g.lib,e=j.WordArray,d=j.Hasher,m=[],j=g.algo.SHA1=d.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,e){for(var b=this._hash.words,l=b[0],k=b[1],h=b[2],g=b[3],j=b[4],a=0;80>a;a++){if(16>a)m[a]=d[e+a]|0;else{var c=m[a-3]^m[a-8]^m[a-14]^m[a-16];m[a]=c<<1|c>>>31}c=(l<<5|l>>>27)+j+m[a];c=20>a?c+((k&h|~k&g)+1518500249):40>a?c+((k^h^g)+1859775393):60>a?c+((k&h|k&g|h&g)-1894007588):c+((k^h^
        g)-899497514);j=g;g=h;h=k<<30|k>>>2;k=l;l=c}b[0]=b[0]+l|0;b[1]=b[1]+k|0;b[2]=b[2]+h|0;b[3]=b[3]+g|0;b[4]=b[4]+j|0},_doFinalize:function(){var d=this._data,e=d.words,b=8*this._nDataBytes,l=8*d.sigBytes;e[l>>>5]|=128<<24-l%32;e[(l+64>>>9<<4)+14]=Math.floor(b/4294967296);e[(l+64>>>9<<4)+15]=b;d.sigBytes=4*e.length;this._process();return this._hash},clone:function(){var e=d.clone.call(this);e._hash=this._hash.clone();return e}});g.SHA1=d._createHelper(j);g.HmacSHA1=d._createHmacHelper(j)})();
(function(){var g=CryptoJS,j=g.enc.Utf8;g.algo.HMAC=g.lib.Base.extend({init:function(e,d){e=this._hasher=new e.init;"string"==typeof d&&(d=j.parse(d));var g=e.blockSize,n=4*g;d.sigBytes>n&&(d=e.finalize(d));d.clamp();for(var q=this._oKey=d.clone(),b=this._iKey=d.clone(),l=q.words,k=b.words,h=0;h<g;h++)l[h]^=1549556828,k[h]^=909522486;q.sigBytes=b.sigBytes=n;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var d=
        this._hasher;e=d.finalize(e);d.reset();return d.finalize(this._oKey.clone().concat(e))}})})();
(function(){var g=CryptoJS,j=g.lib,e=j.Base,d=j.WordArray,j=g.algo,m=j.HMAC,n=j.PBKDF2=e.extend({cfg:e.extend({keySize:4,hasher:j.SHA1,iterations:1}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(e,b){for(var g=this.cfg,k=m.create(g.hasher,e),h=d.create(),j=d.create([1]),n=h.words,a=j.words,c=g.keySize,g=g.iterations;n.length<c;){var p=k.update(b).finalize(j);k.reset();for(var f=p.words,v=f.length,s=p,t=1;t<g;t++){s=k.finalize(s);k.reset();for(var x=s.words,r=0;r<v;r++)f[r]^=x[r]}h.concat(p);
        a[0]++}h.sigBytes=4*c;return h}});g.PBKDF2=function(d,b,e){return n.create(e).compute(d,b)}})();

//OYSTER DEPENDENCY LZ-STRING
//https://github.com/pieroxy/lz-string
var LZString=(function(){var f=String.fromCharCode;var keyStrBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";var baseReverseDic={};function getBaseValue(alphabet,character){if(!baseReverseDic[alphabet]){baseReverseDic[alphabet]={};for(var i=0;i<alphabet.length;i++){baseReverseDic[alphabet][alphabet.charAt(i)]=i}}
    return baseReverseDic[alphabet][character]}
    var LZString={compressToBase64:function(input){if(input==null)return"";var res=LZString._compress(input,6,function(a){return keyStrBase64.charAt(a)});switch(res.length%4){default:case 0:return res;case 1:return res+"===";case 2:return res+"==";case 3:return res+"="}},decompressFromBase64:function(input){if(input==null)return"";if(input=="")return null;return LZString._decompress(input.length,32,function(index){return getBaseValue(keyStrBase64,input.charAt(index))})},compressToUTF16:function(input){if(input==null)return"";return LZString._compress(input,15,function(a){return f(a+32)})+" "},decompressFromUTF16:function(compressed){if(compressed==null)return"";if(compressed=="")return null;return LZString._decompress(compressed.length,16384,function(index){return compressed.charCodeAt(index)-32})},compressToUint8Array:function(uncompressed){var compressed=LZString.compress(uncompressed);var buf=new Uint8Array(compressed.length*2);for(var i=0,TotalLen=compressed.length;i<TotalLen;i++){var current_value=compressed.charCodeAt(i);buf[i*2]=current_value>>>8;buf[i*2+1]=current_value%256}
            return buf},decompressFromUint8Array:function(compressed){if(compressed===null||compressed===undefined){return LZString.decompress(compressed)}else{var buf=new Array(compressed.length/2);for(var i=0,TotalLen=buf.length;i<TotalLen;i++){buf[i]=compressed[i*2]*256+compressed[i*2+1]}
            var result=[];buf.forEach(function(c){result.push(f(c))});return LZString.decompress(result.join(''))}},compressToEncodedURIComponent:function(input){if(input==null)return"";return LZString._compress(input,6,function(a){return keyStrUriSafe.charAt(a)})},decompressFromEncodedURIComponent:function(input){if(input==null)return"";if(input=="")return null;input=input.replace(/ /g,"+");return LZString._decompress(input.length,32,function(index){return getBaseValue(keyStrUriSafe,input.charAt(index))})},compress:function(uncompressed){return LZString._compress(uncompressed,16,function(a){return f(a)})},_compress:function(uncompressed,bitsPerChar,getCharFromInt){if(uncompressed==null)return"";var i,value,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data=[],context_data_val=0,context_data_position=0,ii;for(ii=0;ii<uncompressed.length;ii+=1){context_c=uncompressed.charAt(ii);if(!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)){context_dictionary[context_c]=context_dictSize++;context_dictionaryToCreate[context_c]=!0}
            context_wc=context_w+context_c;if(Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)){context_w=context_wc}else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}}
                value=context_w.charCodeAt(0);for(i=0;i<8;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                    value=value>>1}}else{value=1;for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|value;if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                value=0}
                value=context_w.charCodeAt(0);for(i=0;i<16;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                    value=value>>1}}
                context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}
                delete context_dictionaryToCreate[context_w]}else{value=context_dictionary[context_w];for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                value=value>>1}}
                context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}
                context_dictionary[context_wc]=context_dictSize++;context_w=String(context_c)}}
            if(context_w!==""){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}}
                value=context_w.charCodeAt(0);for(i=0;i<8;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                    value=value>>1}}else{value=1;for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|value;if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                value=0}
                value=context_w.charCodeAt(0);for(i=0;i<16;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                    value=value>>1}}
                context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}
                delete context_dictionaryToCreate[context_w]}else{value=context_dictionary[context_w];for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                value=value>>1}}
                context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}}
            value=2;for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}
                value=value>>1}
            while(!0){context_data_val=(context_data_val<<1);if(context_data_position==bitsPerChar-1){context_data.push(getCharFromInt(context_data_val));break}
            else context_data_position++}
            return context_data.join('')},decompress:function(compressed){if(compressed==null)return"";if(compressed=="")return null;return LZString._decompress(compressed.length,32768,function(index){return compressed.charCodeAt(index)})},_decompress:function(length,resetValue,getNextValue){var dictionary=[],next,enlargeIn=4,dictSize=4,numBits=3,entry="",result=[],i,w,bits,resb,maxpower,power,c,data={val:getNextValue(0),position:resetValue,index:1};for(i=0;i<3;i+=1){dictionary[i]=i}
            bits=0;maxpower=Math.pow(2,2);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}
                bits|=(resb>0?1:0)*power;power<<=1}
            switch(next=bits){case 0:bits=0;maxpower=Math.pow(2,8);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}
                bits|=(resb>0?1:0)*power;power<<=1}
                c=f(bits);break;case 1:bits=0;maxpower=Math.pow(2,16);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}
                bits|=(resb>0?1:0)*power;power<<=1}
                c=f(bits);break;case 2:return""}
            dictionary[3]=c;w=c;result.push(c);while(!0){if(data.index>length){return""}
                bits=0;maxpower=Math.pow(2,numBits);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}
                    bits|=(resb>0?1:0)*power;power<<=1}
                switch(c=bits){case 0:bits=0;maxpower=Math.pow(2,8);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}
                    bits|=(resb>0?1:0)*power;power<<=1}
                    dictionary[dictSize++]=f(bits);c=dictSize-1;enlargeIn--;break;case 1:bits=0;maxpower=Math.pow(2,16);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}
                    bits|=(resb>0?1:0)*power;power<<=1}
                    dictionary[dictSize++]=f(bits);c=dictSize-1;enlargeIn--;break;case 2:return result.join('')}
                if(enlargeIn==0){enlargeIn=Math.pow(2,numBits);numBits++}
                if(dictionary[c]){entry=dictionary[c]}else{if(c===dictSize){entry=w+w.charAt(0)}else{return null}}
                result.push(entry);dictionary[dictSize++]=w+entry.charAt(0);enlargeIn--;w=entry;if(enlargeIn==0){enlargeIn=Math.pow(2,numBits);numBits++}}}};return LZString})();

//OYSTER DEPENDENCY DEXIE
//https://github.com/dfahlander/Dexie.js
(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global.Dexie=factory())}(this,(function(){'use strict';var keys=Object.keys;var isArray=Array.isArray;var _global=typeof self!=='undefined'?self:typeof window!=='undefined'?window:global;function extend(obj,extension){if(typeof extension!=='object')
    return obj;keys(extension).forEach(function(key){obj[key]=extension[key]});return obj}
    var getProto=Object.getPrototypeOf;var _hasOwn={}.hasOwnProperty;function hasOwn(obj,prop){return _hasOwn.call(obj,prop)}
    function props(proto,extension){if(typeof extension==='function')
        extension=extension(getProto(proto));keys(extension).forEach(function(key){setProp(proto,key,extension[key])})}
    var defineProperty=Object.defineProperty;function setProp(obj,prop,functionOrGetSet,options){defineProperty(obj,prop,extend(functionOrGetSet&&hasOwn(functionOrGetSet,"get")&&typeof functionOrGetSet.get==='function'?{get:functionOrGetSet.get,set:functionOrGetSet.set,configurable:!0}:{value:functionOrGetSet,configurable:!0,writable:!0},options))}
    function derive(Child){return{from:function(Parent){Child.prototype=Object.create(Parent.prototype);setProp(Child.prototype,"constructor",Child);return{extend:props.bind(null,Child.prototype)}}}}
    var getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;function getPropertyDescriptor(obj,prop){var pd=getOwnPropertyDescriptor(obj,prop),proto;return pd||(proto=getProto(obj))&&getPropertyDescriptor(proto,prop)}
    var _slice=[].slice;function slice(args,start,end){return _slice.call(args,start,end)}
    function override(origFunc,overridedFactory){return overridedFactory(origFunc)}
    function assert(b){if(!b)
        throw new Error("Assertion Failed")}
    function asap(fn){if(_global.setImmediate)
        setImmediate(fn);else setTimeout(fn,0)}
    function arrayToObject(array,extractor){return array.reduce(function(result,item,i){var nameAndValue=extractor(item,i);if(nameAndValue)
        result[nameAndValue[0]]=nameAndValue[1];return result},{})}
    function trycatcher(fn,reject){return function(){try{fn.apply(this,arguments)}
    catch(e){reject(e)}}}
    function tryCatch(fn,onerror,args){try{fn.apply(null,args)}
    catch(ex){onerror&&onerror(ex)}}
    function getByKeyPath(obj,keyPath){if(hasOwn(obj,keyPath))
        return obj[keyPath];if(!keyPath)
        return obj;if(typeof keyPath!=='string'){var rv=[];for(var i=0,l=keyPath.length;i<l;++i){var val=getByKeyPath(obj,keyPath[i]);rv.push(val)}
        return rv}
        var period=keyPath.indexOf('.');if(period!==-1){var innerObj=obj[keyPath.substr(0,period)];return innerObj===undefined?undefined:getByKeyPath(innerObj,keyPath.substr(period+1))}
        return undefined}
    function setByKeyPath(obj,keyPath,value){if(!obj||keyPath===undefined)
        return;if('isFrozen' in Object&&Object.isFrozen(obj))
        return;if(typeof keyPath!=='string'&&'length' in keyPath){assert(typeof value!=='string'&&'length' in value);for(var i=0,l=keyPath.length;i<l;++i){setByKeyPath(obj,keyPath[i],value[i])}}
    else{var period=keyPath.indexOf('.');if(period!==-1){var currentKeyPath=keyPath.substr(0,period);var remainingKeyPath=keyPath.substr(period+1);if(remainingKeyPath==="")
        if(value===undefined)
            delete obj[currentKeyPath];else obj[currentKeyPath]=value;else{var innerObj=obj[currentKeyPath];if(!innerObj)
        innerObj=(obj[currentKeyPath]={});setByKeyPath(innerObj,remainingKeyPath,value)}}
    else{if(value===undefined)
        delete obj[keyPath];else obj[keyPath]=value}}}
    function delByKeyPath(obj,keyPath){if(typeof keyPath==='string')
        setByKeyPath(obj,keyPath,undefined);else if('length' in keyPath)[].map.call(keyPath,function(kp){setByKeyPath(obj,kp,undefined)})}
    function shallowClone(obj){var rv={};for(var m in obj){if(hasOwn(obj,m))
        rv[m]=obj[m]}
        return rv}
    var concat=[].concat;function flatten(a){return concat.apply([],a)}
    var intrinsicTypes="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(',').concat(flatten([8,16,32,64].map(function(num){return["Int","Uint","Float"].map(function(t){return t+num+"Array"})}))).filter(function(t){return _global[t]}).map(function(t){return _global[t]});function deepClone(any){if(!any||typeof any!=='object')
        return any;var rv;if(isArray(any)){rv=[];for(var i=0,l=any.length;i<l;++i){rv.push(deepClone(any[i]))}}
    else if(intrinsicTypes.indexOf(any.constructor)>=0){rv=any}
    else{rv=any.constructor?Object.create(any.constructor.prototype):{};for(var prop in any){if(hasOwn(any,prop)){rv[prop]=deepClone(any[prop])}}}
        return rv}
    function getObjectDiff(a,b,rv,prfx){rv=rv||{};prfx=prfx||'';keys(a).forEach(function(prop){if(!hasOwn(b,prop))
        rv[prfx+prop]=undefined;else{var ap=a[prop],bp=b[prop];if(typeof ap==='object'&&typeof bp==='object'&&ap&&bp&&(''+ap.constructor)===(''+bp.constructor))
        getObjectDiff(ap,bp,rv,prfx+prop+".");else if(ap!==bp)
        rv[prfx+prop]=b[prop]}});keys(b).forEach(function(prop){if(!hasOwn(a,prop)){rv[prfx+prop]=b[prop]}});return rv}
    var iteratorSymbol=typeof Symbol!=='undefined'&&Symbol.iterator;var getIteratorOf=iteratorSymbol?function(x){var i;return x!=null&&(i=x[iteratorSymbol])&&i.apply(x)}:function(){return null};var NO_CHAR_ARRAY={};function getArrayOf(arrayLike){var i,a,x,it;if(arguments.length===1){if(isArray(arrayLike))
        return arrayLike.slice();if(this===NO_CHAR_ARRAY&&typeof arrayLike==='string')
        return[arrayLike];if((it=getIteratorOf(arrayLike))){a=[];while((x=it.next()),!x.done)
        a.push(x.value);return a}
        if(arrayLike==null)
            return[arrayLike];i=arrayLike.length;if(typeof i==='number'){a=new Array(i);while(i--)
            a[i]=arrayLike[i];return a}
        return[arrayLike]}
        i=arguments.length;a=new Array(i);while(i--)
            a[i]=arguments[i];return a}
    var debug=typeof location!=='undefined'&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function setDebug(value,filter){debug=value;libraryFilter=filter}
    var libraryFilter=function(){return!0};var NEEDS_THROW_FOR_STACK=!new Error("").stack;function getErrorWithStack(){"use strict";if(NEEDS_THROW_FOR_STACK)
        try{throw new Error()}
        catch(e){return e}
        return new Error()}
    function prettyStack(exception,numIgnoredFrames){var stack=exception.stack;if(!stack)
        return"";numIgnoredFrames=(numIgnoredFrames||0);if(stack.indexOf(exception.name)===0)
        numIgnoredFrames+=(exception.name+exception.message).split('\n').length;return stack.split('\n').slice(numIgnoredFrames).filter(libraryFilter).map(function(frame){return"\n"+frame}).join('')}
    function deprecated(what,fn){return function(){console.warn(what+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+prettyStack(getErrorWithStack(),1));return fn.apply(this,arguments)}}
    var dexieErrorNames=['Modify','Bulk','OpenFailed','VersionChange','Schema','Upgrade','InvalidTable','MissingAPI','NoSuchDatabase','InvalidArgument','SubTransaction','Unsupported','Internal','DatabaseClosed','PrematureCommit','ForeignAwait'];var idbDomErrorNames=['Unknown','Constraint','Data','TransactionInactive','ReadOnly','Version','NotFound','InvalidState','InvalidAccess','Abort','Timeout','QuotaExceeded','Syntax','DataClone'];var errorList=dexieErrorNames.concat(idbDomErrorNames);var defaultTexts={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function DexieError(name,msg){this._e=getErrorWithStack();this.name=name;this.message=msg}
    derive(DexieError).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+prettyStack(this._e,2))}},toString:function(){return this.name+": "+this.message}});function getMultiErrorMessage(msg,failures){return msg+". Errors: "+failures.map(function(f){return f.toString()}).filter(function(v,i,s){return s.indexOf(v)===i}).join('\n')}
    function ModifyError(msg,failures,successCount,failedKeys){this._e=getErrorWithStack();this.failures=failures;this.failedKeys=failedKeys;this.successCount=successCount}
    derive(ModifyError).from(DexieError);function BulkError(msg,failures){this._e=getErrorWithStack();this.name="BulkError";this.failures=failures;this.message=getMultiErrorMessage(msg,failures)}
    derive(BulkError).from(DexieError);var errnames=errorList.reduce(function(obj,name){return(obj[name]=name+"Error",obj)},{});var BaseException=DexieError;var exceptions=errorList.reduce(function(obj,name){var fullName=name+"Error";function DexieError(msgOrInner,inner){this._e=getErrorWithStack();this.name=fullName;if(!msgOrInner){this.message=defaultTexts[name]||fullName;this.inner=null}
    else if(typeof msgOrInner==='string'){this.message=msgOrInner;this.inner=inner||null}
    else if(typeof msgOrInner==='object'){this.message=msgOrInner.name+" "+msgOrInner.message;this.inner=msgOrInner}}
        derive(DexieError).from(BaseException);obj[name]=DexieError;return obj},{});exceptions.Syntax=SyntaxError;exceptions.Type=TypeError;exceptions.Range=RangeError;var exceptionMap=idbDomErrorNames.reduce(function(obj,name){obj[name+"Error"]=exceptions[name];return obj},{});function mapError(domError,message){if(!domError||domError instanceof DexieError||domError instanceof TypeError||domError instanceof SyntaxError||!domError.name||!exceptionMap[domError.name])
        return domError;var rv=new exceptionMap[domError.name](message||domError.message,domError);if("stack" in domError){setProp(rv,"stack",{get:function(){return this.inner.stack}})}
        return rv}
    var fullNameExceptions=errorList.reduce(function(obj,name){if(["Syntax","Type","Range"].indexOf(name)===-1)
        obj[name+"Error"]=exceptions[name];return obj},{});fullNameExceptions.ModifyError=ModifyError;fullNameExceptions.DexieError=DexieError;fullNameExceptions.BulkError=BulkError;function nop(){}
    function mirror(val){return val}
    function pureFunctionChain(f1,f2){if(f1==null||f1===mirror)
        return f2;return function(val){return f2(f1(val))}}
    function callBoth(on1,on2){return function(){on1.apply(this,arguments);on2.apply(this,arguments)}}
    function hookCreatingChain(f1,f2){if(f1===nop)
        return f2;return function(){var res=f1.apply(this,arguments);if(res!==undefined)
        arguments[0]=res;var onsuccess=this.onsuccess,onerror=this.onerror;this.onsuccess=null;this.onerror=null;var res2=f2.apply(this,arguments);if(onsuccess)
        this.onsuccess=this.onsuccess?callBoth(onsuccess,this.onsuccess):onsuccess;if(onerror)
        this.onerror=this.onerror?callBoth(onerror,this.onerror):onerror;return res2!==undefined?res2:res}}
    function hookDeletingChain(f1,f2){if(f1===nop)
        return f2;return function(){f1.apply(this,arguments);var onsuccess=this.onsuccess,onerror=this.onerror;this.onsuccess=this.onerror=null;f2.apply(this,arguments);if(onsuccess)
        this.onsuccess=this.onsuccess?callBoth(onsuccess,this.onsuccess):onsuccess;if(onerror)
        this.onerror=this.onerror?callBoth(onerror,this.onerror):onerror}}
    function hookUpdatingChain(f1,f2){if(f1===nop)
        return f2;return function(modifications){var res=f1.apply(this,arguments);extend(modifications,res);var onsuccess=this.onsuccess,onerror=this.onerror;this.onsuccess=null;this.onerror=null;var res2=f2.apply(this,arguments);if(onsuccess)
        this.onsuccess=this.onsuccess?callBoth(onsuccess,this.onsuccess):onsuccess;if(onerror)
        this.onerror=this.onerror?callBoth(onerror,this.onerror):onerror;return res===undefined?(res2===undefined?undefined:res2):(extend(res,res2))}}
    function reverseStoppableEventChain(f1,f2){if(f1===nop)
        return f2;return function(){if(f2.apply(this,arguments)===!1)
        return!1;return f1.apply(this,arguments)}}
    function promisableChain(f1,f2){if(f1===nop)
        return f2;return function(){var res=f1.apply(this,arguments);if(res&&typeof res.then==='function'){var thiz=this,i=arguments.length,args=new Array(i);while(i--)
        args[i]=arguments[i];return res.then(function(){return f2.apply(thiz,args)})}
        return f2.apply(this,arguments)}}
    var INTERNAL={};var LONG_STACKS_CLIP_LIMIT=100;var MAX_LONG_STACKS=20;var ZONE_ECHO_LIMIT=7;var nativePromiseInstanceAndProto=(function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}
    catch(e){var P=_global.Promise;return P?[P.resolve(),P.prototype,P.resolve()]:[]}})();var resolvedNativePromise=nativePromiseInstanceAndProto[0];var nativePromiseProto=nativePromiseInstanceAndProto[1];var resolvedGlobalPromise=nativePromiseInstanceAndProto[2];var nativePromiseThen=nativePromiseProto&&nativePromiseProto.then;var NativePromise=resolvedNativePromise&&resolvedNativePromise.constructor;var AsyncFunction=nativePromiseInstanceAndProto[3];var patchGlobalPromise=!!resolvedGlobalPromise;var stack_being_generated=!1;var schedulePhysicalTick=resolvedGlobalPromise?function(){resolvedGlobalPromise.then(physicalTick)}:_global.setImmediate?setImmediate.bind(null,physicalTick):_global.MutationObserver?function(){var hiddenDiv=document.createElement("div");(new MutationObserver(function(){physicalTick();hiddenDiv=null})).observe(hiddenDiv,{attributes:!0});hiddenDiv.setAttribute('i','1')}:function(){setTimeout(physicalTick,0)};var asap$1=function(callback,args){microtickQueue.push([callback,args]);if(needsNewPhysicalTick){schedulePhysicalTick();needsNewPhysicalTick=!1}};var isOutsideMicroTick=!0;var needsNewPhysicalTick=!0;var unhandledErrors=[];var rejectingErrors=[];var currentFulfiller=null;var rejectionMapper=mirror;var globalPSD={id:'global',global:!0,ref:0,unhandleds:[],onunhandled:globalError,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(uh){try{globalError(uh[0],uh[1])}
        catch(e){}})}};var PSD=globalPSD;var microtickQueue=[];var numScheduledCalls=0;var tickFinalizers=[];function Promise(fn){if(typeof this!=='object')
        throw new TypeError('Promises must be constructed via new');this._listeners=[];this.onuncatched=nop;this._lib=!1;var psd=(this._PSD=PSD);if(debug){this._stackHolder=getErrorWithStack();this._prev=null;this._numPrev=0}
        if(typeof fn!=='function'){if(fn!==INTERNAL)
            throw new TypeError('Not a function');this._state=arguments[1];this._value=arguments[2];if(this._state===!1)
            handleRejection(this,this._value);return}
        this._state=null;this._value=null;++psd.ref;executePromiseTask(this,fn)}
    var thenProp={get:function(){var psd=PSD,microTaskId=totalEchoes;function then(onFulfilled,onRejected){var _this=this;var possibleAwait=!psd.global&&(psd!==PSD||microTaskId!==totalEchoes);if(possibleAwait)
            decrementExpectedAwaits();var rv=new Promise(function(resolve,reject){propagateToListener(_this,new Listener(nativeAwaitCompatibleWrap(onFulfilled,psd,possibleAwait),nativeAwaitCompatibleWrap(onRejected,psd,possibleAwait),resolve,reject,psd))});debug&&linkToPreviousPromise(rv,this);return rv}
            then.prototype=INTERNAL;return then},set:function(value){setProp(this,'then',value&&value.prototype===INTERNAL?thenProp:{get:function(){return value},set:thenProp.set})}};props(Promise.prototype,{then:thenProp,_then:function(onFulfilled,onRejected){propagateToListener(this,new Listener(null,null,onFulfilled,onRejected,PSD))},catch:function(onRejected){if(arguments.length===1)
            return this.then(null,onRejected);var type=arguments[0],handler=arguments[1];return typeof type==='function'?this.then(null,function(err){return err instanceof type?handler(err):PromiseReject(err)}):this.then(null,function(err){return err&&err.name===type?handler(err):PromiseReject(err)})},finally:function(onFinally){return this.then(function(value){onFinally();return value},function(err){onFinally();return PromiseReject(err)})},stack:{get:function(){if(this._stack)
                return this._stack;try{stack_being_generated=!0;var stacks=getStack(this,[],MAX_LONG_STACKS);var stack=stacks.join("\nFrom previous: ");if(this._state!==null)
                this._stack=stack;return stack}
            finally{stack_being_generated=!1}}},timeout:function(ms,msg){var _this=this;return ms<Infinity?new Promise(function(resolve,reject){var handle=setTimeout(function(){return reject(new exceptions.Timeout(msg))},ms);_this.then(resolve,reject).finally(clearTimeout.bind(null,handle))}):this}});if(typeof Symbol!=='undefined'&&Symbol.toStringTag)
        setProp(Promise.prototype,Symbol.toStringTag,'Promise');globalPSD.env=snapShot();function Listener(onFulfilled,onRejected,resolve,reject,zone){this.onFulfilled=typeof onFulfilled==='function'?onFulfilled:null;this.onRejected=typeof onRejected==='function'?onRejected:null;this.resolve=resolve;this.reject=reject;this.psd=zone}
    props(Promise,{all:function(){var values=getArrayOf.apply(null,arguments).map(onPossibleParallellAsync);return new Promise(function(resolve,reject){if(values.length===0)
            resolve([]);var remaining=values.length;values.forEach(function(a,i){return Promise.resolve(a).then(function(x){values[i]=x;if(!--remaining)
            resolve(values)},reject)})})},resolve:function(value){if(value instanceof Promise)
            return value;if(value&&typeof value.then==='function')
            return new Promise(function(resolve,reject){value.then(resolve,reject)});var rv=new Promise(INTERNAL,!0,value);linkToPreviousPromise(rv,currentFulfiller);return rv},reject:PromiseReject,race:function(){var values=getArrayOf.apply(null,arguments).map(onPossibleParallellAsync);return new Promise(function(resolve,reject){values.map(function(value){return Promise.resolve(value).then(resolve,reject)})})},PSD:{get:function(){return PSD},set:function(value){return PSD=value}},newPSD:newScope,usePSD:usePSD,scheduler:{get:function(){return asap$1},set:function(value){asap$1=value}},rejectionMapper:{get:function(){return rejectionMapper},set:function(value){rejectionMapper=value}},follow:function(fn,zoneProps){return new Promise(function(resolve,reject){return newScope(function(resolve,reject){var psd=PSD;psd.unhandleds=[];psd.onunhandled=reject;psd.finalize=callBoth(function(){var _this=this;run_at_end_of_this_or_next_physical_tick(function(){_this.unhandleds.length===0?resolve():reject(_this.unhandleds[0])})},psd.finalize);fn()},zoneProps,resolve,reject)})}});function executePromiseTask(promise,fn){try{fn(function(value){if(promise._state!==null)
        return;if(value===promise)
        throw new TypeError('A promise cannot be resolved with itself.');var shouldExecuteTick=promise._lib&&beginMicroTickScope();if(value&&typeof value.then==='function'){executePromiseTask(promise,function(resolve,reject){value instanceof Promise?value._then(resolve,reject):value.then(resolve,reject)})}
    else{promise._state=!0;promise._value=value;propagateAllListeners(promise)}
        if(shouldExecuteTick)
            endMicroTickScope()},handleRejection.bind(null,promise))}
    catch(ex){handleRejection(promise,ex)}}
    function handleRejection(promise,reason){rejectingErrors.push(reason);if(promise._state!==null)
        return;var shouldExecuteTick=promise._lib&&beginMicroTickScope();reason=rejectionMapper(reason);promise._state=!1;promise._value=reason;debug&&reason!==null&&typeof reason==='object'&&!reason._promise&&tryCatch(function(){var origProp=getPropertyDescriptor(reason,"stack");reason._promise=promise;setProp(reason,"stack",{get:function(){return stack_being_generated?origProp&&(origProp.get?origProp.get.apply(reason):origProp.value):promise.stack}})});addPossiblyUnhandledError(promise);propagateAllListeners(promise);if(shouldExecuteTick)
        endMicroTickScope()}
    function propagateAllListeners(promise){var listeners=promise._listeners;promise._listeners=[];for(var i=0,len=listeners.length;i<len;++i){propagateToListener(promise,listeners[i])}
        var psd=promise._PSD;--psd.ref||psd.finalize();if(numScheduledCalls===0){++numScheduledCalls;asap$1(function(){if(--numScheduledCalls===0)
            finalizePhysicalTick()},[])}}
    function propagateToListener(promise,listener){if(promise._state===null){promise._listeners.push(listener);return}
        var cb=promise._state?listener.onFulfilled:listener.onRejected;if(cb===null){return(promise._state?listener.resolve:listener.reject)(promise._value)}
        ++listener.psd.ref;++numScheduledCalls;asap$1(callListener,[cb,promise,listener])}
    function callListener(cb,promise,listener){try{currentFulfiller=promise;var ret,value=promise._value;if(promise._state){ret=cb(value)}
    else{if(rejectingErrors.length)
        rejectingErrors=[];ret=cb(value);if(rejectingErrors.indexOf(value)===-1)
        markErrorAsHandled(promise)}
        listener.resolve(ret)}
    catch(e){listener.reject(e)}
    finally{currentFulfiller=null;if(--numScheduledCalls===0)
        finalizePhysicalTick();--listener.psd.ref||listener.psd.finalize()}}
    function getStack(promise,stacks,limit){if(stacks.length===limit)
        return stacks;var stack="";if(promise._state===!1){var failure=promise._value,errorName,message;if(failure!=null){errorName=failure.name||"Error";message=failure.message||failure;stack=prettyStack(failure,0)}
    else{errorName=failure;message=""}
        stacks.push(errorName+(message?": "+message:"")+stack)}
        if(debug){stack=prettyStack(promise._stackHolder,2);if(stack&&stacks.indexOf(stack)===-1)
            stacks.push(stack);if(promise._prev)
            getStack(promise._prev,stacks,limit)}
        return stacks}
    function linkToPreviousPromise(promise,prev){var numPrev=prev?prev._numPrev+1:0;if(numPrev<LONG_STACKS_CLIP_LIMIT){promise._prev=prev;promise._numPrev=numPrev}}
    function physicalTick(){beginMicroTickScope()&&endMicroTickScope()}
    function beginMicroTickScope(){var wasRootExec=isOutsideMicroTick;isOutsideMicroTick=!1;needsNewPhysicalTick=!1;return wasRootExec}
    function endMicroTickScope(){var callbacks,i,l;do{while(microtickQueue.length>0){callbacks=microtickQueue;microtickQueue=[];l=callbacks.length;for(i=0;i<l;++i){var item=callbacks[i];item[0].apply(null,item[1])}}}while(microtickQueue.length>0);isOutsideMicroTick=!0;needsNewPhysicalTick=!0}
    function finalizePhysicalTick(){var unhandledErrs=unhandledErrors;unhandledErrors=[];unhandledErrs.forEach(function(p){p._PSD.onunhandled.call(null,p._value,p)});var finalizers=tickFinalizers.slice(0);var i=finalizers.length;while(i)
        finalizers[--i]();}
    function run_at_end_of_this_or_next_physical_tick(fn){function finalizer(){fn();tickFinalizers.splice(tickFinalizers.indexOf(finalizer),1)}
        tickFinalizers.push(finalizer);++numScheduledCalls;asap$1(function(){if(--numScheduledCalls===0)
            finalizePhysicalTick()},[])}
    function addPossiblyUnhandledError(promise){if(!unhandledErrors.some(function(p){return p._value===promise._value}))
        unhandledErrors.push(promise)}
    function markErrorAsHandled(promise){var i=unhandledErrors.length;while(i)
        if(unhandledErrors[--i]._value===promise._value){unhandledErrors.splice(i,1);return}}
    function PromiseReject(reason){return new Promise(INTERNAL,!1,reason)}
    function wrap(fn,errorCatcher){var psd=PSD;return function(){var wasRootExec=beginMicroTickScope(),outerScope=PSD;try{switchToZone(psd,!0);return fn.apply(this,arguments)}
    catch(e){errorCatcher&&errorCatcher(e)}
    finally{switchToZone(outerScope,!1);if(wasRootExec)
        endMicroTickScope()}}}
    var task={awaits:0,echoes:0,id:0};var taskCounter=0;var zoneStack=[];var zoneEchoes=0;var totalEchoes=0;var zone_id_counter=0;function newScope(fn,props$$1,a1,a2){var parent=PSD,psd=Object.create(parent);psd.parent=parent;psd.ref=0;psd.global=!1;psd.id=++zone_id_counter;var globalEnv=globalPSD.env;psd.env=patchGlobalPromise?{Promise:Promise,PromiseProp:{value:Promise,configurable:!0,writable:!0},all:Promise.all,race:Promise.race,resolve:Promise.resolve,reject:Promise.reject,nthen:getPatchedPromiseThen(globalEnv.nthen,psd),gthen:getPatchedPromiseThen(globalEnv.gthen,psd)}:{};if(props$$1)
        extend(psd,props$$1);++parent.ref;psd.finalize=function(){--this.parent.ref||this.parent.finalize()};var rv=usePSD(psd,fn,a1,a2);if(psd.ref===0)
        psd.finalize();return rv}
    function incrementExpectedAwaits(){if(!task.id)
        task.id=++taskCounter;++task.awaits;task.echoes+=ZONE_ECHO_LIMIT;return task.id}
    function decrementExpectedAwaits(sourceTaskId){if(!task.awaits||(sourceTaskId&&sourceTaskId!==task.id))
        return;if(--task.awaits===0)
        task.id=0;task.echoes=task.awaits*ZONE_ECHO_LIMIT}
    function onPossibleParallellAsync(possiblePromise){if(task.echoes&&possiblePromise&&possiblePromise.constructor===NativePromise){incrementExpectedAwaits();return possiblePromise.then(function(x){decrementExpectedAwaits();return x},function(e){decrementExpectedAwaits();return rejection(e)})}
        return possiblePromise}
    function zoneEnterEcho(targetZone){++totalEchoes;if(!task.echoes||--task.echoes===0){task.echoes=task.id=0}
        zoneStack.push(PSD);switchToZone(targetZone,!0)}
    function zoneLeaveEcho(){var zone=zoneStack[zoneStack.length-1];zoneStack.pop();switchToZone(zone,!1)}
    function switchToZone(targetZone,bEnteringZone){var currentZone=PSD;if(bEnteringZone?task.echoes&&(!zoneEchoes++||targetZone!==PSD):zoneEchoes&&(!--zoneEchoes||targetZone!==PSD)){enqueueNativeMicroTask(bEnteringZone?zoneEnterEcho.bind(null,targetZone):zoneLeaveEcho)}
        if(targetZone===PSD)
            return;PSD=targetZone;if(currentZone===globalPSD)
            globalPSD.env=snapShot();if(patchGlobalPromise){var GlobalPromise=globalPSD.env.Promise;var targetEnv=targetZone.env;nativePromiseProto.then=targetEnv.nthen;GlobalPromise.prototype.then=targetEnv.gthen;if(currentZone.global||targetZone.global){Object.defineProperty(_global,'Promise',targetEnv.PromiseProp);GlobalPromise.all=targetEnv.all;GlobalPromise.race=targetEnv.race;GlobalPromise.resolve=targetEnv.resolve;GlobalPromise.reject=targetEnv.reject}}}
    function snapShot(){var GlobalPromise=_global.Promise;return patchGlobalPromise?{Promise:GlobalPromise,PromiseProp:Object.getOwnPropertyDescriptor(_global,"Promise"),all:GlobalPromise.all,race:GlobalPromise.race,resolve:GlobalPromise.resolve,reject:GlobalPromise.reject,nthen:nativePromiseProto.then,gthen:GlobalPromise.prototype.then}:{}}
    function usePSD(psd,fn,a1,a2,a3){var outerScope=PSD;try{switchToZone(psd,!0);return fn(a1,a2,a3)}
    finally{switchToZone(outerScope,!1)}}
    function enqueueNativeMicroTask(job){nativePromiseThen.call(resolvedNativePromise,job)}
    function nativeAwaitCompatibleWrap(fn,zone,possibleAwait){return typeof fn!=='function'?fn:function(){var outerZone=PSD;if(possibleAwait)
        incrementExpectedAwaits();switchToZone(zone,!0);try{return fn.apply(this,arguments)}
    finally{switchToZone(outerZone,!1)}}}
    function getPatchedPromiseThen(origThen,zone){return function(onResolved,onRejected){return origThen.call(this,nativeAwaitCompatibleWrap(onResolved,zone,!1),nativeAwaitCompatibleWrap(onRejected,zone,!1))}}
    var UNHANDLEDREJECTION="unhandledrejection";function globalError(err,promise){var rv;try{rv=promise.onuncatched(err)}
    catch(e){}
        if(rv!==!1)
            try{var event,eventData={promise:promise,reason:err};if(_global.document&&document.createEvent){event=document.createEvent('Event');event.initEvent(UNHANDLEDREJECTION,!0,!0);extend(event,eventData)}
            else if(_global.CustomEvent){event=new CustomEvent(UNHANDLEDREJECTION,{detail:eventData});extend(event,eventData)}
                if(event&&_global.dispatchEvent){dispatchEvent(event);if(!_global.PromiseRejectionEvent&&_global.onunhandledrejection)
                    try{_global.onunhandledrejection(event)}
                    catch(_){}}
                if(!event.defaultPrevented){console.warn("Unhandled rejection: "+(err.stack||err))}}
            catch(e){}}
    var rejection=Promise.reject;function Events(ctx){var evs={};var rv=function(eventName,subscriber){if(subscriber){var i=arguments.length,args=new Array(i-1);while(--i)
        args[i-1]=arguments[i];evs[eventName].subscribe.apply(null,args);return ctx}
    else if(typeof(eventName)==='string'){return evs[eventName]}};rv.addEventType=add;for(var i=1,l=arguments.length;i<l;++i){add(arguments[i])}
        return rv;function add(eventName,chainFunction,defaultFunction){if(typeof eventName==='object')
            return addConfiguredEvents(eventName);if(!chainFunction)
            chainFunction=reverseStoppableEventChain;if(!defaultFunction)
            defaultFunction=nop;var context={subscribers:[],fire:defaultFunction,subscribe:function(cb){if(context.subscribers.indexOf(cb)===-1){context.subscribers.push(cb);context.fire=chainFunction(context.fire,cb)}},unsubscribe:function(cb){context.subscribers=context.subscribers.filter(function(fn){return fn!==cb});context.fire=context.subscribers.reduce(chainFunction,defaultFunction)}};evs[eventName]=rv[eventName]=context;return context}
        function addConfiguredEvents(cfg){keys(cfg).forEach(function(eventName){var args=cfg[eventName];if(isArray(args)){add(eventName,cfg[eventName][0],cfg[eventName][1])}
        else if(args==='asap'){var context=add(eventName,mirror,function fire(){var i=arguments.length,args=new Array(i);while(i--)
            args[i]=arguments[i];context.subscribers.forEach(function(fn){asap(function fireEvent(){fn.apply(null,args)})})})}
        else throw new exceptions.InvalidArgument("Invalid event config")})}}
    var DEXIE_VERSION='2.0.4';var maxString=String.fromCharCode(65535);var maxKey=(function(){try{IDBKeyRange.only([[]]);return[[]]}
    catch(e){return maxString}})();var minKey=-Infinity;var INVALID_KEY_ARGUMENT="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.";var STRING_EXPECTED="String expected.";var connections=[];var isIEOrEdge=typeof navigator!=='undefined'&&/(MSIE|Trident|Edge)/.test(navigator.userAgent);var hasIEDeleteObjectStoreBug=isIEOrEdge;var hangsOnDeleteLargeKeyRange=isIEOrEdge;var dexieStackFrameFilter=function(frame){return!/(dexie\.js|dexie\.min\.js)/.test(frame)};var dbNamesDB;setDebug(debug,dexieStackFrameFilter);function Dexie(dbName,options){var deps=Dexie.dependencies;var opts=extend({addons:Dexie.addons,autoOpen:!0,indexedDB:deps.indexedDB,IDBKeyRange:deps.IDBKeyRange},options);var addons=opts.addons,autoOpen=opts.autoOpen,indexedDB=opts.indexedDB,IDBKeyRange=opts.IDBKeyRange;var globalSchema=this._dbSchema={};var versions=[];var dbStoreNames=[];var allTables={};var idbdb=null;var dbOpenError=null;var isBeingOpened=!1;var onReadyBeingFired=null;var openComplete=!1;var READONLY="readonly",READWRITE="readwrite";var db=this;var dbReadyResolve,dbReadyPromise=new Promise(function(resolve){dbReadyResolve=resolve}),cancelOpen,openCanceller=new Promise(function(_,reject){cancelOpen=reject});var autoSchema=!0;var hasNativeGetDatabaseNames=!!getNativeGetDatabaseNamesFn(indexedDB),hasGetAll;function init(){db.on("versionchange",function(ev){if(ev.newVersion>0)
        console.warn("Another connection wants to upgrade database '"+db.name+"'. Closing db now to resume the upgrade.");else console.warn("Another connection wants to delete database '"+db.name+"'. Closing db now to resume the delete request.");db.close()});db.on("blocked",function(ev){if(!ev.newVersion||ev.newVersion<ev.oldVersion)
        console.warn("Dexie.delete('"+db.name+"') was blocked");else console.warn("Upgrade '"+db.name+"' blocked by other connection holding version "+ev.oldVersion/10)})}
        this.version=function(versionNumber){if(idbdb||isBeingOpened)
            throw new exceptions.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,versionNumber);var versionInstance=versions.filter(function(v){return v._cfg.version===versionNumber})[0];if(versionInstance)
            return versionInstance;versionInstance=new Version(versionNumber);versions.push(versionInstance);versions.sort(lowerVersionFirst);autoSchema=!1;return versionInstance};function Version(versionNumber){this._cfg={version:versionNumber,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}
        extend(Version.prototype,{stores:function(stores){this._cfg.storesSource=this._cfg.storesSource?extend(this._cfg.storesSource,stores):stores;var storesSpec={};versions.forEach(function(version){extend(storesSpec,version._cfg.storesSource)});var dbschema=(this._cfg.dbschema={});this._parseStoresSpec(storesSpec,dbschema);globalSchema=db._dbSchema=dbschema;removeTablesApi([allTables,db,Transaction.prototype]);setApiOnPlace([allTables,db,Transaction.prototype,this._cfg.tables],keys(dbschema),dbschema);dbStoreNames=keys(dbschema);return this},upgrade:function(upgradeFunction){this._cfg.contentUpgrade=upgradeFunction;return this},_parseStoresSpec:function(stores,outSchema){keys(stores).forEach(function(tableName){if(stores[tableName]!==null){var instanceTemplate={};var indexes=parseIndexSyntax(stores[tableName]);var primKey=indexes.shift();if(primKey.multi)
                throw new exceptions.Schema("Primary key cannot be multi-valued");if(primKey.keyPath)
                setByKeyPath(instanceTemplate,primKey.keyPath,primKey.auto?0:primKey.keyPath);indexes.forEach(function(idx){if(idx.auto)
                throw new exceptions.Schema("Only primary key can be marked as autoIncrement (++)");if(!idx.keyPath)
                throw new exceptions.Schema("Index must have a name and cannot be an empty string");setByKeyPath(instanceTemplate,idx.keyPath,idx.compound?idx.keyPath.map(function(){return""}):"")});outSchema[tableName]=new TableSchema(tableName,primKey,indexes,instanceTemplate)}})}});function runUpgraders(oldVersion,idbtrans,reject){var trans=db._createTransaction(READWRITE,dbStoreNames,globalSchema);trans.create(idbtrans);trans._completion.catch(reject);var rejectTransaction=trans._reject.bind(trans);newScope(function(){PSD.trans=trans;if(oldVersion===0){keys(globalSchema).forEach(function(tableName){createTable(idbtrans,tableName,globalSchema[tableName].primKey,globalSchema[tableName].indexes)});Promise.follow(function(){return db.on.populate.fire(trans)}).catch(rejectTransaction)}
        else updateTablesAndIndexes(oldVersion,trans,idbtrans).catch(rejectTransaction)})}
        function updateTablesAndIndexes(oldVersion,trans,idbtrans){var queue=[];var oldVersionStruct=versions.filter(function(version){return version._cfg.version===oldVersion})[0];if(!oldVersionStruct)
            throw new exceptions.Upgrade("Dexie specification of currently installed DB version is missing");globalSchema=db._dbSchema=oldVersionStruct._cfg.dbschema;var anyContentUpgraderHasRun=!1;var versToRun=versions.filter(function(v){return v._cfg.version>oldVersion});versToRun.forEach(function(version){queue.push(function(){var oldSchema=globalSchema;var newSchema=version._cfg.dbschema;adjustToExistingIndexNames(oldSchema,idbtrans);adjustToExistingIndexNames(newSchema,idbtrans);globalSchema=db._dbSchema=newSchema;var diff=getSchemaDiff(oldSchema,newSchema);diff.add.forEach(function(tuple){createTable(idbtrans,tuple[0],tuple[1].primKey,tuple[1].indexes)});diff.change.forEach(function(change){if(change.recreate){throw new exceptions.Upgrade("Not yet support for changing primary key")}
        else{var store=idbtrans.objectStore(change.name);change.add.forEach(function(idx){addIndex(store,idx)});change.change.forEach(function(idx){store.deleteIndex(idx.name);addIndex(store,idx)});change.del.forEach(function(idxName){store.deleteIndex(idxName)})}});if(version._cfg.contentUpgrade){anyContentUpgraderHasRun=!0;return Promise.follow(function(){version._cfg.contentUpgrade(trans)})}});queue.push(function(idbtrans){if(!anyContentUpgraderHasRun||!hasIEDeleteObjectStoreBug){var newSchema=version._cfg.dbschema;deleteRemovedTables(newSchema,idbtrans)}})});function runQueue(){return queue.length?Promise.resolve(queue.shift()(trans.idbtrans)).then(runQueue):Promise.resolve()}
            return runQueue().then(function(){createMissingTables(globalSchema,idbtrans)})}
        function getSchemaDiff(oldSchema,newSchema){var diff={del:[],add:[],change:[]};for(var table in oldSchema){if(!newSchema[table])
            diff.del.push(table)}
            for(table in newSchema){var oldDef=oldSchema[table],newDef=newSchema[table];if(!oldDef){diff.add.push([table,newDef])}
            else{var change={name:table,def:newDef,recreate:!1,del:[],add:[],change:[]};if(oldDef.primKey.src!==newDef.primKey.src){change.recreate=!0;diff.change.push(change)}
            else{var oldIndexes=oldDef.idxByName;var newIndexes=newDef.idxByName;for(var idxName in oldIndexes){if(!newIndexes[idxName])
                change.del.push(idxName)}
                for(idxName in newIndexes){var oldIdx=oldIndexes[idxName],newIdx=newIndexes[idxName];if(!oldIdx)
                    change.add.push(newIdx);else if(oldIdx.src!==newIdx.src)
                    change.change.push(newIdx)}
                if(change.del.length>0||change.add.length>0||change.change.length>0){diff.change.push(change)}}}}
            return diff}
        function createTable(idbtrans,tableName,primKey,indexes){var store=idbtrans.db.createObjectStore(tableName,primKey.keyPath?{keyPath:primKey.keyPath,autoIncrement:primKey.auto}:{autoIncrement:primKey.auto});indexes.forEach(function(idx){addIndex(store,idx)});return store}
        function createMissingTables(newSchema,idbtrans){keys(newSchema).forEach(function(tableName){if(!idbtrans.db.objectStoreNames.contains(tableName)){createTable(idbtrans,tableName,newSchema[tableName].primKey,newSchema[tableName].indexes)}})}
        function deleteRemovedTables(newSchema,idbtrans){for(var i=0;i<idbtrans.db.objectStoreNames.length;++i){var storeName=idbtrans.db.objectStoreNames[i];if(newSchema[storeName]==null){idbtrans.db.deleteObjectStore(storeName)}}}
        function addIndex(store,idx){store.createIndex(idx.name,idx.keyPath,{unique:idx.unique,multiEntry:idx.multi})}
        this._allTables=allTables;this._createTransaction=function(mode,storeNames,dbschema,parentTransaction){return new Transaction(mode,storeNames,dbschema,parentTransaction)};function tempTransaction(mode,storeNames,fn){if(!openComplete&&(!PSD.letThrough)){if(!isBeingOpened){if(!autoOpen)
            return rejection(new exceptions.DatabaseClosed());db.open().catch(nop)}
            return dbReadyPromise.then(function(){return tempTransaction(mode,storeNames,fn)})}
        else{var trans=db._createTransaction(mode,storeNames,globalSchema);try{trans.create()}
        catch(ex){return rejection(ex)}
            return trans._promise(mode,function(resolve,reject){return newScope(function(){PSD.trans=trans;return fn(resolve,reject,trans)})}).then(function(result){return trans._completion.then(function(){return result})})}}
        this._whenReady=function(fn){return openComplete||PSD.letThrough?fn():new Promise(function(resolve,reject){if(!isBeingOpened){if(!autoOpen){reject(new exceptions.DatabaseClosed());return}
            db.open().catch(nop)}
            dbReadyPromise.then(resolve,reject)}).then(fn)};this.verno=0;this.open=function(){if(isBeingOpened||idbdb)
            return dbReadyPromise.then(function(){return dbOpenError?rejection(dbOpenError):db});debug&&(openCanceller._stackHolder=getErrorWithStack());isBeingOpened=!0;dbOpenError=null;openComplete=!1;var resolveDbReady=dbReadyResolve,upgradeTransaction=null;return Promise.race([openCanceller,new Promise(function(resolve,reject){if(!indexedDB)
            throw new exceptions.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL "+"(not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var req=autoSchema?indexedDB.open(dbName):indexedDB.open(dbName,Math.round(db.verno*10));if(!req)
            throw new exceptions.MissingAPI("IndexedDB API not available");req.onerror=eventRejectHandler(reject);req.onblocked=wrap(fireOnBlocked);req.onupgradeneeded=wrap(function(e){upgradeTransaction=req.transaction;if(autoSchema&&!db._allowEmptyDB){req.onerror=preventDefault;upgradeTransaction.abort();req.result.close();var delreq=indexedDB.deleteDatabase(dbName);delreq.onsuccess=delreq.onerror=wrap(function(){reject(new exceptions.NoSuchDatabase("Database "+dbName+" doesnt exist"))})}
        else{upgradeTransaction.onerror=eventRejectHandler(reject);var oldVer=e.oldVersion>Math.pow(2,62)?0:e.oldVersion;runUpgraders(oldVer/10,upgradeTransaction,reject,req)}},reject);req.onsuccess=wrap(function(){upgradeTransaction=null;idbdb=req.result;connections.push(db);if(autoSchema)
            readGlobalSchema();else if(idbdb.objectStoreNames.length>0){try{adjustToExistingIndexNames(globalSchema,idbdb.transaction(safariMultiStoreFix(idbdb.objectStoreNames),READONLY))}
        catch(e){}}
            idbdb.onversionchange=wrap(function(ev){db._vcFired=!0;db.on("versionchange").fire(ev)});if(!hasNativeGetDatabaseNames&&dbName!=='__dbnames'){dbNamesDB.dbnames.put({name:dbName}).catch(nop)}
            resolve()},reject)})]).then(function(){onReadyBeingFired=[];return Promise.resolve(Dexie.vip(db.on.ready.fire)).then(function fireRemainders(){if(onReadyBeingFired.length>0){var remainders=onReadyBeingFired.reduce(promisableChain,nop);onReadyBeingFired=[];return Promise.resolve(Dexie.vip(remainders)).then(fireRemainders)}})}).finally(function(){onReadyBeingFired=null}).then(function(){isBeingOpened=!1;return db}).catch(function(err){try{upgradeTransaction&&upgradeTransaction.abort()}
        catch(e){}
            isBeingOpened=!1;db.close();dbOpenError=err;return rejection(dbOpenError)}).finally(function(){openComplete=!0;resolveDbReady()})};this.close=function(){var idx=connections.indexOf(db);if(idx>=0)
            connections.splice(idx,1);if(idbdb){try{idbdb.close()}
        catch(e){}
            idbdb=null}
            autoOpen=!1;dbOpenError=new exceptions.DatabaseClosed();if(isBeingOpened)
                cancelOpen(dbOpenError);dbReadyPromise=new Promise(function(resolve){dbReadyResolve=resolve});openCanceller=new Promise(function(_,reject){cancelOpen=reject})};this.delete=function(){var hasArguments=arguments.length>0;return new Promise(function(resolve,reject){if(hasArguments)
            throw new exceptions.InvalidArgument("Arguments not allowed in db.delete()");if(isBeingOpened){dbReadyPromise.then(doDelete)}
        else{doDelete()}
            function doDelete(){db.close();var req=indexedDB.deleteDatabase(dbName);req.onsuccess=wrap(function(){if(!hasNativeGetDatabaseNames){dbNamesDB.dbnames.delete(dbName).catch(nop)}
                resolve()});req.onerror=eventRejectHandler(reject);req.onblocked=fireOnBlocked}})};this.backendDB=function(){return idbdb};this.isOpen=function(){return idbdb!==null};this.hasBeenClosed=function(){return dbOpenError&&(dbOpenError instanceof exceptions.DatabaseClosed)};this.hasFailed=function(){return dbOpenError!==null};this.dynamicallyOpened=function(){return autoSchema};this.name=dbName;props(this,{tables:{get:function(){return keys(allTables).map(function(name){return allTables[name]})}}});this.on=Events(this,"populate","blocked","versionchange",{ready:[promisableChain,nop]});this.on.ready.subscribe=override(this.on.ready.subscribe,function(subscribe){return function(subscriber,bSticky){Dexie.vip(function(){if(openComplete){if(!dbOpenError)
            Promise.resolve().then(subscriber);if(bSticky)
            subscribe(subscriber)}
        else if(onReadyBeingFired){onReadyBeingFired.push(subscriber);if(bSticky)
            subscribe(subscriber)}
        else{subscribe(subscriber);if(!bSticky)
            subscribe(function unsubscribe(){db.on.ready.unsubscribe(subscriber);db.on.ready.unsubscribe(unsubscribe)})}})}});this.transaction=function(){var args=extractTransactionArgs.apply(this,arguments);return this._transaction.apply(this,args)};function extractTransactionArgs(mode,_tableArgs_,scopeFunc){var i=arguments.length;if(i<2)
            throw new exceptions.InvalidArgument("Too few arguments");var args=new Array(i-1);while(--i)
            args[i-1]=arguments[i];scopeFunc=args.pop();var tables=flatten(args);return[mode,tables,scopeFunc]}
        this._transaction=function(mode,tables,scopeFunc){var parentTransaction=PSD.trans;if(!parentTransaction||parentTransaction.db!==db||mode.indexOf('!')!==-1)
            parentTransaction=null;var onlyIfCompatible=mode.indexOf('?')!==-1;mode=mode.replace('!','').replace('?','');try{var storeNames=tables.map(function(table){var storeName=table instanceof Table?table.name:table;if(typeof storeName!=='string')
            throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return storeName});if(mode=="r"||mode==READONLY)
            mode=READONLY;else if(mode=="rw"||mode==READWRITE)
            mode=READWRITE;else throw new exceptions.InvalidArgument("Invalid transaction mode: "+mode);if(parentTransaction){if(parentTransaction.mode===READONLY&&mode===READWRITE){if(onlyIfCompatible){parentTransaction=null}
        else throw new exceptions.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")}
            if(parentTransaction){storeNames.forEach(function(storeName){if(parentTransaction&&parentTransaction.storeNames.indexOf(storeName)===-1){if(onlyIfCompatible){parentTransaction=null}
            else throw new exceptions.SubTransaction("Table "+storeName+" not included in parent transaction.")}})}
            if(onlyIfCompatible&&parentTransaction&&!parentTransaction.active){parentTransaction=null}}}
        catch(e){return parentTransaction?parentTransaction._promise(null,function(_,reject){reject(e)}):rejection(e)}
            return(parentTransaction?parentTransaction._promise(mode,enterTransactionScope,"lock"):PSD.trans?usePSD(PSD.transless,function(){return db._whenReady(enterTransactionScope)}):db._whenReady(enterTransactionScope));function enterTransactionScope(){return Promise.resolve().then(function(){var transless=PSD.transless||PSD;var trans=db._createTransaction(mode,storeNames,globalSchema,parentTransaction);var zoneProps={trans:trans,transless:transless};if(parentTransaction){trans.idbtrans=parentTransaction.idbtrans}
            else{trans.create()}
                if(scopeFunc.constructor===AsyncFunction){incrementExpectedAwaits()}
                var returnValue;var promiseFollowed=Promise.follow(function(){returnValue=scopeFunc.call(trans,trans);if(returnValue){if(returnValue.constructor===NativePromise){var decrementor=decrementExpectedAwaits.bind(null,null);returnValue.then(decrementor,decrementor)}
                else if(typeof returnValue.next==='function'&&typeof returnValue.throw==='function'){returnValue=awaitIterator(returnValue)}}},zoneProps);return(returnValue&&typeof returnValue.then==='function'?Promise.resolve(returnValue).then(function(x){return trans.active?x:rejection(new exceptions.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):promiseFollowed.then(function(){return returnValue})).then(function(x){if(parentTransaction)
                    trans._resolve();return trans._completion.then(function(){return x})}).catch(function(e){trans._reject(e);return rejection(e)})})}};this.table=function(tableName){if(!hasOwn(allTables,tableName)){throw new exceptions.InvalidTable("Table "+tableName+" does not exist")}
            return allTables[tableName]};function Table(name,tableSchema,optionalTrans){this.name=name;this.schema=tableSchema;this._tx=optionalTrans;this.hook=allTables[name]?allTables[name].hook:Events(null,{"creating":[hookCreatingChain,nop],"reading":[pureFunctionChain,mirror],"updating":[hookUpdatingChain,nop],"deleting":[hookDeletingChain,nop]})}
        function BulkErrorHandlerCatchAll(errorList,done,supportHooks){return(supportHooks?hookedEventRejectHandler:eventRejectHandler)(function(e){errorList.push(e);done&&done()})}
        function bulkDelete(idbstore,trans,keysOrTuples,hasDeleteHook,deletingHook){return new Promise(function(resolve,reject){var len=keysOrTuples.length,lastItem=len-1;if(len===0)
            return resolve();if(!hasDeleteHook){for(var i=0;i<len;++i){var req=idbstore.delete(keysOrTuples[i]);req.onerror=eventRejectHandler(reject);if(i===lastItem)
            req.onsuccess=wrap(function(){return resolve()})}}
        else{var hookCtx,errorHandler=hookedEventRejectHandler(reject),successHandler=hookedEventSuccessHandler(null);tryCatch(function(){for(var i=0;i<len;++i){hookCtx={onsuccess:null,onerror:null};var tuple=keysOrTuples[i];deletingHook.call(hookCtx,tuple[0],tuple[1],trans);var req=idbstore.delete(tuple[0]);req._hookCtx=hookCtx;req.onerror=errorHandler;if(i===lastItem)
            req.onsuccess=hookedEventSuccessHandler(resolve);else req.onsuccess=successHandler}},function(err){hookCtx.onerror&&hookCtx.onerror(err);throw err})}})}
        props(Table.prototype,{_trans:function getTransaction(mode,fn,writeLocked){var trans=this._tx||PSD.trans;return trans&&trans.db===db?trans===PSD.trans?trans._promise(mode,fn,writeLocked):newScope(function(){return trans._promise(mode,fn,writeLocked)},{trans:trans,transless:PSD.transless||PSD}):tempTransaction(mode,[this.name],fn)},_idbstore:function getIDBObjectStore(mode,fn,writeLocked){var tableName=this.name;function supplyIdbStore(resolve,reject,trans){if(trans.storeNames.indexOf(tableName)===-1)
                throw new exceptions.NotFound("Table"+tableName+" not part of transaction");return fn(resolve,reject,trans.idbtrans.objectStore(tableName),trans)}
                return this._trans(mode,supplyIdbStore,writeLocked)},get:function(keyOrCrit,cb){if(keyOrCrit&&keyOrCrit.constructor===Object)
                return this.where(keyOrCrit).first(cb);var self=this;return this._idbstore(READONLY,function(resolve,reject,idbstore){var req=idbstore.get(keyOrCrit);req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(){resolve(self.hook.reading.fire(req.result))},reject)}).then(cb)},where:function(indexOrCrit){if(typeof indexOrCrit==='string')
                return new WhereClause(this,indexOrCrit);if(isArray(indexOrCrit))
                return new WhereClause(this,"["+indexOrCrit.join('+')+"]");var keyPaths=keys(indexOrCrit);if(keyPaths.length===1)
                return this.where(keyPaths[0]).equals(indexOrCrit[keyPaths[0]]);var compoundIndex=this.schema.indexes.concat(this.schema.primKey).filter(function(ix){return ix.compound&&keyPaths.every(function(keyPath){return ix.keyPath.indexOf(keyPath)>=0})&&ix.keyPath.every(function(keyPath){return keyPaths.indexOf(keyPath)>=0})})[0];if(compoundIndex&&maxKey!==maxString)
                return this.where(compoundIndex.name).equals(compoundIndex.keyPath.map(function(kp){return indexOrCrit[kp]}));if(!compoundIndex)
                console.warn("The query "+JSON.stringify(indexOrCrit)+" on "+this.name+" would benefit of a "+("compound index ["+keyPaths.join('+')+"]"));var idxByName=this.schema.idxByName;var simpleIndex=keyPaths.reduce(function(r,keyPath){return[r[0]||idxByName[keyPath],r[0]||!idxByName[keyPath]?combine(r[1],function(x){return''+getByKeyPath(x,keyPath)==''+indexOrCrit[keyPath]}):r[1]]},[null,null]);var idx=simpleIndex[0];return idx?this.where(idx.name).equals(indexOrCrit[idx.keyPath]).filter(simpleIndex[1]):compoundIndex?this.filter(simpleIndex[1]):this.where(keyPaths).equals('')},count:function(cb){return this.toCollection().count(cb)},offset:function(offset){return this.toCollection().offset(offset)},limit:function(numRows){return this.toCollection().limit(numRows)},reverse:function(){return this.toCollection().reverse()},filter:function(filterFunction){return this.toCollection().and(filterFunction)},each:function(fn){return this.toCollection().each(fn)},toArray:function(cb){return this.toCollection().toArray(cb)},orderBy:function(index){return new Collection(new WhereClause(this,isArray(index)?"["+index.join('+')+"]":index))},toCollection:function(){return new Collection(new WhereClause(this))},mapToClass:function(constructor,structure){this.schema.mappedClass=constructor;var instanceTemplate=Object.create(constructor.prototype);if(structure){applyStructure(instanceTemplate,structure)}
                this.schema.instanceTemplate=instanceTemplate;var readHook=function(obj){if(!obj)
                    return obj;var res=Object.create(constructor.prototype);for(var m in obj)
                    if(hasOwn(obj,m))
                        try{res[m]=obj[m]}
                        catch(_){}
                    return res};if(this.schema.readHook){this.hook.reading.unsubscribe(this.schema.readHook)}
                this.schema.readHook=readHook;this.hook("reading",readHook);return constructor},defineClass:function(structure){return this.mapToClass(Dexie.defineClass(structure),structure)},bulkDelete:function(keys$$1){if(this.hook.deleting.fire===nop){return this._idbstore(READWRITE,function(resolve,reject,idbstore,trans){resolve(bulkDelete(idbstore,trans,keys$$1,!1,nop))})}
            else{return this.where(':id').anyOf(keys$$1).delete().then(function(){})}},bulkPut:function(objects,keys$$1){var _this=this;return this._idbstore(READWRITE,function(resolve,reject,idbstore){if(!idbstore.keyPath&&!_this.schema.primKey.auto&&!keys$$1)
                throw new exceptions.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(idbstore.keyPath&&keys$$1)
                throw new exceptions.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(keys$$1&&keys$$1.length!==objects.length)
                throw new exceptions.InvalidArgument("Arguments objects and keys must have the same length");if(objects.length===0)
                return resolve();var done=function(result){if(errorList.length===0)
                resolve(result);else reject(new BulkError(_this.name+".bulkPut(): "+errorList.length+" of "+numObjs+" operations failed",errorList))};var req,errorList=[],errorHandler,numObjs=objects.length,table=_this;if(_this.hook.creating.fire===nop&&_this.hook.updating.fire===nop){errorHandler=BulkErrorHandlerCatchAll(errorList);for(var i=0,l=objects.length;i<l;++i){req=keys$$1?idbstore.put(objects[i],keys$$1[i]):idbstore.put(objects[i]);req.onerror=errorHandler}
                req.onerror=BulkErrorHandlerCatchAll(errorList,done);req.onsuccess=eventSuccessHandler(done)}
            else{var effectiveKeys=keys$$1||idbstore.keyPath&&objects.map(function(o){return getByKeyPath(o,idbstore.keyPath)});var objectLookup=effectiveKeys&&arrayToObject(effectiveKeys,function(key,i){return key!=null&&[key,objects[i]]});var promise=!effectiveKeys?table.bulkAdd(objects):table.where(':id').anyOf(effectiveKeys.filter(function(key){return key!=null})).modify(function(){this.value=objectLookup[this.primKey];objectLookup[this.primKey]=null}).catch(ModifyError,function(e){errorList=e.failures}).then(function(){var objsToAdd=[],keysToAdd=keys$$1&&[];for(var i=effectiveKeys.length-1;i>=0;--i){var key=effectiveKeys[i];if(key==null||objectLookup[key]){objsToAdd.push(objects[i]);keys$$1&&keysToAdd.push(key);if(key!=null)
                objectLookup[key]=null}}
                objsToAdd.reverse();keys$$1&&keysToAdd.reverse();return table.bulkAdd(objsToAdd,keysToAdd)}).then(function(lastAddedKey){var lastEffectiveKey=effectiveKeys[effectiveKeys.length-1];return lastEffectiveKey!=null?lastEffectiveKey:lastAddedKey});promise.then(done).catch(BulkError,function(e){errorList=errorList.concat(e.failures);done()}).catch(reject)}},"locked")},bulkAdd:function(objects,keys$$1){var self=this,creatingHook=this.hook.creating.fire;return this._idbstore(READWRITE,function(resolve,reject,idbstore,trans){if(!idbstore.keyPath&&!self.schema.primKey.auto&&!keys$$1)
                throw new exceptions.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(idbstore.keyPath&&keys$$1)
                throw new exceptions.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(keys$$1&&keys$$1.length!==objects.length)
                throw new exceptions.InvalidArgument("Arguments objects and keys must have the same length");if(objects.length===0)
                return resolve();function done(result){if(errorList.length===0)
                resolve(result);else reject(new BulkError(self.name+".bulkAdd(): "+errorList.length+" of "+numObjs+" operations failed",errorList))}
                var req,errorList=[],errorHandler,successHandler,numObjs=objects.length;if(creatingHook!==nop){var keyPath=idbstore.keyPath,hookCtx;errorHandler=BulkErrorHandlerCatchAll(errorList,null,!0);successHandler=hookedEventSuccessHandler(null);tryCatch(function(){for(var i=0,l=objects.length;i<l;++i){hookCtx={onerror:null,onsuccess:null};var key=keys$$1&&keys$$1[i];var obj=objects[i],effectiveKey=keys$$1?key:keyPath?getByKeyPath(obj,keyPath):undefined,keyToUse=creatingHook.call(hookCtx,effectiveKey,obj,trans);if(effectiveKey==null&&keyToUse!=null){if(keyPath){obj=deepClone(obj);setByKeyPath(obj,keyPath,keyToUse)}
                else{key=keyToUse}}
                    req=key!=null?idbstore.add(obj,key):idbstore.add(obj);req._hookCtx=hookCtx;if(i<l-1){req.onerror=errorHandler;if(hookCtx.onsuccess)
                        req.onsuccess=successHandler}}},function(err){hookCtx.onerror&&hookCtx.onerror(err);throw err});req.onerror=BulkErrorHandlerCatchAll(errorList,done,!0);req.onsuccess=hookedEventSuccessHandler(done)}
                else{errorHandler=BulkErrorHandlerCatchAll(errorList);for(var i=0,l=objects.length;i<l;++i){req=keys$$1?idbstore.add(objects[i],keys$$1[i]):idbstore.add(objects[i]);req.onerror=errorHandler}
                    req.onerror=BulkErrorHandlerCatchAll(errorList,done);req.onsuccess=eventSuccessHandler(done)}})},add:function(obj,key){var creatingHook=this.hook.creating.fire;return this._idbstore(READWRITE,function(resolve,reject,idbstore,trans){var hookCtx={onsuccess:null,onerror:null};if(creatingHook!==nop){var effectiveKey=(key!=null)?key:(idbstore.keyPath?getByKeyPath(obj,idbstore.keyPath):undefined);var keyToUse=creatingHook.call(hookCtx,effectiveKey,obj,trans);if(effectiveKey==null&&keyToUse!=null){if(idbstore.keyPath)
                setByKeyPath(obj,idbstore.keyPath,keyToUse);else key=keyToUse}}
                try{var req=key!=null?idbstore.add(obj,key):idbstore.add(obj);req._hookCtx=hookCtx;req.onerror=hookedEventRejectHandler(reject);req.onsuccess=hookedEventSuccessHandler(function(result){var keyPath=idbstore.keyPath;if(keyPath)
                    setByKeyPath(obj,keyPath,result);resolve(result)})}
                catch(e){if(hookCtx.onerror)
                    hookCtx.onerror(e);throw e}})},put:function(obj,key){var _this=this;var creatingHook=this.hook.creating.fire,updatingHook=this.hook.updating.fire;if(creatingHook!==nop||updatingHook!==nop){var keyPath=this.schema.primKey.keyPath;var effectiveKey=(key!==undefined)?key:(keyPath&&getByKeyPath(obj,keyPath));if(effectiveKey==null)
                return this.add(obj);obj=deepClone(obj);return this._trans(READWRITE,function(){return _this.where(":id").equals(effectiveKey).modify(function(){this.value=obj}).then(function(count){return count===0?_this.add(obj,key):effectiveKey})},"locked")}
            else{return this._idbstore(READWRITE,function(resolve,reject,idbstore){var req=key!==undefined?idbstore.put(obj,key):idbstore.put(obj);req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(ev){var keyPath=idbstore.keyPath;if(keyPath)
                setByKeyPath(obj,keyPath,ev.target.result);resolve(req.result)})})}},'delete':function(key){if(this.hook.deleting.subscribers.length){return this.where(":id").equals(key).delete()}
            else{return this._idbstore(READWRITE,function(resolve,reject,idbstore){var req=idbstore.delete(key);req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(){resolve(req.result)})})}},clear:function(){if(this.hook.deleting.subscribers.length){return this.toCollection().delete()}
            else{return this._idbstore(READWRITE,function(resolve,reject,idbstore){var req=idbstore.clear();req.onerror=eventRejectHandler(reject);req.onsuccess=wrap(function(){resolve(req.result)})})}},update:function(keyOrObject,modifications){if(typeof modifications!=='object'||isArray(modifications))
                throw new exceptions.InvalidArgument("Modifications must be an object.");if(typeof keyOrObject==='object'&&!isArray(keyOrObject)){keys(modifications).forEach(function(keyPath){setByKeyPath(keyOrObject,keyPath,modifications[keyPath])});var key=getByKeyPath(keyOrObject,this.schema.primKey.keyPath);if(key===undefined)
                return rejection(new exceptions.InvalidArgument("Given object does not contain its primary key"));return this.where(":id").equals(key).modify(modifications)}
            else{return this.where(":id").equals(keyOrObject).modify(modifications)}}});function Transaction(mode,storeNames,dbschema,parent){var _this=this;this.db=db;this.mode=mode;this.storeNames=storeNames;this.idbtrans=null;this.on=Events(this,"complete","error","abort");this.parent=parent||null;this.active=!0;this._reculock=0;this._blockedFuncs=[];this._resolve=null;this._reject=null;this._waitingFor=null;this._waitingQueue=null;this._spinCount=0;this._completion=new Promise(function(resolve,reject){_this._resolve=resolve;_this._reject=reject});this._completion.then(function(){_this.active=!1;_this.on.complete.fire()},function(e){var wasActive=_this.active;_this.active=!1;_this.on.error.fire(e);_this.parent?_this.parent._reject(e):wasActive&&_this.idbtrans&&_this.idbtrans.abort();return rejection(e)})}
        props(Transaction.prototype,{_lock:function(){assert(!PSD.global);++this._reculock;if(this._reculock===1&&!PSD.global)
                PSD.lockOwnerFor=this;return this},_unlock:function(){assert(!PSD.global);if(--this._reculock===0){if(!PSD.global)
                PSD.lockOwnerFor=null;while(this._blockedFuncs.length>0&&!this._locked()){var fnAndPSD=this._blockedFuncs.shift();try{usePSD(fnAndPSD[1],fnAndPSD[0])}
            catch(e){}}}
                return this},_locked:function(){return this._reculock&&PSD.lockOwnerFor!==this},create:function(idbtrans){var _this=this;if(!this.mode)
                return this;assert(!this.idbtrans);if(!idbtrans&&!idbdb){switch(dbOpenError&&dbOpenError.name){case "DatabaseClosedError":throw new exceptions.DatabaseClosed(dbOpenError);case "MissingAPIError":throw new exceptions.MissingAPI(dbOpenError.message,dbOpenError);default:throw new exceptions.OpenFailed(dbOpenError)}}
                if(!this.active)
                    throw new exceptions.TransactionInactive();assert(this._completion._state===null);idbtrans=this.idbtrans=idbtrans||idbdb.transaction(safariMultiStoreFix(this.storeNames),this.mode);idbtrans.onerror=wrap(function(ev){preventDefault(ev);_this._reject(idbtrans.error)});idbtrans.onabort=wrap(function(ev){preventDefault(ev);_this.active&&_this._reject(new exceptions.Abort(idbtrans.error));_this.active=!1;_this.on("abort").fire(ev)});idbtrans.oncomplete=wrap(function(){_this.active=!1;_this._resolve()});return this},_promise:function(mode,fn,bWriteLock){var _this=this;if(mode===READWRITE&&this.mode!==READWRITE)
                return rejection(new exceptions.ReadOnly("Transaction is readonly"));if(!this.active)
                return rejection(new exceptions.TransactionInactive());if(this._locked()){return new Promise(function(resolve,reject){_this._blockedFuncs.push([function(){_this._promise(mode,fn,bWriteLock).then(resolve,reject)},PSD])})}
            else if(bWriteLock){return newScope(function(){var p=new Promise(function(resolve,reject){_this._lock();var rv=fn(resolve,reject,_this);if(rv&&rv.then)
                rv.then(resolve,reject)});p.finally(function(){return _this._unlock()});p._lib=!0;return p})}
            else{var p=new Promise(function(resolve,reject){var rv=fn(resolve,reject,_this);if(rv&&rv.then)
                rv.then(resolve,reject)});p._lib=!0;return p}},_root:function(){return this.parent?this.parent._root():this},waitFor:function(promise){var root=this._root();promise=Promise.resolve(promise);if(root._waitingFor){root._waitingFor=root._waitingFor.then(function(){return promise})}
            else{root._waitingFor=promise;root._waitingQueue=[];var store=root.idbtrans.objectStore(root.storeNames[0]);(function spin(){++root._spinCount;while(root._waitingQueue.length)(root._waitingQueue.shift())();if(root._waitingFor)
                store.get(-Infinity).onsuccess=spin}())}
                var currentWaitPromise=root._waitingFor;return new Promise(function(resolve,reject){promise.then(function(res){return root._waitingQueue.push(wrap(resolve.bind(null,res)))},function(err){return root._waitingQueue.push(wrap(reject.bind(null,err)))}).finally(function(){if(root._waitingFor===currentWaitPromise){root._waitingFor=null}})})},abort:function(){this.active&&this._reject(new exceptions.Abort());this.active=!1},tables:{get:deprecated("Transaction.tables",function(){return allTables})},table:function(name){var table=db.table(name);return new Table(name,table.schema,this)}});function WhereClause(table,index,orCollection){this._ctx={table:table,index:index===":id"?null:index,or:orCollection}}
        props(WhereClause.prototype,function(){function fail(collectionOrWhereClause,err,T){var collection=collectionOrWhereClause instanceof WhereClause?new Collection(collectionOrWhereClause):collectionOrWhereClause;collection._ctx.error=T?new T(err):new TypeError(err);return collection}
            function emptyCollection(whereClause){return new Collection(whereClause,function(){return IDBKeyRange.only("")}).limit(0)}
            function upperFactory(dir){return dir==="next"?function(s){return s.toUpperCase()}:function(s){return s.toLowerCase()}}
            function lowerFactory(dir){return dir==="next"?function(s){return s.toLowerCase()}:function(s){return s.toUpperCase()}}
            function nextCasing(key,lowerKey,upperNeedle,lowerNeedle,cmp,dir){var length=Math.min(key.length,lowerNeedle.length);var llp=-1;for(var i=0;i<length;++i){var lwrKeyChar=lowerKey[i];if(lwrKeyChar!==lowerNeedle[i]){if(cmp(key[i],upperNeedle[i])<0)
                return key.substr(0,i)+upperNeedle[i]+upperNeedle.substr(i+1);if(cmp(key[i],lowerNeedle[i])<0)
                return key.substr(0,i)+lowerNeedle[i]+upperNeedle.substr(i+1);if(llp>=0)
                return key.substr(0,llp)+lowerKey[llp]+upperNeedle.substr(llp+1);return null}
                if(cmp(key[i],lwrKeyChar)<0)
                    llp=i}
                if(length<lowerNeedle.length&&dir==="next")
                    return key+upperNeedle.substr(key.length);if(length<key.length&&dir==="prev")
                    return key.substr(0,upperNeedle.length);return(llp<0?null:key.substr(0,llp)+lowerNeedle[llp]+upperNeedle.substr(llp+1))}
            function addIgnoreCaseAlgorithm(whereClause,match,needles,suffix){var upper,lower,compare,upperNeedles,lowerNeedles,direction,nextKeySuffix,needlesLen=needles.length;if(!needles.every(function(s){return typeof s==='string'})){return fail(whereClause,STRING_EXPECTED)}
                function initDirection(dir){upper=upperFactory(dir);lower=lowerFactory(dir);compare=(dir==="next"?simpleCompare:simpleCompareReverse);var needleBounds=needles.map(function(needle){return{lower:lower(needle),upper:upper(needle)}}).sort(function(a,b){return compare(a.lower,b.lower)});upperNeedles=needleBounds.map(function(nb){return nb.upper});lowerNeedles=needleBounds.map(function(nb){return nb.lower});direction=dir;nextKeySuffix=(dir==="next"?"":suffix)}
                initDirection("next");var c=new Collection(whereClause,function(){return IDBKeyRange.bound(upperNeedles[0],lowerNeedles[needlesLen-1]+suffix)});c._ondirectionchange=function(direction){initDirection(direction)};var firstPossibleNeedle=0;c._addAlgorithm(function(cursor,advance,resolve){var key=cursor.key;if(typeof key!=='string')
                    return!1;var lowerKey=lower(key);if(match(lowerKey,lowerNeedles,firstPossibleNeedle)){return!0}
                else{var lowestPossibleCasing=null;for(var i=firstPossibleNeedle;i<needlesLen;++i){var casing=nextCasing(key,lowerKey,upperNeedles[i],lowerNeedles[i],compare,direction);if(casing===null&&lowestPossibleCasing===null)
                    firstPossibleNeedle=i+1;else if(lowestPossibleCasing===null||compare(lowestPossibleCasing,casing)>0){lowestPossibleCasing=casing}}
                    if(lowestPossibleCasing!==null){advance(function(){cursor.continue(lowestPossibleCasing+nextKeySuffix)})}
                    else{advance(resolve)}
                    return!1}});return c}
            return{between:function(lower,upper,includeLower,includeUpper){includeLower=includeLower!==!1;includeUpper=includeUpper===!0;try{if((cmp(lower,upper)>0)||(cmp(lower,upper)===0&&(includeLower||includeUpper)&&!(includeLower&&includeUpper)))
                    return emptyCollection(this);return new Collection(this,function(){return IDBKeyRange.bound(lower,upper,!includeLower,!includeUpper)})}
                catch(e){return fail(this,INVALID_KEY_ARGUMENT)}},equals:function(value){return new Collection(this,function(){return IDBKeyRange.only(value)})},above:function(value){return new Collection(this,function(){return IDBKeyRange.lowerBound(value,!0)})},aboveOrEqual:function(value){return new Collection(this,function(){return IDBKeyRange.lowerBound(value)})},below:function(value){return new Collection(this,function(){return IDBKeyRange.upperBound(value,!0)})},belowOrEqual:function(value){return new Collection(this,function(){return IDBKeyRange.upperBound(value)})},startsWith:function(str){if(typeof str!=='string')
                    return fail(this,STRING_EXPECTED);return this.between(str,str+maxString,!0,!0)},startsWithIgnoreCase:function(str){if(str==="")
                    return this.startsWith(str);return addIgnoreCaseAlgorithm(this,function(x,a){return x.indexOf(a[0])===0},[str],maxString)},equalsIgnoreCase:function(str){return addIgnoreCaseAlgorithm(this,function(x,a){return x===a[0]},[str],"")},anyOfIgnoreCase:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(set.length===0)
                    return emptyCollection(this);return addIgnoreCaseAlgorithm(this,function(x,a){return a.indexOf(x)!==-1},set,"")},startsWithAnyOfIgnoreCase:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(set.length===0)
                    return emptyCollection(this);return addIgnoreCaseAlgorithm(this,function(x,a){return a.some(function(n){return x.indexOf(n)===0})},set,maxString)},anyOf:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);var compare=ascending;try{set.sort(compare)}
                catch(e){return fail(this,INVALID_KEY_ARGUMENT)}
                    if(set.length===0)
                        return emptyCollection(this);var c=new Collection(this,function(){return IDBKeyRange.bound(set[0],set[set.length-1])});c._ondirectionchange=function(direction){compare=(direction==="next"?ascending:descending);set.sort(compare)};var i=0;c._addAlgorithm(function(cursor,advance,resolve){var key=cursor.key;while(compare(key,set[i])>0){++i;if(i===set.length){advance(resolve);return!1}}
                        if(compare(key,set[i])===0){return!0}
                        else{advance(function(){cursor.continue(set[i])});return!1}});return c},notEqual:function(value){return this.inAnyRange([[minKey,value],[value,maxKey]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(set.length===0)
                    return new Collection(this);try{set.sort(ascending)}
                catch(e){return fail(this,INVALID_KEY_ARGUMENT)}
                    var ranges=set.reduce(function(res,val){return res?res.concat([[res[res.length-1][1],val]]):[[minKey,val]]},null);ranges.push([set[set.length-1],maxKey]);return this.inAnyRange(ranges,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(ranges,options){if(ranges.length===0)
                    return emptyCollection(this);if(!ranges.every(function(range){return range[0]!==undefined&&range[1]!==undefined&&ascending(range[0],range[1])<=0})){return fail(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",exceptions.InvalidArgument)}
                    var includeLowers=!options||options.includeLowers!==!1;var includeUppers=options&&options.includeUppers===!0;function addRange(ranges,newRange){for(var i=0,l=ranges.length;i<l;++i){var range=ranges[i];if(cmp(newRange[0],range[1])<0&&cmp(newRange[1],range[0])>0){range[0]=min(range[0],newRange[0]);range[1]=max(range[1],newRange[1]);break}}
                        if(i===l)
                            ranges.push(newRange);return ranges}
                    var sortDirection=ascending;function rangeSorter(a,b){return sortDirection(a[0],b[0])}
                    var set;try{set=ranges.reduce(addRange,[]);set.sort(rangeSorter)}
                    catch(ex){return fail(this,INVALID_KEY_ARGUMENT)}
                    var i=0;var keyIsBeyondCurrentEntry=includeUppers?function(key){return ascending(key,set[i][1])>0}:function(key){return ascending(key,set[i][1])>=0};var keyIsBeforeCurrentEntry=includeLowers?function(key){return descending(key,set[i][0])>0}:function(key){return descending(key,set[i][0])>=0};function keyWithinCurrentRange(key){return!keyIsBeyondCurrentEntry(key)&&!keyIsBeforeCurrentEntry(key)}
                    var checkKey=keyIsBeyondCurrentEntry;var c=new Collection(this,function(){return IDBKeyRange.bound(set[0][0],set[set.length-1][1],!includeLowers,!includeUppers)});c._ondirectionchange=function(direction){if(direction==="next"){checkKey=keyIsBeyondCurrentEntry;sortDirection=ascending}
                    else{checkKey=keyIsBeforeCurrentEntry;sortDirection=descending}
                        set.sort(rangeSorter)};c._addAlgorithm(function(cursor,advance,resolve){var key=cursor.key;while(checkKey(key)){++i;if(i===set.length){advance(resolve);return!1}}
                        if(keyWithinCurrentRange(key)){return!0}
                        else if(cmp(key,set[i][1])===0||cmp(key,set[i][0])===0){return!1}
                        else{advance(function(){if(sortDirection===ascending)
                            cursor.continue(set[i][0]);else cursor.continue(set[i][1])});return!1}});return c},startsWithAnyOf:function(){var set=getArrayOf.apply(NO_CHAR_ARRAY,arguments);if(!set.every(function(s){return typeof s==='string'})){return fail(this,"startsWithAnyOf() only works with strings")}
                    if(set.length===0)
                        return emptyCollection(this);return this.inAnyRange(set.map(function(str){return[str,str+maxString]}))}}});function Collection(whereClause,keyRangeGenerator){var keyRange=null,error=null;if(keyRangeGenerator)
            try{keyRange=keyRangeGenerator()}
            catch(ex){error=ex}
            var whereCtx=whereClause._ctx,table=whereCtx.table;this._ctx={table:table,index:whereCtx.index,isPrimKey:(!whereCtx.index||(table.schema.primKey.keyPath&&whereCtx.index===table.schema.primKey.name)),range:keyRange,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:Infinity,error:error,or:whereCtx.or,valueMapper:table.hook.reading.fire}}
        function isPlainKeyRange(ctx,ignoreLimitFilter){return!(ctx.filter||ctx.algorithm||ctx.or)&&(ignoreLimitFilter?ctx.justLimit:!ctx.replayFilter)}
        props(Collection.prototype,function(){function addFilter(ctx,fn){ctx.filter=combine(ctx.filter,fn)}
            function addReplayFilter(ctx,factory,isLimitFilter){var curr=ctx.replayFilter;ctx.replayFilter=curr?function(){return combine(curr(),factory())}:factory;ctx.justLimit=isLimitFilter&&!curr}
            function addMatchFilter(ctx,fn){ctx.isMatch=combine(ctx.isMatch,fn)}
            function getIndexOrStore(ctx,store){if(ctx.isPrimKey)
                return store;var indexSpec=ctx.table.schema.idxByName[ctx.index];if(!indexSpec)
                throw new exceptions.Schema("KeyPath "+ctx.index+" on object store "+store.name+" is not indexed");return store.index(indexSpec.name)}
            function openCursor(ctx,store){var idxOrStore=getIndexOrStore(ctx,store);return ctx.keysOnly&&'openKeyCursor' in idxOrStore?idxOrStore.openKeyCursor(ctx.range||null,ctx.dir+ctx.unique):idxOrStore.openCursor(ctx.range||null,ctx.dir+ctx.unique)}
            function iter(ctx,fn,resolve,reject,idbstore){var filter=ctx.replayFilter?combine(ctx.filter,ctx.replayFilter()):ctx.filter;if(!ctx.or){iterate(openCursor(ctx,idbstore),combine(ctx.algorithm,filter),fn,resolve,reject,!ctx.keysOnly&&ctx.valueMapper)}
            else(function(){var set={};var resolved=0;function resolveboth(){if(++resolved===2)
                    resolve()}
                    function union(item,cursor,advance){if(!filter||filter(cursor,advance,resolveboth,reject)){var primaryKey=cursor.primaryKey;var key=''+primaryKey;if(key==='[object ArrayBuffer]')
                        key=''+new Uint8Array(primaryKey);if(!hasOwn(set,key)){set[key]=!0;fn(item,cursor,advance)}}}
                    ctx.or._iterate(union,resolveboth,reject,idbstore);iterate(openCursor(ctx,idbstore),ctx.algorithm,union,resolveboth,reject,!ctx.keysOnly&&ctx.valueMapper)})()}
            return{_read:function(fn,cb){var ctx=this._ctx;return ctx.error?ctx.table._trans(null,rejection.bind(null,ctx.error)):ctx.table._idbstore(READONLY,fn).then(cb)},_write:function(fn){var ctx=this._ctx;return ctx.error?ctx.table._trans(null,rejection.bind(null,ctx.error)):ctx.table._idbstore(READWRITE,fn,"locked")},_addAlgorithm:function(fn){var ctx=this._ctx;ctx.algorithm=combine(ctx.algorithm,fn)},_iterate:function(fn,resolve,reject,idbstore){return iter(this._ctx,fn,resolve,reject,idbstore)},clone:function(props$$1){var rv=Object.create(this.constructor.prototype),ctx=Object.create(this._ctx);if(props$$1)
                    extend(ctx,props$$1);rv._ctx=ctx;return rv},raw:function(){this._ctx.valueMapper=null;return this},each:function(fn){var ctx=this._ctx;return this._read(function(resolve,reject,idbstore){iter(ctx,fn,resolve,reject,idbstore)})},count:function(cb){var ctx=this._ctx;if(isPlainKeyRange(ctx,!0)){return this._read(function(resolve,reject,idbstore){var idx=getIndexOrStore(ctx,idbstore);var req=(ctx.range?idx.count(ctx.range):idx.count());req.onerror=eventRejectHandler(reject);req.onsuccess=function(e){resolve(Math.min(e.target.result,ctx.limit))}},cb)}
                else{var count=0;return this._read(function(resolve,reject,idbstore){iter(ctx,function(){++count;return!1},function(){resolve(count)},reject,idbstore)},cb)}},sortBy:function(keyPath,cb){var parts=keyPath.split('.').reverse(),lastPart=parts[0],lastIndex=parts.length-1;function getval(obj,i){if(i)
                    return getval(obj[parts[i]],i-1);return obj[lastPart]}
                    var order=this._ctx.dir==="next"?1:-1;function sorter(a,b){var aVal=getval(a,lastIndex),bVal=getval(b,lastIndex);return aVal<bVal?-order:aVal>bVal?order:0}
                    return this.toArray(function(a){return a.sort(sorter)}).then(cb)},toArray:function(cb){var ctx=this._ctx;return this._read(function(resolve,reject,idbstore){if(hasGetAll&&ctx.dir==='next'&&isPlainKeyRange(ctx,!0)&&ctx.limit>0){var readingHook=ctx.table.hook.reading.fire;var idxOrStore=getIndexOrStore(ctx,idbstore);var req=ctx.limit<Infinity?idxOrStore.getAll(ctx.range,ctx.limit):idxOrStore.getAll(ctx.range);req.onerror=eventRejectHandler(reject);req.onsuccess=readingHook===mirror?eventSuccessHandler(resolve):eventSuccessHandler(function(res){try{resolve(res.map(readingHook))}
                catch(e){reject(e)}})}
                else{var a=[];iter(ctx,function(item){a.push(item)},function arrayComplete(){resolve(a)},reject,idbstore)}},cb)},offset:function(offset){var ctx=this._ctx;if(offset<=0)
                    return this;ctx.offset+=offset;if(isPlainKeyRange(ctx)){addReplayFilter(ctx,function(){var offsetLeft=offset;return function(cursor,advance){if(offsetLeft===0)
                    return!0;if(offsetLeft===1){--offsetLeft;return!1}
                    advance(function(){cursor.advance(offsetLeft);offsetLeft=0});return!1}})}
                else{addReplayFilter(ctx,function(){var offsetLeft=offset;return function(){return(--offsetLeft<0)}})}
                    return this},limit:function(numRows){this._ctx.limit=Math.min(this._ctx.limit,numRows);addReplayFilter(this._ctx,function(){var rowsLeft=numRows;return function(cursor,advance,resolve){if(--rowsLeft<=0)
                    advance(resolve);return rowsLeft>=0}},!0);return this},until:function(filterFunction,bIncludeStopEntry){addFilter(this._ctx,function(cursor,advance,resolve){if(filterFunction(cursor.value)){advance(resolve);return bIncludeStopEntry}
                else{return!0}});return this},first:function(cb){return this.limit(1).toArray(function(a){return a[0]}).then(cb)},last:function(cb){return this.reverse().first(cb)},filter:function(filterFunction){addFilter(this._ctx,function(cursor){return filterFunction(cursor.value)});addMatchFilter(this._ctx,filterFunction);return this},and:function(filterFunction){return this.filter(filterFunction)},or:function(indexName){return new WhereClause(this._ctx.table,indexName,this)},reverse:function(){this._ctx.dir=(this._ctx.dir==="prev"?"next":"prev");if(this._ondirectionchange)
                    this._ondirectionchange(this._ctx.dir);return this},desc:function(){return this.reverse()},eachKey:function(cb){var ctx=this._ctx;ctx.keysOnly=!ctx.isMatch;return this.each(function(val,cursor){cb(cursor.key,cursor)})},eachUniqueKey:function(cb){this._ctx.unique="unique";return this.eachKey(cb)},eachPrimaryKey:function(cb){var ctx=this._ctx;ctx.keysOnly=!ctx.isMatch;return this.each(function(val,cursor){cb(cursor.primaryKey,cursor)})},keys:function(cb){var ctx=this._ctx;ctx.keysOnly=!ctx.isMatch;var a=[];return this.each(function(item,cursor){a.push(cursor.key)}).then(function(){return a}).then(cb)},primaryKeys:function(cb){var ctx=this._ctx;if(hasGetAll&&ctx.dir==='next'&&isPlainKeyRange(ctx,!0)&&ctx.limit>0){return this._read(function(resolve,reject,idbstore){var idxOrStore=getIndexOrStore(ctx,idbstore);var req=ctx.limit<Infinity?idxOrStore.getAllKeys(ctx.range,ctx.limit):idxOrStore.getAllKeys(ctx.range);req.onerror=eventRejectHandler(reject);req.onsuccess=eventSuccessHandler(resolve)}).then(cb)}
                    ctx.keysOnly=!ctx.isMatch;var a=[];return this.each(function(item,cursor){a.push(cursor.primaryKey)}).then(function(){return a}).then(cb)},uniqueKeys:function(cb){this._ctx.unique="unique";return this.keys(cb)},firstKey:function(cb){return this.limit(1).keys(function(a){return a[0]}).then(cb)},lastKey:function(cb){return this.reverse().firstKey(cb)},distinct:function(){var ctx=this._ctx,idx=ctx.index&&ctx.table.schema.idxByName[ctx.index];if(!idx||!idx.multi)
                    return this;var set={};addFilter(this._ctx,function(cursor){var strKey=cursor.primaryKey.toString();var found=hasOwn(set,strKey);set[strKey]=!0;return!found});return this},modify:function(changes){var self=this,ctx=this._ctx,hook=ctx.table.hook,updatingHook=hook.updating.fire,deletingHook=hook.deleting.fire;return this._write(function(resolve,reject,idbstore,trans){var modifyer;if(typeof changes==='function'){if(updatingHook===nop&&deletingHook===nop){modifyer=changes}
                else{modifyer=function(item){var origItem=deepClone(item);if(changes.call(this,item,this)===!1)
                    return!1;if(!hasOwn(this,"value")){deletingHook.call(this,this.primKey,item,trans)}
                else{var objectDiff=getObjectDiff(origItem,this.value);var additionalChanges=updatingHook.call(this,objectDiff,this.primKey,origItem,trans);if(additionalChanges){item=this.value;keys(additionalChanges).forEach(function(keyPath){setByKeyPath(item,keyPath,additionalChanges[keyPath])})}}}}}
                else if(updatingHook===nop){var keyPaths=keys(changes);var numKeys=keyPaths.length;modifyer=function(item){var anythingModified=!1;for(var i=0;i<numKeys;++i){var keyPath=keyPaths[i],val=changes[keyPath];if(getByKeyPath(item,keyPath)!==val){setByKeyPath(item,keyPath,val);anythingModified=!0}}
                    return anythingModified}}
                else{var origChanges=changes;changes=shallowClone(origChanges);modifyer=function(item){var anythingModified=!1;var additionalChanges=updatingHook.call(this,changes,this.primKey,deepClone(item),trans);if(additionalChanges)
                    extend(changes,additionalChanges);keys(changes).forEach(function(keyPath){var val=changes[keyPath];if(getByKeyPath(item,keyPath)!==val){setByKeyPath(item,keyPath,val);anythingModified=!0}});if(additionalChanges)
                    changes=shallowClone(origChanges);return anythingModified}}
                    var count=0;var successCount=0;var iterationComplete=!1;var failures=[];var failKeys=[];var currentKey=null;function modifyItem(item,cursor){currentKey=cursor.primaryKey;var thisContext={primKey:cursor.primaryKey,value:item,onsuccess:null,onerror:null};function onerror(e){failures.push(e);failKeys.push(thisContext.primKey);checkFinished();return!0}
                        if(modifyer.call(thisContext,item,thisContext)!==!1){var bDelete=!hasOwn(thisContext,"value");++count;tryCatch(function(){var req=(bDelete?cursor.delete():cursor.update(thisContext.value));req._hookCtx=thisContext;req.onerror=hookedEventRejectHandler(onerror);req.onsuccess=hookedEventSuccessHandler(function(){++successCount;checkFinished()})},onerror)}
                        else if(thisContext.onsuccess){thisContext.onsuccess(thisContext.value)}}
                    function doReject(e){if(e){failures.push(e);failKeys.push(currentKey)}
                        return reject(new ModifyError("Error modifying one or more objects",failures,successCount,failKeys))}
                    function checkFinished(){if(iterationComplete&&successCount+failures.length===count){if(failures.length>0)
                        doReject();else resolve(successCount)}}
                    self.clone().raw()._iterate(modifyItem,function(){iterationComplete=!0;checkFinished()},doReject,idbstore)})},'delete':function(){var _this=this;var ctx=this._ctx,range=ctx.range,deletingHook=ctx.table.hook.deleting.fire,hasDeleteHook=deletingHook!==nop;if(!hasDeleteHook&&isPlainKeyRange(ctx)&&((ctx.isPrimKey&&!hangsOnDeleteLargeKeyRange)||!range)){return this._write(function(resolve,reject,idbstore){var onerror=eventRejectHandler(reject),countReq=(range?idbstore.count(range):idbstore.count());countReq.onerror=onerror;countReq.onsuccess=function(){var count=countReq.result;tryCatch(function(){var delReq=(range?idbstore.delete(range):idbstore.clear());delReq.onerror=onerror;delReq.onsuccess=function(){return resolve(count)}},function(err){return reject(err)})}})}
                    var CHUNKSIZE=hasDeleteHook?2000:10000;return this._write(function(resolve,reject,idbstore,trans){var totalCount=0;var collection=_this.clone({keysOnly:!ctx.isMatch&&!hasDeleteHook}).distinct().limit(CHUNKSIZE).raw();var keysOrTuples=[];var nextChunk=function(){return collection.each(hasDeleteHook?function(val,cursor){keysOrTuples.push([cursor.primaryKey,cursor.value])}:function(val,cursor){keysOrTuples.push(cursor.primaryKey)}).then(function(){hasDeleteHook?keysOrTuples.sort(function(a,b){return ascending(a[0],b[0])}):keysOrTuples.sort(ascending);return bulkDelete(idbstore,trans,keysOrTuples,hasDeleteHook,deletingHook)}).then(function(){var count=keysOrTuples.length;totalCount+=count;keysOrTuples=[];return count<CHUNKSIZE?totalCount:nextChunk()})};resolve(nextChunk())})}}});function lowerVersionFirst(a,b){return a._cfg.version-b._cfg.version}
        function setApiOnPlace(objs,tableNames,dbschema){tableNames.forEach(function(tableName){var schema=dbschema[tableName];objs.forEach(function(obj){if(!(tableName in obj)){if(obj===Transaction.prototype||obj instanceof Transaction){setProp(obj,tableName,{get:function(){return this.table(tableName)}})}
        else{obj[tableName]=new Table(tableName,schema)}}})})}
        function removeTablesApi(objs){objs.forEach(function(obj){for(var key in obj){if(obj[key]instanceof Table)
            delete obj[key]}})}
        function iterate(req,filter,fn,resolve,reject,valueMapper){var mappedFn=valueMapper?function(x,c,a){return fn(valueMapper(x),c,a)}:fn;var wrappedFn=wrap(mappedFn,reject);if(!req.onerror)
            req.onerror=eventRejectHandler(reject);if(filter){req.onsuccess=trycatcher(function filter_record(){var cursor=req.result;if(cursor){var c=function(){cursor.continue()};if(filter(cursor,function(advancer){c=advancer},resolve,reject))
            wrappedFn(cursor.value,cursor,function(advancer){c=advancer});c()}
        else{resolve()}},reject)}
        else{req.onsuccess=trycatcher(function filter_record(){var cursor=req.result;if(cursor){var c=function(){cursor.continue()};wrappedFn(cursor.value,cursor,function(advancer){c=advancer});c()}
        else{resolve()}},reject)}}
        function parseIndexSyntax(indexes){var rv=[];indexes.split(',').forEach(function(index){index=index.trim();var name=index.replace(/([&*]|\+\+)/g,"");var keyPath=/^\[/.test(name)?name.match(/^\[(.*)\]$/)[1].split('+'):name;rv.push(new IndexSpec(name,keyPath||null,/\&/.test(index),/\*/.test(index),/\+\+/.test(index),isArray(keyPath),/\./.test(index)))});return rv}
        function cmp(key1,key2){return indexedDB.cmp(key1,key2)}
        function min(a,b){return cmp(a,b)<0?a:b}
        function max(a,b){return cmp(a,b)>0?a:b}
        function ascending(a,b){return indexedDB.cmp(a,b)}
        function descending(a,b){return indexedDB.cmp(b,a)}
        function simpleCompare(a,b){return a<b?-1:a===b?0:1}
        function simpleCompareReverse(a,b){return a>b?-1:a===b?0:1}
        function combine(filter1,filter2){return filter1?filter2?function(){return filter1.apply(this,arguments)&&filter2.apply(this,arguments)}:filter1:filter2}
        function readGlobalSchema(){db.verno=idbdb.version/10;db._dbSchema=globalSchema={};dbStoreNames=slice(idbdb.objectStoreNames,0);if(dbStoreNames.length===0)
            return;var trans=idbdb.transaction(safariMultiStoreFix(dbStoreNames),'readonly');dbStoreNames.forEach(function(storeName){var store=trans.objectStore(storeName),keyPath=store.keyPath,dotted=keyPath&&typeof keyPath==='string'&&keyPath.indexOf('.')!==-1;var primKey=new IndexSpec(keyPath,keyPath||"",!1,!1,!!store.autoIncrement,keyPath&&typeof keyPath!=='string',dotted);var indexes=[];for(var j=0;j<store.indexNames.length;++j){var idbindex=store.index(store.indexNames[j]);keyPath=idbindex.keyPath;dotted=keyPath&&typeof keyPath==='string'&&keyPath.indexOf('.')!==-1;var index=new IndexSpec(idbindex.name,keyPath,!!idbindex.unique,!!idbindex.multiEntry,!1,keyPath&&typeof keyPath!=='string',dotted);indexes.push(index)}
            globalSchema[storeName]=new TableSchema(storeName,primKey,indexes,{})});setApiOnPlace([allTables],keys(globalSchema),globalSchema)}
        function adjustToExistingIndexNames(schema,idbtrans){var storeNames=idbtrans.db.objectStoreNames;for(var i=0;i<storeNames.length;++i){var storeName=storeNames[i];var store=idbtrans.objectStore(storeName);hasGetAll='getAll' in store;for(var j=0;j<store.indexNames.length;++j){var indexName=store.indexNames[j];var keyPath=store.index(indexName).keyPath;var dexieName=typeof keyPath==='string'?keyPath:"["+slice(keyPath).join('+')+"]";if(schema[storeName]){var indexSpec=schema[storeName].idxByName[dexieName];if(indexSpec)
            indexSpec.name=indexName}}}
            if(/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&_global.WorkerGlobalScope&&_global instanceof _global.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604){hasGetAll=!1}}
        function fireOnBlocked(ev){db.on("blocked").fire(ev);connections.filter(function(c){return c.name===db.name&&c!==db&&!c._vcFired}).map(function(c){return c.on("versionchange").fire(ev)})}
        extend(this,{Collection:Collection,Table:Table,Transaction:Transaction,Version:Version,WhereClause:WhereClause});init();addons.forEach(function(fn){fn(db)})}
    function parseType(type){if(typeof type==='function'){return new type()}
    else if(isArray(type)){return[parseType(type[0])]}
    else if(type&&typeof type==='object'){var rv={};applyStructure(rv,type);return rv}
    else{return type}}
    function applyStructure(obj,structure){keys(structure).forEach(function(member){var value=parseType(structure[member]);obj[member]=value});return obj}
    function hookedEventSuccessHandler(resolve){return wrap(function(event){var req=event.target,ctx=req._hookCtx,result=ctx.value||req.result,hookSuccessHandler=ctx&&ctx.onsuccess;hookSuccessHandler&&hookSuccessHandler(result);resolve&&resolve(result)},resolve)}
    function eventRejectHandler(reject){return wrap(function(event){preventDefault(event);reject(event.target.error);return!1})}
    function eventSuccessHandler(resolve){return wrap(function(event){resolve(event.target.result)})}
    function hookedEventRejectHandler(reject){return wrap(function(event){var req=event.target,err=req.error,ctx=req._hookCtx,hookErrorHandler=ctx&&ctx.onerror;hookErrorHandler&&hookErrorHandler(err);preventDefault(event);reject(err);return!1})}
    function preventDefault(event){if(event.stopPropagation)
        event.stopPropagation();if(event.preventDefault)
        event.preventDefault()}
    function awaitIterator(iterator){var callNext=function(result){return iterator.next(result)},doThrow=function(error){return iterator.throw(error)},onSuccess=step(callNext),onError=step(doThrow);function step(getNext){return function(val){var next=getNext(val),value=next.value;return next.done?value:(!value||typeof value.then!=='function'?isArray(value)?Promise.all(value).then(onSuccess,onError):onSuccess(value):value.then(onSuccess,onError))}}
        return step(callNext)()}
    function IndexSpec(name,keyPath,unique,multi,auto,compound,dotted){this.name=name;this.keyPath=keyPath;this.unique=unique;this.multi=multi;this.auto=auto;this.compound=compound;this.dotted=dotted;var keyPathSrc=typeof keyPath==='string'?keyPath:keyPath&&('['+[].join.call(keyPath,'+')+']');this.src=(unique?'&':'')+(multi?'*':'')+(auto?"++":"")+keyPathSrc}
    function TableSchema(name,primKey,indexes,instanceTemplate){this.name=name;this.primKey=primKey||new IndexSpec();this.indexes=indexes||[new IndexSpec()];this.instanceTemplate=instanceTemplate;this.mappedClass=null;this.idxByName=arrayToObject(indexes,function(index){return[index.name,index]})}
    function safariMultiStoreFix(storeNames){return storeNames.length===1?storeNames[0]:storeNames}
    function getNativeGetDatabaseNamesFn(indexedDB){var fn=indexedDB&&(indexedDB.getDatabaseNames||indexedDB.webkitGetDatabaseNames);return fn&&fn.bind(indexedDB)}
    props(Dexie,fullNameExceptions);props(Dexie,{delete:function(databaseName){var db=new Dexie(databaseName),promise=db.delete();promise.onblocked=function(fn){db.on("blocked",fn);return this};return promise},exists:function(name){return new Dexie(name).open().then(function(db){db.close();return!0}).catch(Dexie.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(cb){var getDatabaseNames=getNativeGetDatabaseNamesFn(Dexie.dependencies.indexedDB);return getDatabaseNames?new Promise(function(resolve,reject){var req=getDatabaseNames();req.onsuccess=function(event){resolve(slice(event.target.result,0))};req.onerror=eventRejectHandler(reject)}).then(cb):dbNamesDB.dbnames.toCollection().primaryKeys(cb)},defineClass:function(){function Class(properties){if(properties)
            extend(this,properties)}
            return Class},applyStructure:applyStructure,ignoreTransaction:function(scopeFunc){return PSD.trans?usePSD(PSD.transless,scopeFunc):scopeFunc()},vip:function(fn){return newScope(function(){PSD.letThrough=!0;return fn()})},async:function(generatorFn){return function(){try{var rv=awaitIterator(generatorFn.apply(this,arguments));if(!rv||typeof rv.then!=='function')
            return Promise.resolve(rv);return rv}
        catch(e){return rejection(e)}}},spawn:function(generatorFn,args,thiz){try{var rv=awaitIterator(generatorFn.apply(thiz,args||[]));if(!rv||typeof rv.then!=='function')
            return Promise.resolve(rv);return rv}
        catch(e){return rejection(e)}},currentTransaction:{get:function(){return PSD.trans||null}},waitFor:function(promiseOrFunction,optionalTimeout){var promise=Promise.resolve(typeof promiseOrFunction==='function'?Dexie.ignoreTransaction(promiseOrFunction):promiseOrFunction).timeout(optionalTimeout||60000);return PSD.trans?PSD.trans.waitFor(promise):promise},Promise:Promise,debug:{get:function(){return debug},set:function(value){setDebug(value,value==='dexie'?function(){return!0}:dexieStackFrameFilter)}},derive:derive,extend:extend,props:props,override:override,Events:Events,getByKeyPath:getByKeyPath,setByKeyPath:setByKeyPath,delByKeyPath:delByKeyPath,shallowClone:shallowClone,deepClone:deepClone,getObjectDiff:getObjectDiff,asap:asap,maxKey:maxKey,minKey:minKey,addons:[],connections:connections,MultiModifyError:exceptions.Modify,errnames:errnames,IndexSpec:IndexSpec,TableSchema:TableSchema,dependencies:(function(){try{return{indexedDB:_global.indexedDB||_global.mozIndexedDB||_global.webkitIndexedDB||_global.msIndexedDB,IDBKeyRange:_global.IDBKeyRange||_global.webkitIDBKeyRange}}
        catch(e){return{indexedDB:null,IDBKeyRange:null}}})(),semVer:DEXIE_VERSION,version:DEXIE_VERSION.split('.').map(function(n){return parseInt(n)}).reduce(function(p,c,i){return p+(c/Math.pow(10,i*2))}),default:Dexie,Dexie:Dexie});Promise.rejectionMapper=mapError;dbNamesDB=new Dexie('__dbnames');dbNamesDB.version(1).stores({dbnames:'name'});(function(){var DBNAMES='Dexie.DatabaseNames';try{if(typeof localStorage!==undefined&&_global.document!==undefined){JSON.parse(localStorage.getItem(DBNAMES)||"[]").forEach(function(name){return dbNamesDB.dbnames.put({name:name}).catch(nop)});localStorage.removeItem(DBNAMES)}}
    catch(_e){}})();return Dexie})));


//OYSTER DEPENDENCY PEERJS
//https://github.com/peers/peerjs
parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r},p.cache={};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"vHo1":[function(require,module,exports) {
        var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),module.exports.binaryFeatures=e;var r=module.exports.BlobBuilder;function t(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(r=module.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),t.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},t.prototype.flush=function(){if(this._pieces.length>0){var r=new Uint8Array(this._pieces);e.useArrayBufferView||(r=r.buffer),this._parts.push(r),this._pieces=[]}},t.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var t=new r,i=0,u=this._parts.length;i<u;i++)t.append(this._parts[i]);return t.getBlob()}return new Blob(this._parts)},module.exports.BufferBuilder=t;
    },{}],"lHOc":[function(require,module,exports) {
        var t=require("./bufferbuilder").BufferBuilder,e=require("./bufferbuilder").binaryFeatures,i={unpack:function(t){return new r(t).unpack()},pack:function(t){var e=new n;return e.pack(t),e.getBuffer()}};function r(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function n(){this.bufferBuilder=new t}function u(t){var e=t.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function a(t){return t.length>600?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,u).length}module.exports=i,r.prototype.unpack=function(){var t,e=this.unpack_uint8();if(e<128)return e;if((224^e)<32)return(224^e)-32;if((t=160^e)<=15)return this.unpack_raw(t);if((t=176^e)<=15)return this.unpack_string(t);if((t=144^e)<=15)return this.unpack_array(t);if((t=128^e)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}},r.prototype.unpack_uint8=function(){var t=255&this.dataView[this.index];return this.index++,t},r.prototype.unpack_uint16=function(){var t=this.read(2),e=256*(255&t[0])+(255&t[1]);return this.index+=2,e},r.prototype.unpack_uint32=function(){var t=this.read(4),e=256*(256*(256*t[0]+t[1])+t[2])+t[3];return this.index+=4,e},r.prototype.unpack_uint64=function(){var t=this.read(8),e=256*(256*(256*(256*(256*(256*(256*t[0]+t[1])+t[2])+t[3])+t[4])+t[5])+t[6])+t[7];return this.index+=8,e},r.prototype.unpack_int8=function(){var t=this.unpack_uint8();return t<128?t:t-256},r.prototype.unpack_int16=function(){var t=this.unpack_uint16();return t<32768?t:t-65536},r.prototype.unpack_int32=function(){var t=this.unpack_uint32();return t<Math.pow(2,31)?t:t-Math.pow(2,32)},r.prototype.unpack_int64=function(){var t=this.unpack_uint64();return t<Math.pow(2,63)?t:t-Math.pow(2,64)},r.prototype.unpack_raw=function(t){if(this.length<this.index+t)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+t+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e},r.prototype.unpack_string=function(t){for(var e,i,r=this.read(t),n=0,u="";n<t;)(e=r[n])<128?(u+=String.fromCharCode(e),n++):(192^e)<32?(i=(192^e)<<6|63&r[n+1],u+=String.fromCharCode(i),n+=2):(i=(15&e)<<12|(63&r[n+1])<<6|63&r[n+2],u+=String.fromCharCode(i),n+=3);return this.index+=t,u},r.prototype.unpack_array=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.unpack();return e},r.prototype.unpack_map=function(t){for(var e={},i=0;i<t;i++){var r=this.unpack(),n=this.unpack();e[r]=n}return e},r.prototype.unpack_float=function(){var t=this.unpack_uint32(),e=(t>>23&255)-127;return(0==t>>31?1:-1)*(8388607&t|8388608)*Math.pow(2,e-23)},r.prototype.unpack_double=function(){var t=this.unpack_uint32(),e=this.unpack_uint32(),i=(t>>20&2047)-1023;return(0==t>>31?1:-1)*((1048575&t|1048576)*Math.pow(2,i-20)+e*Math.pow(2,i-52))},r.prototype.read=function(t){var e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")},n.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},n.prototype.pack=function(t){var i=typeof t;if("string"==i)this.pack_string(t);else if("number"==i)Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if("boolean"==i)!0===t?this.bufferBuilder.append(195):!1===t&&this.bufferBuilder.append(194);else if("undefined"==i)this.bufferBuilder.append(192);else{if("object"!=i)throw new Error('Type "'+i+'" not yet supported');if(null===t)this.bufferBuilder.append(192);else{var r=t.constructor;if(r==Array)this.pack_array(t);else if(r==Blob||r==File)this.pack_bin(t);else if(r==ArrayBuffer)e.useArrayBufferView?this.pack_bin(new Uint8Array(t)):this.pack_bin(t);else if("BYTES_PER_ELEMENT"in t)e.useArrayBufferView?this.pack_bin(new Uint8Array(t.buffer)):this.pack_bin(t.buffer);else if(r==Object)this.pack_object(t);else if(r==Date)this.pack_string(t.toString());else{if("function"!=typeof t.toBinaryPack)throw new Error('Type "'+r.toString()+'" not yet supported');this.bufferBuilder.append(t.toBinaryPack())}}}this.bufferBuilder.flush()},n.prototype.pack_bin=function(t){var e=t.length||t.byteLength||t.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(e)}this.bufferBuilder.append(t)},n.prototype.pack_string=function(t){var e=a(t);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(e)}this.bufferBuilder.append(t)},n.prototype.pack_array=function(t){var e=t.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(e)}for(var i=0;i<e;i++)this.pack(t[i])},n.prototype.pack_integer=function(t){if(-32<=t&&t<=127)this.bufferBuilder.append(255&t);else if(0<=t&&t<=255)this.bufferBuilder.append(204),this.pack_uint8(t);else if(-128<=t&&t<=127)this.bufferBuilder.append(208),this.pack_int8(t);else if(0<=t&&t<=65535)this.bufferBuilder.append(205),this.pack_uint16(t);else if(-32768<=t&&t<=32767)this.bufferBuilder.append(209),this.pack_int16(t);else if(0<=t&&t<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(t);else if(-2147483648<=t&&t<=2147483647)this.bufferBuilder.append(210),this.pack_int32(t);else if(-0x8000000000000000<=t&&t<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(t);else{if(!(0<=t&&t<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(t)}},n.prototype.pack_double=function(t){var e=0;t<0&&(e=1,t=-t);var i=Math.floor(Math.log(t)/Math.LN2),r=t/Math.pow(2,i)-1,n=Math.floor(r*Math.pow(2,52)),u=Math.pow(2,32),a=e<<31|i+1023<<20|n/u&1048575,p=n%u;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(p)},n.prototype.pack_object=function(t){var e=Object.keys(t).length;if(e<=15)this.pack_uint8(128+e);else if(e<=65535)this.bufferBuilder.append(222),this.pack_uint16(e);else{if(!(e<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(e)}for(var i in t)t.hasOwnProperty(i)&&(this.pack(i),this.pack(t[i]))},n.prototype.pack_uint8=function(t){this.bufferBuilder.append(t)},n.prototype.pack_uint16=function(t){this.bufferBuilder.append(t>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_uint32=function(t){var e=4294967295&t;this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},n.prototype.pack_uint64=function(t){var e=t/Math.pow(2,32),i=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)},n.prototype.pack_int8=function(t){this.bufferBuilder.append(255&t)},n.prototype.pack_int16=function(t){this.bufferBuilder.append((65280&t)>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_int32=function(t){this.bufferBuilder.append(t>>>24&255),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},n.prototype.pack_int64=function(t){var e=Math.floor(t/Math.pow(2,32)),i=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)};
    },{"./bufferbuilder":"vHo1"}],"sXtV":[function(require,module,exports) {
        "use strict";exports.__esModule=!0,exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;
    },{}],"BHXf":[function(require,module,exports) {
        var global = arguments[3];
        var e=arguments[3],t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var r={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},o=1,n=t(require("js-binarypack")),a=require("./adapter");exports.util={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:443,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var t=parseInt(e,10);isNaN(parseInt(e,10))?exports.util.logLevel=e?3:0:exports.util.logLevel=t,exports.util.log=exports.util.warn=exports.util.error=exports.util.noop,exports.util.logLevel>0&&(exports.util.error=exports.util._printWith("ERROR")),exports.util.logLevel>1&&(exports.util.warn=exports.util._printWith("WARNING")),exports.util.logLevel>2&&(exports.util.log=exports.util._print)},setLogFunction:function(e){e.constructor!==Function?exports.util.warn("The log function you passed in is not a function. Defaulting to regular logs."):exports.util._print=e},_printWith:function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),exports.util._print.apply(exports.util,t)}},_print:function(){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var r=0,o=t.length;r<o;r++)t[r]instanceof Error&&(t[r]="("+t[r].name+") "+t[r].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)},defaultConfig:r,browser:window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported",supports:function(){if(void 0===a.RTCPeerConnection)return{};var e,t,o=!0,n=!0,i=!1,u=!1,l=!!window.webkitRTCPeerConnection;try{e=new a.RTCPeerConnection(r,{optional:[{RtpDataChannels:!0}]})}catch(c){o=!1,n=!1}if(o)try{t=e.createDataChannel("_PEERJSTEST")}catch(c){o=!1}if(o){try{t.binaryType="blob",i=!0}catch(c){}var s=new a.RTCPeerConnection(r,{});try{u=s.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(c){}s.close()}return n&&(n=!!e.addStream),e&&e.close(),{audioVideo:n,data:o,binaryBlob:i,binary:u,reliable:u,sctp:u,onnegotiationneeded:l}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},pack:n.default.pack,unpack:n.default.unpack,log:function(){if(exports.util.debug){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var r=0,o=t.length;r<o;r++)t[r]instanceof Error&&(t[r]="("+t[r].name+") "+t[r].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)}},setZeroTimeout:function(e){var t=[],r="zero-timeout-message";function o(o){o.source==e&&o.data==r&&(o.stopPropagation&&o.stopPropagation(),t.length&&t.shift()())}return e.addEventListener?e.addEventListener("message",o,!0):e.attachEvent&&e.attachEvent("onmessage",o),function(o){t.push(o),e.postMessage(r,"*")}}(window),chunk:function(e){for(var t,r=[],n=e.size,a=t=0,i=Math.ceil(n/exports.util.chunkedMTU);a<n;){var u=Math.min(n,a+exports.util.chunkedMTU),l=e.slice(a,u),s={__peerData:o,n:t,data:l,total:i};r.push(s),a=u,t+=1}return o+=1,r},blobToArrayBuffer:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};
    },{"js-binarypack":"lHOc","./adapter":"sXtV"}],"2JJl":[function(require,module,exports) {
        "use strict";function t(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function e(){}e.prototype._events=void 0,e.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,s=new Array(n);e<n;e++)s[e]=this._events[t][e].fn;return s},e.prototype.emit=function(t,e,n,s,r,i){if(!this._events||!this._events[t])return!1;var o,h,f=this._events[t],v=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(t,f.fn,!0),v){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,s),!0;case 5:return f.fn.call(f.context,e,n,s,r),!0;case 6:return f.fn.call(f.context,e,n,s,r,i),!0}for(h=1,o=new Array(v-1);h<v;h++)o[h-1]=arguments[h];f.fn.apply(f.context,o)}else{var c,a=f.length;for(h=0;h<a;h++)switch(f[h].once&&this.removeListener(t,f[h].fn,!0),v){case 1:f[h].fn.call(f[h].context);break;case 2:f[h].fn.call(f[h].context,e);break;case 3:f[h].fn.call(f[h].context,e,n);break;default:if(!o)for(c=1,o=new Array(v-1);c<v;c++)o[c-1]=arguments[c];f[h].fn.apply(f[h].context,o)}}return!0},e.prototype.on=function(e,n,s){var r=new t(n,s||this);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],r]:this._events[e].push(r):this._events[e]=r,this},e.prototype.once=function(e,n,s){var r=new t(n,s||this,!0);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],r]:this._events[e].push(r):this._events[e]=r,this},e.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var s=this._events[t],r=[];if(e&&(s.fn&&(s.fn!==e||n&&!s.once)&&r.push(s),!s.fn))for(var i=0,o=s.length;i<o;i++)(s[i].fn!==e||n&&!s[i].once)&&r.push(s[i]);return r.length?this._events[t]=1===r.length?r[0]:r:delete this._events[t],this},e.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},e.prototype.off=e.prototype.removeListener,e.prototype.addListener=e.prototype.on,e.prototype.setMaxListeners=function(){return this},e.EventEmitter=e,e.EventEmitter2=e,e.EventEmitter3=e,module.exports=e;
    },{}],"wJlv":[function(require,module,exports) {
        "use strict";exports.__esModule=!0;var t=require("./util"),e=require("eventemitter3");function s(t,i,o,n,r,h){if(!(this instanceof s))return new s(t,i,o,n,r,h);h=h||o,e.EventEmitter.call(this),this.disconnected=!1,this._queue=[];var a=t?"https://":"http://",u=t?"wss://":"ws://";this._httpUrl=a+i+":"+o+n+r,this._wsUrl=u+i+":"+h+n+"peerjs?key="+r}exports.Socket=s,t.util.inherits(s,e.EventEmitter),s.prototype.start=function(t,e){this.id=t,this._httpUrl+="/"+t+"/"+e,this._wsUrl+="&id="+t+"&token="+e,this._startXhrStream(),this._startWebSocket()},s.prototype._startWebSocket=function(e){var s=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(e){try{var i=JSON.parse(e.data)}catch(o){return void t.util.log("Invalid server message",e.data)}s.emit("message",i)},this._socket.onclose=function(e){t.util.log("Socket closed."),s.disconnected=!0,s.emit("disconnected")},this._socket.onopen=function(){s._timeout&&(clearTimeout(s._timeout),setTimeout(function(){s._http.abort(),s._http=null},5e3)),s._sendQueuedMessages(),t.util.log("Socket open")})},s.prototype._startXhrStream=function(e){try{var s=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(s._timeout),s.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&200===this.status&&this.responseText&&s._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(i){t.util.log("XMLHttpRequest not available; defaulting to WebSockets")}},s.prototype._handleStream=function(e){var s=e.responseText.split("\n");if(e._buffer)for(;e._buffer.length>0;){var i=e._buffer.shift(),o=s[i];try{o=JSON.parse(o)}catch(r){e._buffer.shift(i);break}this.emit("message",o)}var n=s[e._index];if(n)if(e._index+=1,e._index===s.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{n=JSON.parse(n)}catch(r){return void t.util.log("Invalid server message",n)}this.emit("message",n)}},s.prototype._setHTTPTimeout=function(){var t=this;this._timeout=setTimeout(function(){var e=t._http;t._wsOpen()?e.abort():(t._startXhrStream(e._streamIndex+1),t._http.old=e)},25e3)},s.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},s.prototype._sendQueuedMessages=function(){for(var t=0,e=this._queue.length;t<e;t+=1)this.send(this._queue[t])},s.prototype.send=function(t){if(!this.disconnected)if(this.id)if(t.type){var e=JSON.stringify(t);if(this._wsOpen())this._socket.send(e);else{var s=new XMLHttpRequest,i=this._httpUrl+"/"+t.type.toLowerCase();s.open("post",i,!0),s.setRequestHeader("Content-Type","application/json"),s.send(e)}}else this.emit("error","Invalid message");else this._queue.push(t)},s.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)};
    },{"./util":"BHXf","eventemitter3":"2JJl"}],"HCdX":[function(require,module,exports) {
        "use strict";exports.__esModule=!0;var e=require("./util"),t=require("./adapter");function o(e,t){"addTrack"in t?e.getTracks().forEach(function(o){t.addTrack(o,e)}):"addStream"in t&&t.addStream(e)}exports.Negotiator={pcs:{data:{},media:{}},queue:[]},exports.Negotiator._idPrefix="pc_",exports.Negotiator.startConnection=function(t,i){var r=exports.Negotiator._getPeerConnection(t,i);if(t.pc=t.peerConnection=r,"media"===t.type&&i._stream&&o(i._stream,r),i.originator){if("data"===t.type){var n={};e.util.supports.sctp||(n={reliable:i.reliable});var a=r.createDataChannel(t.label,n);t.initialize(a)}exports.Negotiator._makeOffer(t)}else exports.Negotiator.handleSDP("OFFER",t,i.sdp)},exports.Negotiator._getPeerConnection=function(t,o){exports.Negotiator.pcs[t.type]||e.util.error(t.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),exports.Negotiator.pcs[t.type][t.peer]||(exports.Negotiator.pcs[t.type][t.peer]={});var i;exports.Negotiator.pcs[t.type][t.peer];return o.pc&&(i=exports.Negotiator.pcs[t.type][t.peer][o.pc]),i&&"stable"===i.signalingState||(i=exports.Negotiator._startPeerConnection(t)),i},exports.Negotiator._startPeerConnection=function(o){e.util.log("Creating RTCPeerConnection.");var i=exports.Negotiator._idPrefix+e.util.randomToken(),r={};"data"!==o.type||e.util.supports.sctp?"media"===o.type&&(r={optional:[{DtlsSrtpKeyAgreement:!0}]}):r={optional:[{RtpDataChannels:!0}]};var n=new t.RTCPeerConnection(o.provider.options.config,r);return exports.Negotiator.pcs[o.type][o.peer][i]=n,exports.Negotiator._setupListeners(o,n,i),n},exports.Negotiator._setupListeners=function(t,i,r){var n=t.peer,a=t.id,c=t.provider;e.util.log("Listening for ICE candidates."),i.onicecandidate=function(o){o.candidate&&(e.util.log("Received ICE candidates for:",t.peer),c.socket.send({type:"CANDIDATE",payload:{candidate:o.candidate,type:t.type,connectionId:t.id},dst:n}))},i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"failed":e.util.log("iceConnectionState is disconnected, closing connections to "+n),t.emit("error",new Error("Negotiation of connection to "+n+" failed.")),t.close();break;case"disconnected":e.util.log("iceConnectionState is disconnected, closing connections to "+n);break;case"completed":i.onicecandidate=e.util.noop}},i.onicechange=i.oniceconnectionstatechange,e.util.log("Listening for data channel"),i.ondatachannel=function(t){e.util.log("Received data channel");var o=t.channel;c.getConnection(n,a).initialize(o)},e.util.log("Listening for remote stream"),i.ontrack=function(t){e.util.log("Received remote stream");var i=t.streams[0],r=c.getConnection(n,a);"media"===r.type&&o(i,r)}},exports.Negotiator.cleanup=function(t){e.util.log("Cleaning up PeerConnection to "+t.peer);var o=t.pc;o&&(o.readyState&&"closed"!==o.readyState||"closed"!==o.signalingState)&&(o.close(),t.pc=null)},exports.Negotiator._makeOffer=function(t){var o=t.pc,i=function(i){e.util.log("Created offer."),!e.util.supports.sctp&&"data"===t.type&&t.reliable&&(i.sdp=Reliable.higherBandwidthSDP(i.sdp));o.setLocalDescription(i).then(function(){return e.util.log("Set localDescription: offer","for:",t.peer),void t.provider.socket.send({type:"OFFER",payload:{sdp:i,type:t.type,label:t.label,connectionId:t.id,reliable:t.reliable,serialization:t.serialization,metadata:t.metadata,browser:e.util.browser},dst:t.peer})}).catch(function(o){return function(o){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=o&&(t.provider.emitError("webrtc",o),e.util.log("Failed to setLocalDescription, ",o))}(o)})};o.createOffer(t.options.constraints).then(function(e){return i(e)}).catch(function(o){return function(o){t.provider.emitError("webrtc",o),e.util.log("Failed to createOffer, ",o)}(o)})},exports.Negotiator._makeAnswer=function(t){var o=t.pc,i=function(i){e.util.log("Created answer."),!e.util.supports.sctp&&"data"===t.type&&t.reliable&&(i.sdp=Reliable.higherBandwidthSDP(i.sdp));o.setLocalDescription(i).then(function(){return e.util.log("Set localDescription: answer","for:",t.peer),void t.provider.socket.send({type:"ANSWER",payload:{sdp:i,type:t.type,connectionId:t.id,browser:e.util.browser},dst:t.peer})}).catch(function(o){t.provider.emitError("webrtc",o),e.util.log("Failed to setLocalDescription, ",o)})};o.createAnswer().then(function(e){return i(e)}).catch(function(o){t.provider.emitError("webrtc",o),e.util.log("Failed to create answer, ",o)})},exports.Negotiator.handleSDP=function(o,i,r){r=new t.RTCSessionDescription(r);var n=i.pc;e.util.log("Setting remote description",r);n.setRemoteDescription(r).then(function(){return e.util.log("Set remoteDescription:",o,"for:",i.peer),void("OFFER"===o&&exports.Negotiator._makeAnswer(i))}).catch(function(t){i.provider.emitError("webrtc",t),e.util.log("Failed to setRemoteDescription, ",t)})},exports.Negotiator.handleCandidate=function(o,i){var r=i.candidate,n=i.sdpMLineIndex;o.pc.addIceCandidate(new t.RTCIceCandidate({sdpMLineIndex:n,candidate:r})),e.util.log("Added ICE candidate for:",o.peer)};
    },{"./util":"BHXf","./adapter":"sXtV"}],"dbHP":[function(require,module,exports) {
        "use strict";exports.__esModule=!0;var t=require("./util"),e=require("eventemitter3"),i=require("./negotiator");function o(s,a,r){if(!(this instanceof o))return new o(s,a,r);e.EventEmitter.call(this),this.options=t.util.extend({},r),this.open=!1,this.type="media",this.peer=s,this.provider=a,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||o._idPrefix+t.util.randomToken(),this.localStream&&i.Negotiator.startConnection(this,{_stream:this.localStream,originator:!0})}exports.MediaConnection=o,t.util.inherits(o,e.EventEmitter),o._idPrefix="mc_",o.prototype.addStream=function(e){t.util.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},o.prototype.handleMessage=function(e){var o=e.payload;switch(e.type){case"ANSWER":i.Negotiator.handleSDP(e.type,this,o.sdp),this.open=!0;break;case"CANDIDATE":i.Negotiator.handleCandidate(this,o.candidate);break;default:t.util.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},o.prototype.answer=function(e){if(this.localStream)t.util.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this.options._payload._stream=e,this.localStream=e,i.Negotiator.startConnection(this,this.options._payload);for(var o=this.provider._getMessages(this.id),s=0,a=o.length;s<a;s+=1)this.handleMessage(o[s]);this.open=!0}},o.prototype.close=function(){this.open&&(this.open=!1,i.Negotiator.cleanup(this),this.emit("close"))};
    },{"./util":"BHXf","eventemitter3":"2JJl","./negotiator":"HCdX"}],"T9kO":[function(require,module,exports) {
        var global = arguments[3];
        var e=arguments[3],r=require("js-binarypack"),t={debug:!1,inherits:function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);return e},pack:r.pack,unpack:r.unpack,log:function(){if(t.debug){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:function(e){var r=[],t="zero-timeout-message";function n(n){n.source==e&&n.data==t&&(n.stopPropagation&&n.stopPropagation(),r.length&&r.shift()())}return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),function(n){r.push(n),e.postMessage(t,"*")}}(this),blobToArrayBuffer:function(e,r){var t=new FileReader;t.onload=function(e){r(e.target.result)},t.readAsArrayBuffer(e)},blobToBinaryString:function(e,r){var t=new FileReader;t.onload=function(e){r(e.target.result)},t.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=255&e.charCodeAt(t);return r.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};module.exports=t;
    },{"js-binarypack":"lHOc"}],"aYFJ":[function(require,module,exports) {
        var t=require("./util");function e(n,i){if(!(this instanceof e))return new e(n);this._dc=n,t.debug=i,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}e.prototype.send=function(e){var n=t.pack(e);n.size<this._mtu?this._handleSend(["no",n]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(n)},t.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},e.prototype._setupInterval=function(){var t=this;this._timeout=setInterval(function(){var e=t._queue.shift();if(e._multiple)for(var n=0,i=e.length;n<i;n+=1)t._intervalSend(e[n]);else t._intervalSend(e)},this._interval)},e.prototype._intervalSend=function(e){var n=this;e=t.pack(e),t.blobToBinaryString(e,function(t){n._dc.send(t)}),0===n._queue.length&&(clearTimeout(n._timeout),n._timeout=null)},e.prototype._processAcks=function(){for(var t in this._outgoing)this._outgoing.hasOwnProperty(t)&&this._sendWindowedChunks(t)},e.prototype._handleSend=function(t){for(var e=!0,n=0,i=this._queue.length;n<i;n+=1){var o=this._queue[n];o===t?e=!1:o._multiple&&-1!==o.indexOf(t)&&(e=!1)}e&&(this._queue.push(t),this._timeout||this._setupInterval())},e.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(n){var i=n.data;if(i.constructor===String){var o=t.binaryStringToArrayBuffer(i);i=t.unpack(o),e._handleMessage(i)}}},e.prototype._handleMessage=function(e){var n,i=e[1],o=this._incoming[i],s=this._outgoing[i];switch(e[0]){case"no":var a=i;a&&this.onmessage(t.unpack(a));break;case"end":if(n=o,this._received[i]=e[2],!n)break;this._ack(i);break;case"ack":if(n=s){var h=e[2];n.ack=Math.max(h,n.ack),n.ack>=n.chunks.length?(t.log("Time: ",new Date-n.timer),delete this._outgoing[i]):this._processAcks()}break;case"chunk":if(!(n=o)){if(!0===this._received[i])break;n={ack:["ack",i,0],chunks:[]},this._incoming[i]=n}var r=e[2],u=e[3];n.chunks[r]=new Uint8Array(u),r===n.ack[2]&&this._calculateNextAck(i),this._ack(i);break;default:this._handleSend(e)}},e.prototype._chunk=function(e){for(var n=[],i=e.size,o=0;o<i;){var s=Math.min(i,o+this._mtu),a={payload:e.slice(o,s)};n.push(a),o=s}return t.log("Created",n.length,"chunks."),n},e.prototype._ack=function(t){var e=this._incoming[t].ack;this._received[t]===e[2]&&(this._complete(t),this._received[t]=!0),this._handleSend(e)},e.prototype._calculateNextAck=function(t){for(var e=this._incoming[t],n=e.chunks,i=0,o=n.length;i<o;i+=1)if(void 0===n[i])return void(e.ack[2]=i);e.ack[2]=n.length},e.prototype._sendWindowedChunks=function(e){t.log("sendWindowedChunks for: ",e);for(var n=this._outgoing[e],i=n.chunks,o=[],s=Math.min(n.ack+this._window,i.length),a=n.ack;a<s;a+=1)i[a].sent&&a!==n.ack||(i[a].sent=!0,o.push(["chunk",e,a,i[a].payload]));n.ack+this._window>=i.length&&o.push(["end",e,i.length]),o._multiple=!0,this._handleSend(o)},e.prototype._complete=function(e){t.log("Completed called for",e);var n=this,i=this._incoming[e].chunks,o=new Blob(i);t.blobToArrayBuffer(o,function(e){n.onmessage(t.unpack(e))}),delete this._incoming[e]},e.higherBandwidthSDP=function(t){var e=navigator.appVersion.match(/Chrome\/(.*?) /);if(e&&(e=parseInt(e[1].split(".").shift()))<31){var n=t.split("b=AS:30");if(n.length>1)return n[0]+"b=AS:102400"+n[1]}return t},e.prototype.onmessage=function(t){},module.exports.Reliable=e;
    },{"./util":"T9kO"}],"GBTQ":[function(require,module,exports) {
        "use strict";exports.__esModule=!0;var t=require("./util"),e=require("eventemitter3"),i=require("./negotiator"),n=require("reliable");function s(n,r,a){if(!(this instanceof s))return new s(n,r,a);e.EventEmitter.call(this),this.options=t.util.extend({serialization:"binary",reliable:!1},a),this.open=!1,this.type="data",this.peer=n,this.provider=r,this.id=this.options.connectionId||s._idPrefix+t.util.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),i.Negotiator.startConnection(this,this.options._payload||{originator:!0})}exports.DataConnection=s,t.util.inherits(s,e.EventEmitter),s._idPrefix="dc_",s.prototype.initialize=function(t){this._dc=this.dataChannel=t,this._configureDataChannel()},s.prototype._configureDataChannel=function(){var e=this;t.util.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){t.util.log("Data channel connection success"),e.open=!0,e.emit("open")},!t.util.supports.sctp&&this.reliable&&(this._reliable=new n.Reliable(this._dc,t.util.debug)),this._reliable?this._reliable.onmessage=function(t){e.emit("data",t)}:this._dc.onmessage=function(t){e._handleDataMessage(t)},this._dc.onclose=function(i){t.util.log("DataChannel closed for:",e.peer),e.close()}},s.prototype._handleDataMessage=function(e){var i=this,n=e.data,s=n.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(s===Blob)return void t.util.blobToArrayBuffer(n,function(e){n=t.util.unpack(e),i.emit("data",n)});if(s===ArrayBuffer)n=t.util.unpack(n);else if(s===String){var r=t.util.binaryStringToArrayBuffer(n);n=t.util.unpack(r)}}else"json"===this.serialization&&(n=JSON.parse(n));if(n.__peerData){var a=n.__peerData,o=this._chunkedData[a]||{data:[],count:0,total:n.total};return o.data[n.n]=n.data,o.count+=1,o.total===o.count&&(delete this._chunkedData[a],n=new Blob(o.data),this._handleDataMessage({data:n})),void(this._chunkedData[a]=o)}this.emit("data",n)},s.prototype.close=function(){this.open&&(this.open=!1,i.Negotiator.cleanup(this),this.emit("close"))},s.prototype.send=function(e,i){if(this.open)if(this._reliable)this._reliable.send(e);else{var n=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(e));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var s=t.util.pack(e);if((t.util.chunkedBrowsers[this._peerBrowser]||t.util.chunkedBrowsers[t.util.browser])&&!i&&s.size>t.util.chunkedMTU)return void this._sendChunks(s);t.util.supports.sctp?t.util.supports.binaryBlob?this._bufferedSend(s):t.util.blobToArrayBuffer(s,function(t){n._bufferedSend(t)}):t.util.blobToBinaryString(s,function(t){n._bufferedSend(t)})}else this._bufferedSend(e)}else this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},s.prototype._bufferedSend=function(t){!this._buffering&&this._trySend(t)||(this._buffer.push(t),this.bufferSize=this._buffer.length)},s.prototype._trySend=function(t){try{this._dc.send(t)}catch(i){this._buffering=!0;var e=this;return setTimeout(function(){e._buffering=!1,e._tryBuffer()},100),!1}return!0},s.prototype._tryBuffer=function(){if(0!==this._buffer.length){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},s.prototype._sendChunks=function(e){for(var i=t.util.chunk(e),n=0,s=i.length;n<s;n+=1){e=i[n];this.send(e,!0)}},s.prototype.handleMessage=function(e){var n=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=n.browser,i.Negotiator.handleSDP(e.type,this,n.sdp);break;case"CANDIDATE":i.Negotiator.handleCandidate(this,n.candidate);break;default:t.util.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}};
    },{"./util":"BHXf","eventemitter3":"2JJl","./negotiator":"HCdX","reliable":"aYFJ"}],"Hxpd":[function(require,module,exports) {
        "use strict";exports.__esModule=!0;var e=require("./util"),t=require("eventemitter3"),o=require("./socket"),n=require("./mediaconnection"),i=require("./dataconnection");function s(o,n){if(!(this instanceof s))return new s(o,n);t.EventEmitter.call(this),o&&o.constructor==Object?(n=o,o=void 0):o&&(o=o.toString()),(n=e.util.extend({debug:0,host:e.util.CLOUD_HOST,port:e.util.CLOUD_PORT,path:"/",token:e.util.randomToken(),config:e.util.defaultConfig},n)).key="peerjs",this.options=n,"/"===n.host&&(n.host=window.location.hostname),"/"!==n.path[0]&&(n.path="/"+n.path),"/"!==n.path[n.path.length-1]&&(n.path+="/"),void 0===n.secure&&n.host!==e.util.CLOUD_HOST?n.secure=e.util.isSecure():n.host==e.util.CLOUD_HOST&&(n.secure=!0),n.logFunction&&e.util.setLogFunction(n.logFunction),e.util.setLogLevel(n.debug),e.util.supports.audioVideo||e.util.supports.data?e.util.validateId(o)?(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),o?this._initialize(o):this._retrieveId()):this._delayedAbort("invalid-id",'ID "'+o+'" is invalid'):this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")}exports.Peer=s,e.util.inherits(s,t.EventEmitter),s.prototype._initializeServerConnection=function(){var e=this;this.socket=new o.Socket(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key,this.options.wsport),this.socket.on("message",function(t){e._handleMessage(t)}),this.socket.on("error",function(t){e._abort("socket-error",t)}),this.socket.on("disconnected",function(){e.disconnected||(e.emitError("network","Lost connection to server."),e.disconnect())}),this.socket.on("close",function(){e.disconnected||e._abort("socket-closed","Underlying socket is already closed.")})},s.prototype._retrieveId=function(t){var o=this,n=new XMLHttpRequest,i=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";i+="?ts="+(new Date).getTime()+Math.random(),n.open("get",i,!0),n.onerror=function(t){e.util.error("Error retrieving ID",t);var n="";"/"===o.options.path&&o.options.host!==e.util.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),o._abort("server-error","Could not get an ID from the server."+n)},n.onreadystatechange=function(){4===n.readyState&&(200===n.status?o._initialize(n.responseText):n.onerror())},n.send(null)},s.prototype._initialize=function(e){this.id=e,this.socket.start(this.id,this.options.token)},s.prototype._handleMessage=function(t){var o,s=t.type,r=t.payload,a=t.src;switch(s){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",r.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":e.util.log("Received leave message from",a),this._cleanupPeer(a);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+a);break;case"OFFER":var c=r.connectionId;if((o=this.getConnection(a,c))&&(o.close(),e.util.warn("Offer received for existing Connection ID:",c)),"media"===r.type)o=new n.MediaConnection(a,this,{connectionId:c,_payload:r,metadata:r.metadata}),this._addConnection(a,o),this.emit("call",o);else{if("data"!==r.type)return void e.util.warn("Received malformed connection type:",r.type);o=new i.DataConnection(a,this,{connectionId:c,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable}),this._addConnection(a,o),this.emit("connection",o)}for(var h=this._getMessages(c),d=0,l=h.length;d<l;d+=1)o.handleMessage(h[d]);break;default:if(!r)return void e.util.warn("You received a malformed message from "+a+" of type "+s);var u=r.connectionId;(o=this.getConnection(a,u))&&o.pc?o.handleMessage(t):u?this._storeMessage(u,t):e.util.warn("You received an unrecognized message:",t)}},s.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},s.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},s.prototype.connect=function(t,o){if(this.disconnected)return e.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var n=new i.DataConnection(t,this,o);return this._addConnection(t,n),n},s.prototype.call=function(t,o,i){if(this.disconnected)return e.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");if(o){(i=i||{})._stream=o;var s=new n.MediaConnection(t,this,i);return this._addConnection(t,s),s}e.util.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},s.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},s.prototype.getConnection=function(e,t){var o=this.connections[e];if(!o)return null;for(var n=0,i=o.length;n<i;n++)if(o[n].id===t)return o[n];return null},s.prototype._delayedAbort=function(t,o){var n=this;e.util.setZeroTimeout(function(){n._abort(t,o)})},s.prototype._abort=function(t,o){e.util.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(t,o)},s.prototype.emitError=function(t,o){e.util.error("Error:",o),"string"==typeof o&&(o=new Error(o)),o.type=t,this.emit("error",o)},s.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},s.prototype._cleanup=function(){if(this.connections)for(var e=Object.keys(this.connections),t=0,o=e.length;t<o;t++)this._cleanupPeer(e[t]);this.emit("close")},s.prototype._cleanupPeer=function(e){for(var t=this.connections[e],o=0,n=t.length;o<n;o+=1)t[o].close()},s.prototype.disconnect=function(){var t=this;e.util.setZeroTimeout(function(){t.disconnected||(t.disconnected=!0,t.open=!1,t.socket&&t.socket.close(),t.emit("disconnected",t.id),t._lastServerId=t.id,t.id=null)})},s.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)e.util.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");e.util.error("In a hurry? We're still trying to make the initial connection!")}},s.prototype.listAllPeers=function(t){t=t||function(){};var o=this,n=new XMLHttpRequest,i=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";i+="?ts="+(new Date).getTime()+Math.random(),n.open("get",i,!0),n.onerror=function(e){o._abort("server-error","Could not get peers from the server."),t([])},n.onreadystatechange=function(){if(4===n.readyState){if(401===n.status){var i="";throw i=o.options.host!==e.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",t([]),new Error("It doesn't look like you have permission to list peers IDs. "+i)}200!==n.status?t([]):t(JSON.parse(n.responseText))}},n.send(null)};
    },{"./util":"BHXf","eventemitter3":"2JJl","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ"}],"iTK6":[function(require,module,exports) {
        "use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var i=require("./util"),n=require("./adapter"),o=require("./socket"),t=require("./mediaconnection"),r=require("./dataconnection"),a=require("./peer"),d=require("./negotiator"),c=e(require("js-binarypack"));window.Socket=o.Socket,window.MediaConnection=t.MediaConnection,window.DataConnection=r.DataConnection,window.Peer=a.Peer,window.RTCPeerConnection=n.RTCPeerConnection,window.RTCSessionDescription=n.RTCSessionDescription,window.RTCIceCandidate=n.RTCIceCandidate,window.Negotiator=d.Negotiator,window.util=i.util,window.BinaryPack=c.default,exports.default=a.Peer;
    },{"./util":"BHXf","./adapter":"sXtV","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./peer":"Hxpd","./negotiator":"HCdX","js-binarypack":"lHOc"}]},{},["iTK6"], null);

//OYSTERMESH.JS
const OY_MESH_DYNASTY="BRUNO_GENESIS_V4",OY_MESH_EDGE=2,OY_MESH_BUFFER=[.4,400],OY_MESH_FLOW=256e3,OY_MESH_HOP_MAX=200,OY_MESH_MEASURE=10,OY_MESH_BEAM_SAMPLE=3,OY_MESH_BEAM_COOL=2.5,OY_MESH_BEAM_MIN=.5,OY_MESH_SOAK_SAMPLE=5,OY_MESH_SOAK_BUFFER=1.2,OY_MESH_PUSH_CHANCE=.9,OY_MESH_DEPOSIT_CHANCE=.5,OY_MESH_FULLFILL_CHANCE=.2,OY_MESH_SOURCE=3,OY_BLOCK_LOOP=100,OY_BLOCK_CONSENSUS=.5,OY_BLOCK_LAUNCHTIME=200,OY_BLOCK_PROTECTTIME=600,OY_BLOCK_CHALLENGETIME=1600,OY_BLOCK_CLONETIME=800,OY_BLOCK_MISS_MULTI=.3,OY_BLOCK_MISS_MULTI_MIN=1,OY_BLOCK_STABILITY_START=50,OY_BLOCK_STABILITY_TRIGGER=3,OY_BLOCK_STABILITY_LIMIT=12,OY_BLOCK_STABILITY_MIN=20,OY_BLOCK_ROSTER_PERSIST=.8,OY_BLOCK_HOP_CALCTIME=60,OY_BLOCK_KEY_LIMIT=200,OY_BLOCK_HASH_KEEP=1555,OY_BLOCK_DENSITY=.5,OY_BLOCK_PEERS_MIN=3,OY_BLOCK_PACKET_MAX=8e3,OY_BLOCK_SEED_BUFFER=600,OY_BLOCK_DIVE_BUFFER=40,OY_BLOCK_RANGE_MIN=20,OY_BLOCK_SEEDTIME=1556457900,OY_CHALLENGE_SAFETY=.5,OY_CHALLENGE_BUFFER=1.8,OY_AKOYA_DECIMALS=1e8,OY_AKOYA_MAX_SUPPY=1e7*OY_AKOYA_DECIMALS,OY_AKOYA_FEE=1e-6*OY_AKOYA_DECIMALS,OY_NODE_TOLERANCE=3,OY_NODE_BLACKTIME=300,OY_NODE_PROPOSETIME=12,OY_NODE_ASSIGNTTIME=4,OY_NODE_ASSIGN_DELAY=500,OY_NODE_DELAYTIME=6,OY_NODE_EXPIRETIME=600,OY_BOOST_KEEP=12,OY_BOOST_DELAY=250,OY_BOOST_EXPIRETIME=600,OY_CLONE_AFFINITY=.3,OY_CLONE_UPTIME_MIN=60,OY_CLONE_LIVETIME=90,OY_CLONE_BUFFERTIME=10,OY_CLONE_CHUNK=52e3,OY_CLONE_CLONE_MAX=6,OY_CLONE_ORIGIN_MAX=3,OY_PEER_LATENCYTIME=60,OY_PEER_KEEPTIME=20,OY_PEER_REPORTTIME=10,OY_PEER_PRETIME=20,OY_PEER_MAX=5,OY_PEER_SYNC_CHANCE=.1,OY_ROUTE_DYNAMIC_KEEP=200,OY_LATENCY_SIZE=80,OY_LATENCY_LENGTH=8,OY_LATENCY_REPEAT=2,OY_LATENCY_MAX=20,OY_LATENCY_TRACK=200,OY_LATENCY_GEO_SENS=25,OY_DATA_MAX=64e3,OY_DATA_CHUNK=48e3,OY_DATA_PURGE=10,OY_DATA_PUSH_INTERVAL=200,OY_DATA_PUSH_NONCE_MAX=16,OY_DATA_PULL_INTERVAL=800,OY_DATA_PULL_NONCE_MAX=3,OY_ENGINE_INTERVAL=2e3,OY_CHRONO_ACCURACY=10,OY_READY_RETRY=2e3,OY_LOGIC_ALL_MAX=1100,OY_CHANNEL_BROADCAST_PACKET_MAX=2e3,OY_CHANNEL_KEEPTIME=10,OY_CHANNEL_FORGETIME=25,OY_CHANNEL_RECOVERTIME=6,OY_CHANNEL_EXPIRETIME=2592e3,OY_CHANNEL_RESPOND_MAX=6,OY_CHANNEL_ALLOWANCE=58,OY_CHANNEL_CONSENSUS=.5,OY_CHANNEL_TOP_TOLERANCE=2,OY_KEY_BRUNO="XLp6_wVPBF3Zg-QNRkEj6U8bOYEZddQITs1n2pyeRqwOG5k9w_1A-RMIESIrVv_5HbvzoLhq-xPLE7z2na0C6M",OY_SHORT_LENGTH=4;let OY_SELF_PRIVATE,OY_SELF_PUBLIC,OY_SELF_SHORT,OY_CONN,OY_CONSOLE,OY_MESH_MAP,OY_BLOCK_MAP,OY_ERROR_BROWSER,OY_PASSIVE_MODE=!1,OY_READY=!1,OY_ENGINE_KILL=!1,OY_INIT=0,OY_ENGINE=[{},{}],OY_COLLECT={},OY_CONSTRUCT={},OY_DATA_PUSH={},OY_DATA_PULL={},OY_PEER_COUNT=0,OY_PEERS={oy_aggregate_node:[-1,-1,-1,0,[],0,[],0,[]]},OY_PEERS_PRE={},OY_PEERS_NULL=new Event("oy_peers_null"),OY_PEERS_RECOVER=new Event("oy_peers_recover"),OY_NODES={},OY_BOOST=[],OY_BOOST_MODE=!1,OY_WARM={},OY_COLD={},OY_ROUTE_DYNAMIC=[],OY_LATENCY={},OY_PROPOSED={},OY_BLACKLIST={},OY_PUSH_HOLD={},OY_PUSH_TALLY={},OY_ORIGINS={},OY_CLONES={},OY_CLONE_UPTIME=null,OY_CLONE_BUILD=[],OY_LOGIC_ALL_TYPE=["OY_BLOCK_COMMAND","OY_BLOCK_SYNC","OY_BLOCK_SYNC_CHALLENGE","OY_BLOCK_DIVE","OY_DATA_PULL","OY_CHANNEL_BROADCAST"],OY_LOGIC_EXCEPT_TYPE=["OY_BLOCK_SYNC","OY_BLOCK_SYNC_CHALLENGE_RESPONSE","OY_BLOCK_DIVE","OY_CHANNEL_BROADCAST"],OY_MESH_RANGE=0,OY_BLOCK_SECTORS=[[4,4e3],[12,12e3],[20,2e4]],OY_BLOCK_DYNAMIC=[null,null,null,null],OY_BLOCK_ROSTER={},OY_BLOCK_ROSTER_AVG=null,OY_BLOCK_TEMP=[[null,[]],{},{},{},{}],OY_BLOCK_TEMP_HASH=null,OY_BLOCK=[[null,[]],{},{},{},{}],OY_BLOCK_HASH=null,OY_BLOCK_SIGN=null,OY_BLOCK_TIME=oy_block_time_first(!1),OY_BLOCK_NEXT=oy_block_time_first(!0),OY_BLOCK_UPTIME=null,OY_BLOCK_WEIGHT=null,OY_BLOCK_STABILITY=0,OY_BLOCK_STABILITY_KEEP=[OY_BLOCK_RANGE_MIN],OY_BLOCK_STABILITY_ROSTER=parseInt(OY_BLOCK_STABILITY_START+""),OY_BLOCK_COMMANDS={OY_AKOYA_SEND:[function(_){return!!(5===_.length&&_[3]>0&&_[3]<OY_AKOYA_MAX_SUPPY&&void 0!==OY_BLOCK[2][_[2]]&&_[3]<=OY_BLOCK[2][_[2]]&&_[2]!==_[4]&&oy_public_check(_[4]))}],OY_AKOYA_BURN:[function(_){return 4===_.length}],OY_DNS_SET:[function(_){return 4===_.length}],OY_DNS_TRANSFER:[function(_){return 4===_.length}]},OY_BLOCK_COMMAND={},OY_BLOCK_COMMAND_KEY={},OY_BLOCK_SYNC_HASH=null,OY_BLOCK_SYNC={},OY_BLOCK_DIVE={},OY_BLOCK_CHALLENGE={},OY_BLOCK_DIVE_SET=[],OY_BLOCK_DIVE_TRACK=0,OY_BLOCK_DIVE_REWARD="OY_NULL",OY_BLOCK_NEW={},OY_BLOCK_CONFIRM={},OY_BLOCK_INIT=new Event("oy_block_init"),OY_BLOCK_TRIGGER=new Event("oy_block_trigger"),OY_BLOCK_RESET=new Event("oy_block_reset"),OY_BLOCK_TRIGGER_TEMP=new Event("oy_block_trigger_temp"),OY_CHALLENGE_TRIGGER=null,OY_CHANNEL_DYNAMIC={},OY_CHANNEL_LISTEN={},OY_CHANNEL_KEEP={},OY_CHANNEL_ECHO={},OY_CHANNEL_TOP={},OY_CHANNEL_RENDER={},OY_DB=null;function oy_log(_,e){if(!0===OY_PASSIVE_MODE)return!1;void 0===e&&(e=0),1===e&&(_="FATAL ERROR: "+_),null===OY_CONSOLE?console.log(_):OY_CONSOLE(_)}function oy_log_debug(_){if(null===OY_SELF_SHORT)return!1;_="["+Date.now()/1e3+"] "+_;let e=new XMLHttpRequest;e.open("POST","https://top.oyster.org/oy_log_catch.php",!0),e.send("oy_log_catch="+JSON.stringify([OY_SELF_SHORT,_]))}function oy_short(_){return _.substr(0,OY_SHORT_LENGTH)}function oy_chrono(_,e){let o=0,O=performance.now(),n=function(){if((o+=performance.now()-O)>=e)return _();setTimeout(n,OY_CHRONO_ACCURACY),O=performance.now()};n()}function oy_shuffle_double(_,e){let o,O,n,t=_.length;for(;t;)o=Math.floor(Math.random()*t),O=_[t-=1],n=e[t],_[t]=_[o],e[t]=e[o],_[o]=O,e[o]=n}function oy_rand_gen(_){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return void 0===_?e():"x".repeat(_).replace(/x/g,e)}function oy_hash_gen(_){return CryptoJS.SHA1(_).toString()}function oy_buffer_encode(_,e){let o,O=(o=!0===e?window.atob(_):_).length,n=new Uint8Array(O);for(let _=0;_<O;_++)n[_]=o.charCodeAt(_);return n.buffer}function oy_buffer_decode(_,e){let o="",O=new Uint8Array(_),n=O.byteLength;for(let _=0;_<n;_++)o+=String.fromCharCode(O[_]);return!0===e?window.btoa(o):o}function oy_base_decode(_){return decodeURIComponent(window.atob(_).split("").map(function(_){return"%"+("00"+_.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function oy_crypt_encrypt(_,e){let o=CryptoJS.lib.WordArray.random(16),O=CryptoJS.PBKDF2(e,o,{keySize:8,iterations:100}),n=CryptoJS.lib.WordArray.random(16);return o.toString()+n.toString()+CryptoJS.AES.encrypt(_.toString(),O,{iv:n,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC}).toString()}function oy_crypt_decrypt(_,e){let o=CryptoJS.enc.Hex.parse(_.substr(0,32)),O=CryptoJS.enc.Hex.parse(_.substr(32,32)),n=CryptoJS.PBKDF2(e,o,{keySize:8,iterations:100});return CryptoJS.AES.decrypt(_.substring(64),n,{iv:O,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC}).toString(CryptoJS.enc.Utf8)}function oy_key_verify(_,e,o,O){window.crypto.subtle.importKey("jwk",{kty:"EC",crv:"P-256",x:_.substr(0,43),y:_.substr(43),ext:!0},{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]).then(function(_){window.crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},_,oy_buffer_encode(e,!0),oy_buffer_encode(o,!1)).then(function(_){O(_)}).catch(function(_){oy_log("Cryptographic error [VERIFY_B] "+_,1)})}).catch(function(_){oy_log("Cryptographic error [VERIFY_A]: "+_,1)})}function oy_key_sign(_,e,o){_=window.atob(_),window.crypto.subtle.importKey("jwk",{kty:"EC",crv:"P-256",d:_.substr(0,43),x:_.substr(43,43),y:_.substr(86),ext:!0},{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(function(_){window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},_,oy_buffer_encode(e,!1)).then(function(_){o(oy_buffer_decode(_,!0))}).catch(function(_){oy_log("Cryptographic error [SIGN_B]: "+_,1)})}).catch(function(_){oy_log("Cryptographic error [SIGN_A]: "+_,1)})}function oy_key_gen(_){window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(function(e){window.crypto.subtle.exportKey("jwk",e.privateKey).then(function(e){_(window.btoa(e.d+e.x+e.y),e.x+e.y)}).catch(function(_){oy_log("Cryptographic error [GEN_B]: "+_,1)})}).catch(function(_){oy_log("Cryptographic error [GEN_A]: "+_,1)})}function oy_reduce_sum(_,e){return _+e}function oy_handle_check(_){return"string"==typeof _&&"OY"===_.substr(0,2)&&_.length>20}function oy_public_check(_){return 86===_.length}function oy_db_error(_){"QuotaExceededError"===_.name||_.inner&&"QuotaExceededError"===_.inner.name?oy_data_deposit_purge():oy_log("OY_DB ERROR: "+_.name+" / "+_.message)}function oy_local_get(_,e,o){OY_DB.oy_local.get(_).then(_=>{void 0===_.oy_local_value?o(e):o(_.oy_local_value)}).catch(function(){})}function oy_local_set(_,e){return OY_DB.oy_local.put({oy_local_key:_,oy_local_value:e}).then(function(){oy_log("Updated local retention of "+_)}).catch(oy_db_error),!0}function oy_peer_add(_){if(oy_peer_check(_))return oy_log("Failed to add node "+oy_short(_)+" to peer list that already exists in peer list"),!1;return oy_node_connect(_,function(){OY_PEERS[_]=[Date.now()/1e3|0,-1,-1,0,[],0,[],0,[]],1==++OY_PEER_COUNT&&document.dispatchEvent(OY_PEERS_RECOVER),oy_node_reset(_)}),!0}function oy_peer_remove(_,e){return!!oy_peer_check(_)&&(oy_data_beam(_,"OY_PEER_TERMINATE",void 0===e?"OY_REASON_PEER_REMOVE":e),OY_PEER_COUNT--,delete OY_PEERS[_],0===OY_PEER_COUNT&&document.dispatchEvent(OY_PEERS_NULL),oy_node_reset(_),OY_PEER_COUNT<0?(oy_log("Peer management system failed",1),!1):(oy_log("Removed peer "+oy_short(_)+" with reason "+e),void(void 0!==e&&oy_node_punish(_,e))))}function oy_peer_pre_add(_){return OY_PEERS_PRE[_]=(Date.now()/1e3|0)+OY_PEER_PRETIME,!0}function oy_peer_pre_check(_){return void 0!==OY_PEERS_PRE[_]&&OY_PEERS_PRE[_]>=(Date.now()/1e3|0)}function oy_peer_latency(_,e){if(!oy_peer_check(_))return oy_log("Peer latency tracking was called on a non-existent peer"),!1;OY_PEERS[_][4].unshift(e),OY_PEERS[_][4].length>OY_LATENCY_TRACK&&OY_PEERS[_][4].pop(),OY_PEERS[_][3]=OY_PEERS[_][4].reduce(oy_reduce_sum)/OY_PEERS[_][4].length,oy_log("Latency data updated for peer "+oy_short(_))}function oy_peer_find(_){if(_===OY_SELF_SHORT)return!1;for(let e in OY_PEERS)if("oy_aggregate_node"!==e&&_===oy_short(e))return e;return!1}function oy_peer_rand(_){let e={};for(let o in OY_PEERS)"oy_aggregate_node"!==o&&-1===_.indexOf(oy_short(o))&&(e[o]=OY_PEERS[o]);if(0===Object.keys(e).length)return oy_log("Tried to select a peer whilst the peer list ran empty"),!1;let o=Object.keys(e);return o[o.length*Math.random()<<0]}function oy_peer_process(_,e,o){if(!oy_peer_check(_)&&void 0===OY_ORIGINS[_])return oy_log("Tried to call peer_process on a non-existent peer",1),!1;let O=Date.now()/1e3;if(void 0===OY_ORIGINS[_]&&(OY_PEERS[_][1]=O),"OY_BLOCK_COMMAND"===e){if(4!==o.length||"object"!=typeof o[0])return oy_log("Peer "+oy_short(_)+" sent invalid block command, will punish"),oy_node_punish(_,"OY_PUNISH_COMMAND_INVALID"),!1;if(o[2][1]<O+OY_MESH_BUFFER[0]&&O-o[2][1]<OY_MESH_EDGE+OY_MESH_BUFFER[0]&&o[2][1]-OY_BLOCK_TIME>=0&&o[2][1]-OY_BLOCK_TIME<OY_BLOCK_SECTORS[0][0]){let _=oy_hash_gen(JSON.stringify(o[2]));if(void 0===OY_BLOCK_COMMAND_KEY[o[2][2]]&&(OY_BLOCK_COMMAND_KEY[o[2][2]]=[]),OY_BLOCK_COMMAND_KEY[o[2][2]].length>=OY_BLOCK_KEY_LIMIT||-1!==OY_BLOCK_COMMAND_KEY[o[2][2]].indexOf(_))return!1;OY_BLOCK_COMMAND_KEY[o[2][2]].push(_),oy_block_command_verify([o[2],o[3]],function(e){!0===e&&(OY_BLOCK_COMMAND[_]=o,oy_data_route("OY_LOGIC_ALL","OY_BLOCK_COMMAND",o),"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(0,!1))})}return!0}if("OY_BLOCK_SYNC"===e){if(8!==o.length||"object"!=typeof o[0]||"object"!=typeof o[2]||o[0].length!==o[2].length||o[0][0]!==oy_short(o[6]))return oy_log("Peer "+oy_short(_)+" sent invalid block sync, will punish"),oy_node_punish(_,"OY_PUNISH_SYNC_INVALID"),!1;if(void 0===OY_BLOCK_SYNC[o[6]]&&o[3]<O+OY_MESH_BUFFER[0]&&o[3]-OY_BLOCK_TIME>=OY_BLOCK_SECTORS[0][0]&&o[3]-OY_BLOCK_TIME<OY_BLOCK_SECTORS[0][0]+OY_MESH_BUFFER[0]+(OY_BLOCK_SECTORS[1][0]*OY_BLOCK_DENSITY-OY_MESH_BUFFER[0])+2*OY_MESH_BUFFER[0]&&O-OY_BLOCK_TIME>=OY_BLOCK_SECTORS[0][0]&&O-OY_BLOCK_TIME<OY_BLOCK_SECTORS[0][0]+OY_BLOCK_SECTORS[1][0]){let e=Math.max(OY_BLOCK_MISS_MULTI_MIN,o[0].length*OY_BLOCK_MISS_MULTI),n=oy_short(o[4]);oy_block_sync_hop(o[0].slice(),o[2].slice(),n,e,0,performance.now(),function(){let e=oy_hash_gen(o[5]);oy_key_verify(o[6],o[4],o[3]+e+o[7],function(t){if(!0===t){let t={},E=[],Y=JSON.parse(LZString.decompressFromUTF16(o[5]));for(let _ in Y){let e=oy_hash_gen(JSON.stringify(Y[_][0]));if(void 0!==t[e])return!1;t[e]=Y[_][0],void 0===OY_BLOCK_COMMAND[e]&&E.push(Y[_])}oy_block_sync_verify(E,function(E){if(!0===E)if(void 0!==OY_ORIGINS[_]&&O<OY_ORIGINS[_])OY_BLOCK_SYNC[o[6]]=[!0,null,o,t];else if(void 0===OY_BLOCK_SYNC[o[6]])if(null!==OY_CHALLENGE_TRIGGER&&o[0].length===OY_CHALLENGE_TRIGGER){let _=oy_rand_gen();OY_BLOCK_SYNC[o[6]]=[!1,_+e,o,t];let O=o[0].slice(),n=O.shift();oy_data_route("OY_LOGIC_CHALLENGE","OY_BLOCK_SYNC_CHALLENGE",[[],oy_rand_gen(),O,n,_])}else OY_BLOCK_SYNC[o[6]]=[!0,null,o,t],oy_key_sign(OY_SELF_PRIVATE,n,function(_){o[2].push(_),oy_data_route("OY_LOGIC_ALL","OY_BLOCK_SYNC",o),"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(1,!1)})})}})},!0)}return!0}if("OY_BLOCK_SYNC_CHALLENGE"===e)return 5!==o.length||"object"!=typeof o[0]?(oy_log("Peer "+oy_short(_)+" sent invalid block sync challenge will punish"),oy_node_punish(_,"OY_PUNISH_SYNC_INVALID"),!1):(o[3]===OY_SELF_SHORT?oy_key_sign(OY_SELF_PRIVATE,o[4]+OY_BLOCK_SYNC_HASH,function(_){oy_data_route("OY_LOGIC_FOLLOW","OY_BLOCK_SYNC_CHALLENGE_RESPONSE",[[],o[0],OY_SELF_PUBLIC,_])}):oy_data_route("OY_LOGIC_CHALLENGE","OY_BLOCK_SYNC_CHALLENGE",o),"function"==typeof OY_MESH_MAP&&OY_MESH_MAP(o[0]),!0);if("OY_BLOCK_SYNC_CHALLENGE_RESPONSE"===e)return 4!==o.length||"object"!=typeof o[0]||"object"!=typeof o[1]||0===o[1].length||o[0][0]!==oy_short(o[2])?(oy_log("Peer "+oy_short(_)+" sent invalid block sync challenge response, will punish"),oy_node_punish(_,"OY_PUNISH_SYNC_INVALID"),!1):(o[1][0]===OY_SELF_SHORT?void 0!==OY_BLOCK_SYNC[o[2]]&&!1===OY_BLOCK_SYNC[o[2]][0]&&oy_key_verify(o[2],o[3],OY_BLOCK_SYNC[o[2]][1],function(_){!0===_&&(OY_BLOCK_SYNC[o[2]][0]=!0,oy_key_sign(OY_SELF_PRIVATE,oy_short(OY_BLOCK_SYNC[o[2]][2][4]),function(_){OY_BLOCK_SYNC[o[2]][2][2].push(_),oy_data_route("OY_LOGIC_ALL","OY_BLOCK_SYNC",OY_BLOCK_SYNC[o[2]][2]),"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(1,!1)}),(OY_PEER_COUNT<OY_BLOCK_PEERS_MIN||Math.random()<OY_PEER_SYNC_CHANCE)&&oy_node_initiate(o[2]),"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(1,!1))}):oy_data_route("OY_LOGIC_FOLLOW","OY_BLOCK_SYNC_CHALLENGE_RESPONSE",o),!0);if("OY_BLOCK_DIVE"===e)return 6!==o.length||"object"!=typeof o[0]||o[0][0]!==oy_short(o[5])?(oy_log("Peer "+oy_short(_)+" sent invalid block dive, will punish"),oy_node_punish(_,"OY_PUNISH_DIVE_INVALID"),!1):(-1===OY_BLOCK_DIVE_SET.indexOf(o[5])&&void 0!==OY_BLOCK_SYNC[o[5]]&&!0===OY_BLOCK_SYNC[o[5]][0]&&o[2]-OY_BLOCK_TIME>=OY_BLOCK_SECTORS[0][0]+OY_BLOCK_SECTORS[1][0]&&o[2]-OY_BLOCK_TIME<OY_BLOCK_SECTORS[0][0]+OY_BLOCK_SECTORS[1][0]+OY_MESH_BUFFER[0]+(OY_BLOCK_SECTORS[0][0]*OY_BLOCK_DENSITY-OY_MESH_BUFFER[0])+2*OY_MESH_BUFFER[0]&&O-OY_BLOCK_TIME>=OY_BLOCK_SECTORS[0][0]+OY_BLOCK_SECTORS[1][0]&&O-OY_BLOCK_TIME<OY_BLOCK_SECTORS[2][0]&&oy_key_verify(o[5],o[3],o[2]+oy_hash_gen(o[4]),function(_){if(!0===_){OY_BLOCK_DIVE_SET.push(o[5]),oy_data_route("OY_LOGIC_ALL","OY_BLOCK_DIVE",o),o[4]=JSON.parse(LZString.decompressFromUTF16(o[4]));for(let _ in o[4])void 0===OY_BLOCK_DIVE[o[4][_][0]]&&(OY_BLOCK_DIVE[o[4][_][0]]={}),void 0===OY_BLOCK_DIVE[o[4][_][0]][o[4][_][1]]&&(OY_BLOCK_DIVE[o[4][_][0]][o[4][_][1]]=0),OY_BLOCK_DIVE[o[4][_][0]][o[4][_][1]]++;"function"==typeof OY_MESH_MAP&&OY_MESH_MAP(o[0]),"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(2,!1),!1===OY_BOOST_MODE&&-1===OY_BOOST.indexOf(o[5])&&OY_BOOST.push(o[5])}}),!0);if("OY_DATA_PUSH"===e)return 4!==o.length||"object"!=typeof o[0]||!oy_handle_check(o[1])||o[3].length>OY_DATA_CHUNK?(oy_log("Peer "+oy_short(_)+" sent invalid push data sequence, will punish"),oy_node_punish(_,"OY_PUNISH_PUSH_INVALID"),!1):(oy_data_deposit(o[1],o[2],o[3],function(_){!0===_&&oy_data_route("OY_LOGIC_FOLLOW","OY_DATA_DEPOSIT",[[],o[0],OY_SELF_SHORT,o[1],o[2]])}),Math.random()<=OY_MESH_PUSH_CHANCE&&(oy_log("Randomness led to beaming handle "+oy_short(o[1])+" forward along the mesh"),oy_data_route("OY_LOGIC_CHAOS","OY_DATA_PUSH",o)),!0);if("OY_DATA_PULL"===e){if(4!==o.length||"object"!=typeof o[0]||!oy_handle_check(o[2])||o[3].length>OY_DATA_PULL_NONCE_MAX)return oy_log("Peer "+oy_short(_)+" sent invalid pull data sequence, will punish"),oy_node_punish(_,"OY_PUNISH_PULL_INVALID"),!1;oy_log("Beaming handle "+oy_short(o[2])+" forward along the mesh"),oy_data_route("OY_LOGIC_ALL","OY_DATA_PULL",o);for(let _ in o[3])oy_data_deposit_get(o[2],o[3][_],function(e){e&&(oy_log("Found nonce "+o[3][_]+" for handle "+o[2]),oy_data_route("OY_LOGIC_FOLLOW","OY_DATA_FULFILL",[[],o[0],"oy_source_void",o[2],o[3][_],e]))});return!0}if("OY_DATA_DEPOSIT"===e)return 5===o.length&&"object"==typeof o[0]&&"object"==typeof o[1]&&0!==o[1].length&&oy_handle_check(o[3])?(o[1][0]===OY_SELF_SHORT?(oy_log("Data deposit sequence with handle "+oy_short(o[3])+" at nonce "+o[4]+" found self as the final destination"),oy_data_tally(o[2],o[3],o[4],o[0].length)):(oy_log("Continuing deposit confirmation of handle "+oy_short(o[3])),oy_data_route("OY_LOGIC_FOLLOW","OY_DATA_DEPOSIT",o)),!0):(oy_log("Peer "+oy_short(_)+" sent invalid deposit data sequence, will punish"),oy_node_punish(_,"OY_PUNISH_DEPOSIT_INVALID"),!1);if("OY_DATA_FULFILL"===e)return 6===o.length&&"object"==typeof o[0]&&"object"==typeof o[1]&&oy_handle_check(o[3])?(o[1][0]===OY_SELF_SHORT?(oy_log("Data fulfillment sequence with handle "+oy_short(o[3])+" at nonce "+o[4]+" found self as the final destination"),oy_data_collect(o[2],o[3],o[4],o[5],o[0].length)):(oy_log("Continuing fulfillment of handle "+oy_short(o[3])),o[1].length===OY_MESH_SOURCE&&(o[2]=o[1].join("!")),oy_data_route("OY_LOGIC_FOLLOW","OY_DATA_FULFILL",o),Math.random()<=OY_MESH_FULLFILL_CHANCE&&(oy_log("Data deposit upon mesh fulfill invoked for handle "+oy_short(o[3])),oy_data_deposit(o[3],o[4],o[5]))),!0):(oy_log("Peer "+oy_short(_)+" sent invalid fulfill data sequence, will punish"),oy_node_punish(_,"OY_PUNISH_FULFILL_INVALID"),!1);if("OY_CHANNEL_BROADCAST"===e){if(8!==o.length||"object"!=typeof o[0]||!oy_channel_check(o[2]))return oy_log("Peer "+oy_short(_)+" sent invalid channel broadcast, will punish"),oy_node_punish(_,"OY_PUNISH_CHANNEL_INVALID"),!1;oy_channel_verify(o,function(e){if(null===e)oy_log("Was unable to verify broadcast from channel "+oy_short(o[2])+" at no fault of the sending peer");else{if(!0!==e)return oy_log("Peer "+oy_short(_)+" sent an unverifiable channel broadcast, will punish"),oy_node_punish(_,"OY_PUNISH_CHANNEL_VERIFY"),!1;if(oy_log("Beaming channel "+oy_short(o[2])+" forward along the mesh"),oy_data_route("OY_LOGIC_ALL","OY_CHANNEL_BROADCAST",o),void 0!==OY_CHANNEL_LISTEN[o[2]]){oy_channel_top(o[2],o[0],o[5]);let _=oy_hash_gen(o[4]),e=function(){if(null===OY_CHANNEL_LISTEN[o[2]][0])return!1;oy_key_sign(OY_CHANNEL_LISTEN[o[2]][0],_,function(_){oy_log("Beaming echo for channel "+oy_short(o[2])),oy_data_route("OY_LOGIC_FOLLOW","OY_CHANNEL_ECHO",[[],o[0],o[1],o[2],_,OY_CHANNEL_LISTEN[o[2]][1]])})};if("OY_CHANNEL_PING"===o[3])return oy_log("Received ping broadcast for channel "+oy_short(o[2])),e(),!0;if(Math.abs(o[7]-oy_channel_top_count(o[2]))>OY_CHANNEL_TOP_TOLERANCE)return!1;if(void 0===OY_CHANNEL_RENDER[o[2]]&&(OY_CHANNEL_RENDER[o[2]]={}),void 0!==OY_CHANNEL_RENDER[o[2]][_])return oy_log("Already rendered broadcast hash "+oy_short(_)+" from channel "+oy_short(o[2])+", will ignore"),!1;OY_CHANNEL_RENDER[o[2]][_]=!0;let O=o.slice();O[6]>1554662400?O[3]=LZString.decompressFromUTF16(O[3]):O[3]=oy_base_decode(O[3]),OY_CHANNEL_LISTEN[o[2]][2](_,O),O=null;let n=o.slice();n[0]=null,n[1]=null,n[8]=[],null!==OY_CHANNEL_LISTEN[o[2]][0]?(oy_key_sign(OY_CHANNEL_LISTEN[o[2]][0],_,function(e){n[8].push([e,OY_CHANNEL_LISTEN[o[2]][1]]),void 0===OY_CHANNEL_KEEP[o[2]]&&(OY_CHANNEL_KEEP[o[2]]={}),void 0===OY_CHANNEL_KEEP[o[2]][_]&&(OY_CHANNEL_KEEP[o[2]][_]=n),oy_channel_commit(o[2],_,n)}),e()):oy_channel_commit(o[2],_,n)}}})}else if("OY_CHANNEL_ECHO"===e){if(6!==o.length||"object"!=typeof o[0]||"object"!=typeof o[1]||0===o[1].length||!oy_channel_check(o[3]))return oy_log("Peer "+oy_short(_)+" sent invalid channel echo, will punish"),oy_node_punish(_,"OY_PUNISH_ECHO_INVALID"),!1;if(o[1][0]===OY_SELF_SHORT){oy_log("Echo for channel "+oy_short(o[3])+" found self as the final destination");let _=o[3]+o[2];if(void 0===OY_CHANNEL_ECHO[_])return oy_log("Could not find echo session for channel "+oy_short(o[3])),!1;if(O>OY_CHANNEL_ECHO[_][0])return oy_log("Echo session for channel "+oy_short(o[3])+" has expired"),delete OY_CHANNEL_ECHO[_],!1;if(!oy_channel_approved(o[3],o[5]))return oy_log("Received echo from unapproved public key for channel "+oy_short(o[3])),!1;if(-1!==OY_CHANNEL_ECHO[_][3].indexOf(o[5]))return oy_log("Received duplicate echo for channel "+oy_short(o[3])),!1;OY_CHANNEL_ECHO[_][3].push(o[5]),oy_key_verify(o[5],o[4],OY_CHANNEL_ECHO[_][1],function(e){!0===e?(oy_channel_top(o[3],o[0],o[5]),OY_CHANNEL_ECHO[_][2](OY_CHANNEL_ECHO[_][1])):oy_log("Invalid echo received for channel "+oy_short(o[3]))})}else oy_log("Continuing echo of channel "+oy_short(o[3])),oy_data_route("OY_LOGIC_FOLLOW","OY_CHANNEL_ECHO",o)}else{if("OY_CHANNEL_RECOVER"===e){if(7!==o.length||"object"!=typeof o[0]||"object"!=typeof o[1]||0===o[1].length||!oy_channel_check(o[2]))return oy_log("Peer "+oy_short(_)+" sent invalid channel recover request, will punish"),oy_node_punish(_,"OY_PUNISH_RECOVER_INVALID"),!1;if(o[1][0]===OY_SELF_SHORT){if(oy_log("Channel recover request for channel "+oy_short(o[2])+" found self as the final destination"),void 0===OY_CHANNEL_LISTEN[o[2]]||void 0===OY_CHANNEL_KEEP[o[2]])return oy_log("Channel "+oy_short(o[2])+" is not being kept locally"),!1;{null===o[4]||null===o[5]||O-o[6]>OY_MESH_EDGE+OY_MESH_BUFFER[0]?oy_channel_top(o[2],o[0],!1):oy_key_verify(o[5],o[4],o[6]+o[2],function(_){!0===_&&oy_channel_top(o[2],o[0],o[5])});let _=[];for(let e in OY_CHANNEL_KEEP[o[2]])-1===o[3].indexOf(e)&&_.push(OY_CHANNEL_KEEP[o[2]][e]);if(0===_.length)return oy_log("No unknown broadcast payloads found for channel "+oy_short(o[2])),!1;_.sort(function(_,e){return e[6]-_[6]});let e=Math.max(1,oy_channel_top_count(o[2])[0]);for(;_.length>OY_CHANNEL_RESPOND_MAX*e;)_.pop();for(_.sort(function(){return.5-Math.random()});_.length>OY_CHANNEL_RESPOND_MAX;)_.pop();oy_data_route("OY_LOGIC_FOLLOW","OY_CHANNEL_RESPOND",[[],o[0],o[2],_])}}else oy_log("Continuing channel recover request of channel "+oy_short(o[2])),oy_data_route("OY_LOGIC_FOLLOW","OY_CHANNEL_RECOVER",o);return!0}if("OY_CHANNEL_RESPOND"===e){if(4!==o.length||"object"!=typeof o[0]||"object"!=typeof o[1]||0===o[1].length||!oy_channel_check(o[2])||0===o[3].length)return oy_log("Peer "+oy_short(_)+" sent invalid channel respond sequence, will punish"),oy_node_punish(_,"OY_PUNISH_RESPOND_INVALID"),!1;if(o[1][0]===OY_SELF_SHORT){oy_log("Channel respond sequence for channel "+oy_short(o[2])+" found self as the final destination");let _=null;if(void 0!==OY_CHANNEL_TOP[o[2]])for(let e in OY_CHANNEL_TOP[o[2]])if(OY_CHANNEL_TOP[o[2]][e][2][0]===o[0][0]){_=e;break}if(null===_||O-OY_CHANNEL_TOP[o[2]][_][1]>OY_CHANNEL_RECOVERTIME)return oy_log("A local session was not found for respond sequence for channel "+oy_short(o[2])),!1;oy_log("Local session found for respond sequence for channel "+oy_short(o[2])),void 0===OY_CHANNEL_KEEP[o[2]]&&(OY_CHANNEL_KEEP[o[2]]={});for(let _ in o[3])oy_channel_approved(o[2],o[3][_][5])&&O-o[3][_][6]<=OY_CHANNEL_EXPIRETIME?oy_key_verify(o[3][_][5],o[3][_][4],o[3][_][6]+o[3][_][7]+o[3][_][3],function(e){if(!0===e){let e=oy_hash_gen(o[3][_][4]);oy_log("Valid primary signature for broadcast hash "+oy_short(e)+" from channel "+oy_short(o[2]));for(let O in o[3][_][8])o[3][_][8][O][1]!==o[3][_][5]&&oy_channel_approved(o[2],o[3][_][8][O][1])?oy_key_verify(o[3][_][8][O][1],o[3][_][8][O][0],e,function(n){if(!0===n)if(oy_log("Valid secondary signature for broadcast hash "+oy_short(e)+" from channel "+oy_short(o[2])),void 0===OY_CHANNEL_KEEP[o[2]][e])OY_CHANNEL_KEEP[o[2]][e]=[o[3][_][0],o[3][_][1],o[3][_][2],o[3][_][3],o[3][_][4],o[3][_][5],o[3][_][6],o[3][_][7],[[o[3][_][8][O][0],o[3][_][8][O][1]]]];else if(void 0!==OY_CHANNEL_KEEP[o[2]][e][8]){let n=!0;for(let t in OY_CHANNEL_KEEP[o[2]][e][8])if(OY_CHANNEL_KEEP[o[2]][e][8][t][1]===o[3][_][8][O][1]){n=!1;break}!0===n&&(OY_CHANNEL_KEEP[o[2]][e][8].push([o[3][_][8][O][0],o[3][_][8][O][1]]),oy_channel_commit(o[2],e,OY_CHANNEL_KEEP[o[2]][e]))}else oy_log("Could not record channel respond sequence for broadcast hash "+oy_short(e)+" from channel "+oy_short(o[2])+", go tell Bruno",1);else oy_log("Invalid secondary signature for broadcast hash "+oy_short(e)+" from channel "+oy_short(o[2]))}):oy_log("Unapproved secondary signature for broadcast hash "+oy_short(e)+" from channel "+oy_short(o[2]))}else oy_log("Invalid primary signature for broadcast hash null from channel "+oy_short(o[2]))}):oy_log("Primary and/or secondary signatures were not found in the approval list of the current block for channel "+oy_short(o[2]))}else oy_log("Continuing channel respond sequence of channel "+oy_short(o[2])),oy_data_route("OY_LOGIC_FOLLOW","OY_CHANNEL_RESPOND",o)}else{if("OY_PEER_CHALLENGE"===e)return null!==OY_BLOCK_HASH&&(void 0!==OY_BLOCK_CHALLENGE[_]&&oy_key_verify(_,o,OY_MESH_DYNASTY+OY_BLOCK_HASH,function(e){!0===e&&delete OY_BLOCK_CHALLENGE[_]}),!0);if("OY_PEER_LATENCY"===e)return null!==OY_BLOCK_HASH&&(oy_key_sign(OY_SELF_PRIVATE,OY_MESH_DYNASTY+OY_BLOCK_HASH+o[0],function(e){oy_log("Signed peer latency sequence from "+oy_short(_)),o[0]=e,oy_data_beam(_,"OY_LATENCY_RESPONSE",o)}),!0);if("OY_PEER_TERMINATE"===e)return oy_peer_remove(_,"OY_PUNISH_TERMINATE_RETURN"),oy_log("Removed peer "+oy_short(_)+" who terminated with reason: "+o),!0;if("OY_PEER_BLACKLIST"===e)return oy_peer_remove(_,"OY_PUNISH_BLACKLIST_RETURN"),oy_log("Punished peer "+oy_short(_)+" who blacklisted self"),!0;if("OY_LATENCY_DECLINE"===e)return oy_log("Peer "+oy_short(_)+" declined our latency request, will cease and punish"),oy_node_reset(_),oy_node_punish(_,"OY_PUNISH_LATENCY_DECLINE"),!1}}}function oy_peer_check(_){return void 0!==OY_PEERS[_]}function oy_peer_report(){let _=new XMLHttpRequest;_.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if("ERROR"===this.responseText.substr(0,5)||0===this.responseText.length)return oy_log("Received error from peer_report@top: "+this.responseText),!1;"OY_REPORT_SUCCESS"===this.responseText?oy_log("Peer report to top succeeded"):oy_log("Peer report to top failed")}};let e={};for(let _ in OY_PEERS)"oy_aggregate_node"!==_&&(e[_]=OY_PEERS[_].slice(),e[_][4]=null,e[_][6]=null,e[_][8]=null);_.open("POST","https://top.oyster.org/oy_peer_report.php",!0),_.send("oy_peer_report="+JSON.stringify([OY_SELF_PUBLIC,e,OY_BLACKLIST]))}function oy_boost(){if(0===OY_BOOST.length)return OY_BOOST_MODE=!1,!0;OY_BOOST_MODE=!0,oy_node_initiate(OY_BOOST.pop()),oy_chrono(function(){oy_boost()},OY_BOOST_DELAY)}function oy_node_reset(_){delete OY_BLOCK_CHALLENGE[_],delete OY_LATENCY[_],delete OY_PROPOSED[_],delete OY_PEERS_PRE[_],delete OY_ENGINE[0][_]}function oy_node_connect(_,e){if(!1===_||_===OY_SELF_PUBLIC)return oy_log("Tried to connect to invalid node ID: "+_,1),!1;let o=Date.now()/1e3;if(void 0!==OY_WARM[_])return!1;if(void 0!==OY_COLD[_])return!1;if(void 0===OY_NODES[_]||!1===OY_NODES[_][0].open){void 0!==OY_NODES[_]&&OY_NODES[_][0].close();let O=OY_CONN.connect(_);return void 0!==O&&(OY_WARM[_]=o,O.on("open",function(){delete OY_WARM[_],OY_NODES[_]=[O,o],oy_log("Connection status: "+OY_NODES[_][0].open+" with node "+oy_short(_)),"function"==typeof e&&e()}),O.on("error",function(){delete OY_WARM[_],delete OY_NODES[_],oy_log("Connection to node "+oy_short(_)+" failed, will punish"),oy_node_punish(_,"OY_PUNISH_CONNECT_FAIL")}),!1)}return!0===OY_NODES[_][0].open&&(OY_NODES[_][1]=o,"function"==typeof e&&e(),!0)}function oy_node_disconnect(_){return void 0===OY_COLD[_]&&void 0!==OY_NODES[_]&&(!0===OY_NODES[_][0].open?(OY_COLD[_]=!0,oy_chrono(function(){void 0!==OY_NODES[_]&&OY_NODES[_][0].close(),delete OY_COLD[_],delete OY_NODES[_],oy_log("Disconnected from node "+oy_short(_))},1e3*OY_NODE_DELAYTIME)):(OY_NODES[_][0].close(),delete OY_NODES[_]),!0)}function oy_node_proposed(_,e){return void 0!==OY_PROPOSED[_]&&(OY_PROPOSED[_][0]<Date.now()/1e3?(delete OY_PROPOSED[_],!1):void 0===e||OY_PROPOSED[_][1]===e)}function oy_node_blocked(_){return void 0!==OY_BLACKLIST[_]&&OY_BLACKLIST[_][0]>=OY_NODE_TOLERANCE&&(OY_BLACKLIST[_][1]<Date.now()/1e3?(delete OY_BLACKLIST[_],!1):(oy_peer_check(_)&&oy_peer_remove(_),!0))}function oy_node_punish(_,e){if(void 0===e&&(e=null),void 0===OY_BLACKLIST[_])OY_BLACKLIST[_]=["OY_PUNISH_BLACKLIST_RETURN"===e?OY_NODE_TOLERANCE:1,Date.now()/1e3+OY_NODE_BLACKTIME,!1,[e]];else{if(OY_BLACKLIST[_][0]>=OY_NODE_TOLERANCE)return!1;OY_BLACKLIST[_][0]++,OY_BLACKLIST[_][1]=Date.now()/1e3+OY_NODE_BLACKTIME,OY_BLACKLIST[_][3].push(e)}return oy_node_reset(_),OY_BLACKLIST[_][0]>=OY_NODE_TOLERANCE&&(!1===OY_BLACKLIST[_][2]&&(OY_BLACKLIST[_][2]=!0,oy_data_beam(_,"OY_PEER_BLACKLIST",e)),delete OY_ORIGINS[_],delete OY_CLONES[_],oy_peer_check(_)&&oy_peer_remove(_,e)),oy_log("Punished node "+oy_short(_)+" with reason "+e),!0}function oy_node_initiate(_){if(oy_log("Initiating peership with "+oy_short(_)),oy_peer_check(_))return oy_log("Halted initiation with agreed upon peer "+oy_short(_)),!1;if(oy_peer_pre_check(_))return oy_log("Halted initiation with pre peer "+oy_short(_)),!1;if(oy_node_proposed(_))return oy_log("Halted initiation with proposed-to node "+oy_short(_)),!1;if(oy_node_blocked(_))return oy_log("Halted initiation with blacklisted node "+oy_short(_)),!1;if(oy_latency_check(_))return oy_log("Halted initiation with node "+oy_short(_)+" during a latency session"),!1;if(OY_PEER_COUNT>=OY_PEER_MAX)return oy_log("Halted initiation whilst peer list is saturated"),!1;if(Date.now()/1e3<=OY_BLOCK_SEEDTIME)return oy_log("Halted initiation for pending meshblock seeding event"),!1;let e,o=function(){oy_data_beam(_,"OY_PEER_REQUEST",null),OY_PROPOSED[_]=[Date.now()/1e3+OY_NODE_PROPOSETIME,!1]},O=function(){if(Object.keys(OY_ORIGINS).length>=OY_CLONE_ORIGIN_MAX)return-1===OY_BOOST.indexOf(_)&&OY_BOOST.push(_),!1;oy_data_beam(_,"OY_CLONE_REQUEST",null),OY_PROPOSED[_]=[Date.now()/1e3+OY_NODE_PROPOSETIME,!0]};return e=null===OY_BLOCK_HASH&&0===OY_PEER_COUNT?O:null!==OY_BLOCK_HASH&&0===OY_PEER_COUNT&&Object.keys(OY_ORIGINS).length<OY_CLONE_ORIGIN_MAX&&Math.random()<OY_CLONE_AFFINITY&&Date.now()/1e3-OY_BLOCK_SEEDTIME>OY_BLOCK_SEED_BUFFER?O:o,oy_node_connect(_,e),!0}function oy_node_assign(){if(Date.now()/1e3<=OY_BLOCK_SEEDTIME)return!1;let _=new XMLHttpRequest;_.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if("ERROR"===this.responseText.substr(0,5)||0===this.responseText.length)return oy_log("Received error from node_assign@top: "+this.responseText),!1;let _=JSON.parse(this.responseText),e=0;for(let o in _)oy_chrono(function(){oy_node_initiate(_[o])},e),e+=OY_NODE_ASSIGN_DELAY}},_.open("POST","https://top.oyster.org/oy_node_assign.php",!0),_.send("oy_node_id="+OY_SELF_PUBLIC)}function oy_node_negotiate(_,e,o){let O=Date.now()/1e3;if("OY_PEER_TERMINATE"===e)return delete OY_ORIGINS[_],delete OY_CLONES[_],oy_node_reset(_),oy_log("Received termination notice: "+o+" from non-peer"),!1;if("OY_PEER_BLACKLIST"===e)return delete OY_ORIGINS[_],delete OY_CLONES[_],oy_node_punish(_,"OY_PUNISH_BLACKLIST_RETURN"),oy_log("Node "+oy_short(_)+" blacklisted us, will return the favour"),!1;if("OY_PEER_AFFIRM"===e)return oy_peer_pre_check(_)?(oy_peer_add(_),oy_log("Confirmed mutual peer "+oy_short(_)),!0):(oy_log("Received a peership affirmation notice from a non-peer, will punish"),oy_node_punish(_,"OY_PUNISH_FALSE_AFFIRM"),!1);if("OY_PEER_LATENCY"===e&&(oy_node_proposed(_,!1)||oy_peer_pre_check(_)))return null!==OY_BLOCK_HASH&&(oy_key_sign(OY_SELF_PRIVATE,OY_MESH_DYNASTY+OY_BLOCK_HASH+o[0],function(e){oy_log("Signed peer latency sequence from "+oy_short(_)),o[0]=e,oy_data_beam(_,"OY_LATENCY_RESPONSE",o)}),!0);if("OY_PEER_LATENCY"===e)return oy_log("Node "+oy_short(_)+" sent a latency spark request whilst not a peer, will decline"),oy_data_beam(_,"OY_LATENCY_DECLINE",null),!1;if("OY_PEER_REQUEST"===e){let e;return oy_node_connect(_,e=null===OY_BLOCK_HASH||O<=OY_BLOCK_SEEDTIME?function(){oy_data_beam(_,"OY_PEER_UNREADY",null)}:function(){oy_latency_test(_,"OY_PEER_REQUEST",!0)}),!0}if("OY_CLONE_REQUEST"===e){let e;return e=O>OY_BLOCK_SEEDTIME&&null!==OY_BLOCK_HASH&&null!==OY_CLONE_UPTIME&&OY_CLONE_UPTIME>=OY_CLONE_UPTIME_MIN&&OY_PEER_COUNT>=OY_BLOCK_PEERS_MIN&&Object.keys(OY_CLONES).length<OY_CLONE_CLONE_MAX?function(){OY_CLONES[_]=[O+(OY_CLONE_LIVETIME-OY_CLONE_BUFFERTIME),0],oy_data_beam(_,"OY_CLONE_ACCEPT",null)}:function(){oy_data_beam(_,"OY_CLONE_UNREADY",null)},oy_node_connect(_,e),!0}if("OY_CLONE_AFFIRM"===e)return void 0!==OY_CLONES[_]&&O<OY_CLONES[_][0]&&0===OY_CLONES[_][1]&&(OY_CLONES[_][1]=1),!0;if("OY_CLONE_PUSH"===e){if(void 0!==OY_ORIGINS[_]&&O<OY_ORIGINS[_]&&O<OY_BLOCK_TIME+OY_BLOCK_SECTORS[0][0]){OY_CLONE_BUILD[o[1]]=o[2];let e=-1;for(let _ in OY_CLONE_BUILD)e++;if(e===o[0]){let e=OY_CLONE_BUILD.join("");OY_BLOCK=JSON.parse(e),OY_BLOCK_HASH=oy_hash_gen(e),oy_data_beam(_,"OY_CLONE_HASH",OY_BLOCK_HASH)}}return!0}return"OY_CLONE_HASH"===e?(void 0!==OY_CLONES[_]&&O<OY_CLONES[_][0]&&2===OY_CLONES[_][1]&&O<OY_BLOCK_TIME+OY_BLOCK_SECTORS[0][0]&&o===OY_BLOCK_HASH&&(OY_CLONES[_][1]=3),!0):"OY_LATENCY_DECLINE"===e?(oy_log("Node "+oy_short(_)+" declined our latency request, will cease and punish"),oy_node_punish(_,"OY_PUNISH_LATENCY_DECLINE"),!1):oy_node_proposed(_,!1)?("OY_PEER_ACCEPT"===e?oy_latency_test(_,"OY_PEER_ACCEPT",!0):(oy_log("Node "+oy_short(_)+" rejected peer request ["+e+"]: "+o),"OY_PEER_UNREADY"!==e&&oy_node_punish(_,"OY_PUNISH_PEER_REJECT")),!0):oy_node_proposed(_,!0)?("OY_CLONE_ACCEPT"===e?Object.keys(OY_ORIGINS).length<OY_CLONE_ORIGIN_MAX&&(OY_ORIGINS[_]=O+OY_CLONE_LIVETIME,oy_data_beam(_,"OY_CLONE_AFFIRM",null)):(oy_log("Node "+oy_short(_)+" rejected clone request ["+e+"]"),"OY_CLONE_UNREADY"!==e&&oy_node_punish(_,"OY_PUNISH_CLONE_REJECT")),!0):(oy_log("Node "+oy_short(_)+" sent an incoherent message with flag "+e),oy_node_punish(_,"OY_PUNISH_DATA_INCOHERENT"),!1)}function oy_latency_response(_,e){if(void 0===OY_LATENCY[_])return oy_log("Node "+oy_short(_)+" sent a latency response whilst no latency session exists"),oy_node_punish(_,"OY_PUNISH_LATENCY_NONE"),!1;let o=Date.now()/1e3;oy_key_verify(_,e[0],OY_MESH_DYNASTY+OY_BLOCK_HASH+OY_LATENCY[_][0],function(O){if(!1===O)return oy_log("Node "+oy_short(_)+" failed to sign latency sequence, will punish"),oy_node_punish(_,"OY_PUNISH_SIGN_FAIL"),delete OY_LATENCY[_],!1;if(OY_LATENCY[_][0].repeat(OY_LATENCY_SIZE)===e[1]){if(oy_peer_check(_)&&(OY_PEERS[_][1]=o),OY_LATENCY[_][2]++,OY_LATENCY[_][4]+=o-OY_LATENCY[_][3],OY_LATENCY[_][1]!==OY_LATENCY[_][2])return oy_log("There was a problem with the latency test with node "+oy_short(_)+", perhaps simultaneous instances"),!1;if(OY_LATENCY[_][2]>=OY_LATENCY_REPEAT){let e=OY_LATENCY[_][4]/OY_LATENCY[_][2];if(oy_log("Finished latency test ["+OY_LATENCY[_][5]+"] with node "+oy_short(_)+": "+e.toFixed(2)+" seconds"),"OY_PEER_REQUEST"===OY_LATENCY[_][5]||"OY_PEER_ACCEPT"===OY_LATENCY[_][5]){if(e>OY_LATENCY_MAX)oy_log("Node "+oy_short(_)+" has latency that breaches max, will punish"),"OY_PEER_ACCEPT"===OY_LATENCY[_][5]?oy_data_beam(_,"OY_PEER_TERMINATE","OY_PUNISH_LATENCY_BREACH"):oy_data_beam(_,"OY_PEER_REJECT","OY_PUNISH_LATENCY_BREACH"),oy_node_punish(_,"OY_PUNISH_LATENCY_BREACH");else if(OY_PEER_COUNT<OY_PEER_MAX)"OY_PEER_ACCEPT"===OY_LATENCY[_][5]?(oy_peer_add(_),oy_data_beam(_,"OY_PEER_AFFIRM",null),oy_log("Added node "+oy_short(_)+" as a peer")):(oy_peer_pre_add(_),oy_data_beam(_,"OY_PEER_ACCEPT",null),oy_log("Added node "+oy_short(_)+" to pre peer list")),oy_peer_latency(_,e);else if(OY_PEER_COUNT<=OY_PEER_MAX){let o,O=[!1,-1];for(o in OY_PEERS)"oy_aggregate_node"!==o&&OY_PEERS[o][3]>O[1]&&(O=[o,OY_PEERS[o][3]]);oy_log("Current weakest peer is "+oy_short(O[0])+" with latency of "+O[1].toFixed(4)),e*(1+OY_LATENCY_GEO_SENS)<O[1]?(oy_log("New peer request has better latency than current weakest peer"),oy_peer_remove(O[0],"OY_PUNISH_LATENCY_DROP"),"OY_PEER_ACCEPT"===OY_LATENCY[_][5]?(oy_peer_add(_),oy_data_beam(_,"OY_PEER_AFFIRM",null),oy_log("Added node "+oy_short(_)+" as a peer")):(oy_peer_pre_add(_),oy_data_beam(_,"OY_PEER_ACCEPT",null),oy_log("Added node "+oy_short(_)+" to pre peer list")),oy_peer_latency(_,e),oy_log("Removed peer "+oy_short(O[0])+" and potentially added peer "+oy_short(_))):(oy_log("New peer request has insufficient latency"),"OY_PEER_ACCEPT"===OY_LATENCY[_][5]?oy_data_beam(_,"OY_PEER_TERMINATE","OY_PUNISH_LATENCY_WEAK"):oy_data_beam(_,"OY_PEER_REJECT","OY_PUNISH_LATENCY_WEAK"),oy_node_punish(_,"OY_PUNISH_LATENCY_WEAK"))}}else oy_peer_check(_)&&"OY_PEER_ROUTINE"===OY_LATENCY[_][5]&&(oy_data_beam(_,"OY_PEER_AFFIRM",null),oy_peer_latency(_,e));return oy_peer_check(_)&&(OY_PEERS[_][2]=o),delete OY_LATENCY[_],!0}oy_latency_test(_,OY_LATENCY[_][5],!1)}else oy_log("Node "+oy_short(_)+" sent an invalid latency ping, will punish"),oy_node_punish(_,"OY_PUNISH_LATENCY_INVALID")})}function oy_latency_test(_,e,o){if(void 0===OY_LATENCY[_])OY_LATENCY[_]=[null,0,0,0,0,e];else if(!0===o)return oy_log("New duplicate latency instance with "+oy_short(_)+" was blocked"),!1;return e!==OY_LATENCY[_][5]?(oy_log("Two simultaneous latency test instances crashed into each other",1),!1):(OY_LATENCY[_][0]=oy_rand_gen(OY_LATENCY_LENGTH),oy_data_beam(_,"OY_PEER_LATENCY",[OY_LATENCY[_][0],OY_LATENCY[_][0].repeat(OY_LATENCY_SIZE)])?(OY_LATENCY[_][1]++,OY_LATENCY[_][3]=Date.now()/1e3,oy_log("Latency ping sent to node "+oy_short(_)),!0):(delete OY_LATENCY[_],oy_log("Latency ping to node "+oy_short(_)+" failed",1),!1))}function oy_latency_check(_){return void 0!==OY_LATENCY[_]}function oy_data_measure(_,e,o){if(!oy_peer_check(e)&&"oy_aggregate_node"!==e)return oy_log("Call to data_measure was made with non-existent peer: "+oy_short(e)),!1;let O,n=Date.now()/1e3;if(O=!1===_?8:6,void 0===OY_PEERS[e])return!1;if(void 0===OY_PEERS[e][O][0]||void 0===OY_PEERS[e][O][0][0])return OY_PEERS[e][O-1]=0,OY_PEERS[e][O].push([n,o]),!0;for(;void 0!==OY_PEERS[e][O][0]&&n-OY_PEERS[e][O][0][0]>OY_MESH_MEASURE;)OY_PEERS[e][O].shift();if(OY_PEERS[e][O].length<(!1===_?OY_MESH_SOAK_SAMPLE:OY_MESH_BEAM_SAMPLE)||OY_PEERS[e][O][0][0]===n)return OY_PEERS[e][O-1]=0,OY_PEERS[e][O].push([n,o]),!0;let t=0;for(let _ in OY_PEERS[e][O])t+=OY_PEERS[e][O][_][1];if(OY_PEERS[e][O-1]=Math.round(t/(n-OY_PEERS[e][O][0][0])),!1===_)return OY_PEERS[e][O].push([n,o]),OY_PEERS[e][O-1]<=OY_MESH_FLOW*OY_MESH_SOAK_BUFFER;{let _=OY_PEERS[e][O-1]/OY_MESH_FLOW*(o/(OY_DATA_CHUNK/OY_MESH_BEAM_COOL)),t=!0;return _>OY_MESH_BEAM_MIN&&(t=Math.random()>_),!0===t&&OY_PEERS[e][O].push([n,o]),t}}function oy_data_push(_,e,o){let O=!1;if(null==o){let e=oy_rand_gen(8);_=oy_crypt_encrypt(_,e),O=(o="OY"+oy_rand_gen()+oy_hash_gen(_))+Math.ceil(_.length/OY_DATA_CHUNK)+"@"+e,e=null}if(void 0===OY_PUSH_HOLD[o]){if(null===_)return oy_log("Halted data push loop for handle "+oy_short(o)),!0;OY_PUSH_HOLD[o]=_,_=null,OY_PUSH_TALLY[o]=[];for(let _=0;_<OY_PUSH_HOLD[o].length;_+=OY_DATA_CHUNK)OY_PUSH_TALLY[o].push([_,_+OY_DATA_CHUNK,[]])}if(void 0===OY_DATA_PUSH[o])OY_DATA_PUSH[o]="function"!=typeof e||e;else if(!1===OY_DATA_PUSH[o])return oy_log("Halted data push loop for handle "+oy_short(o)),!0;let n=0;if(OY_PUSH_HOLD[o].length<OY_DATA_CHUNK)oy_log("Pushing handle "+oy_short(o)+" at exclusive nonce: 0"),oy_data_route("OY_LOGIC_CHAOS","OY_DATA_PUSH",[[],o,0,null],[0,OY_PUSH_HOLD[o].length]),n+=OY_DATA_PUSH_INTERVAL;else{let _=-1,e=[];for(let O in OY_PUSH_TALLY[o])(OY_PUSH_TALLY[o][O][2].length<_||-1===_)&&(_=OY_PUSH_TALLY[o][O][2].length,e=[]),OY_PUSH_TALLY[o][O][2].length>_||e.push(parseInt(O));for(e.sort(function(){return.5-Math.random()});e.length>OY_DATA_PUSH_NONCE_MAX;)e.pop();for(let _ in e)oy_chrono(function(){if(void 0===OY_PUSH_TALLY[o])return!1;oy_log("Pushing handle "+oy_short(o)+" at nonce: "+e[_]),oy_data_route("OY_LOGIC_CHAOS","OY_DATA_PUSH",[[],o,e[_],null],[OY_PUSH_TALLY[o][e[_]][0],OY_PUSH_TALLY[o][e[_]][1]])},n),n+=OY_DATA_PUSH_INTERVAL}if(oy_chrono(function(){oy_data_push(_,null,o)},n),!1!==O)return O}function oy_data_push_reset(_){if(!oy_handle_check(_))return!1;delete OY_DATA_PUSH[_],delete OY_PUSH_HOLD[_],delete OY_PUSH_TALLY[_],oy_log("Reset data push loop for handle "+oy_short(_))}function oy_data_tally(_,e,o,O){return void 0===OY_PUSH_TALLY[e]||void 0===OY_PUSH_TALLY[e][o]?(oy_log("Received invalid deposit tally for unknown handle "+oy_short(e)),!1):(oy_log("Received matching deposit tally for handle "+oy_short(e)),-1===OY_PUSH_TALLY[e][o][2].indexOf(_)&&OY_PUSH_TALLY[e][o][2].push(_),"function"==typeof OY_DATA_PUSH[e]&&OY_DATA_PUSH[e](o,OY_PUSH_TALLY[e][o][2].length,O),!0)}function oy_data_pull(_,e,o,O,n){if(void 0===O||void 0===n){if(-1===_.indexOf("@"))O=parseInt(_.substr(46)),n=null;else{let e=_.split("@");O=parseInt(e[0].substr(46)),n=e[1]}_=_.substr(0,46)}if("function"!=typeof o&&(o=null),void 0===OY_DATA_PULL[_])OY_DATA_PULL[_]=[e,o,O,n];else if(!1===OY_DATA_PULL[_])return oy_log("Halted data pull loop for handle "+oy_short(_)),!1;let t={};for(let _=0;_<O;_++)t[_]=!0;for(let e in OY_COLLECT[_])1===Object.keys(OY_COLLECT[_][e]).length&&delete t[e];let E=[];for(let _ in t)E.push(parseInt(_));for(E.sort(function(){return.5-Math.random()});E.length>OY_DATA_PULL_NONCE_MAX;)E.pop();oy_log("Pulling handle "+oy_short(_)+" with nonce max: "+O+" and nonce set: "+JSON.stringify(E)),oy_data_route("OY_LOGIC_ALL","OY_DATA_PULL",[[],oy_rand_gen(),_,E]),oy_chrono(function(){oy_data_pull(_,e,o,O,n)},OY_DATA_PULL_INTERVAL)}function oy_data_pull_reset(_){if(!oy_handle_check(_))return!1;delete OY_DATA_PULL[_],delete OY_COLLECT[_],delete OY_CONSTRUCT[_],oy_log("Reset data push loop for handle "+oy_short(_))}function oy_data_collect(_,e,o,O,n){if(!oy_handle_check(e))return oy_log("Collect received an invalid handle: "+e+", will not process"),!1;if(void 0===OY_DATA_PULL[e])return oy_log("Collect could not find a pull session for handle: "+e+", will not process"),!1;if(void 0===OY_COLLECT[e]&&(OY_COLLECT[e]={}),void 0===OY_COLLECT[e][o]&&(OY_COLLECT[e][o]={}),void 0===OY_COLLECT[e][o][O])OY_COLLECT[e][o][O]=[_];else if(-1===OY_COLLECT[e][o][O].indexOf(_)){let n;for(let _ in OY_COLLECT[e][o])if(O!==_){n=!1,OY_COLLECT[e][o][_].shift(),0===OY_COLLECT[e][o][_].length&&delete OY_COLLECT[e][o][_];break}!1!==n&&OY_COLLECT[e][o][O].push(_)}if("function"==typeof OY_DATA_PULL[e][1]){let _=-1;for(let O in OY_COLLECT[e][o])(OY_COLLECT[e][o][O].length>_||-1===_)&&(_=OY_COLLECT[e][o][O].length);OY_DATA_PULL[e][1](o,_,Object.keys(OY_COLLECT[e][o]).length,n)}if(void 0!==OY_DATA_PULL[e]&&!1!==OY_DATA_PULL[e]&&Object.keys(OY_COLLECT[e]).length===OY_DATA_PULL[e][2]){void 0===OY_CONSTRUCT[e]&&(OY_CONSTRUCT[e]=[]);for(let _ in OY_COLLECT[e]){if(_>=OY_DATA_PULL[e][2])continue;let o=0,O=null;for(let n in OY_COLLECT[e][_])OY_COLLECT[e][_][n].length>o&&(o=OY_COLLECT[e][_][n].length,O=n);OY_CONSTRUCT[e][_]=LZString.decompressFromUTF16(O)}if(Object.keys(OY_CONSTRUCT[e]).length===OY_DATA_PULL[e][2]){oy_log("Construct for "+oy_short(e)+" achieved all "+OY_DATA_PULL[e][2]+" nonce(s)");let _=OY_CONSTRUCT[e].join("");if(e.substr(6,40)===oy_hash_gen(_))return delete OY_COLLECT[e],delete OY_CONSTRUCT[e],oy_log("Construct for "+oy_short(e)+" cleared hash check"),OY_DATA_PULL[e][0]("OY"+e+OY_DATA_PULL[e][2]+(null===OY_DATA_PULL[e][3]?"":"@"+OY_DATA_PULL[e][3]),null===OY_DATA_PULL[e][3]?null:oy_crypt_decrypt(_,OY_DATA_PULL[e][3]),_),OY_DATA_PULL[e]=!1,!0;oy_log("Construct for handle "+oy_short(e)+" failed hash check")}else oy_log("Construct for handle "+oy_short(e)+" did not achieve all nonces")}else oy_log("Collect for handle "+oy_short(e)+" did not achieve all nonces")}function oy_data_route(_,e,o,O){if(-1!==o[0].indexOf(OY_SELF_SHORT))return oy_log("Self already stamped passive passport with flag "+e+", will cease date_route"),!1;if(void 0!==O){if(void 0===OY_DATA_PUSH[o[1]]||!1===OY_DATA_PUSH[o[1]]||void 0===OY_PUSH_HOLD[o[1]])return oy_log("Cancelled data route for handle "+oy_short(o[1])+" due to push session cancellation"),!0;o[3]=LZString.compressToUTF16(OY_PUSH_HOLD[o[1]].slice(O[0],O[1]))}let n=!1;if("OY_LOGIC_CHAOS"===_){if(!1===(n=oy_peer_rand(o[0])))return oy_log("Data route cannot chaos transmit flag "+e),!1;o[0].push(OY_SELF_SHORT),oy_data_beam(n,e,o)}else if("OY_LOGIC_ALL"===_){o[0].push(OY_SELF_SHORT);for(let _ in OY_PEERS)"oy_aggregate_node"!==_&&-1===o[0].indexOf(oy_short(_))&&oy_data_beam(_,e,o);if("OY_BLOCK_SYNC"===e||"OY_BLOCK_DIVE"===e){let _=Date.now()/1e3;for(let O in OY_CLONES)3===OY_CLONES[O][1]&&_<OY_CLONES[O][0]&&oy_data_beam(O,e,o)}}else if("OY_LOGIC_CHALLENGE"===_){if(o[0].length>Math.ceil(o[2].length*OY_CHALLENGE_BUFFER))return!1;o[0].push(OY_SELF_SHORT);let _=oy_peer_find(o[3]);if(_)oy_data_beam(_,e,o);else for(let _ in OY_PEERS)"oy_aggregate_node"!==_&&-1===o[0].indexOf(oy_short(_))&&-1===o[2].indexOf(oy_short(_))&&oy_data_beam(_,e,o)}else{if("OY_LOGIC_FOLLOW"!==_)return oy_log("Invalid data_logic provided: "+_+", will cancel"),!1;{if(0===o[1].length)return oy_log("Active passport ran empty on reversal with flag "+e+", will cancel routing"),!1;let _,O=[];for(let e in o[1])if(O.push(o[1][e]),_=oy_peer_find(o[1][e]))break;if(!1===_||!oy_peer_check(_))return oy_log("Data route couldn't find reversal peer to send to for flag "+e),!1;o[1]=O.slice(),o[0].push(OY_SELF_SHORT),oy_data_beam(_,e,o)}}return!0}function oy_data_direct(_){return!(-1===_.indexOf("OY_PEER")&&-1===_.indexOf("OY_LATENCY")&&-1===_.indexOf("OY_CLONE"))}function oy_data_beam(_,e,o){if(null===OY_CONN)return oy_log("Connection handler is null, skipping "+e+" to "+oy_short(_)),!1;return oy_node_connect(_,function(){let O=JSON.stringify([e,o]),n=oy_data_direct(e);if(!1===n&&o[0].length>OY_MESH_HOP_MAX)return oy_log("Almost sent a data sequence with too many hops for flag "+e+", go tell Bruno",1),!1;o=null;let t=-1!==OY_LOGIC_ALL_TYPE.indexOf(e);if(O.length>OY_DATA_MAX||!0===t&&("OY_CHANNEL_BROADCAST"===e&&O.length>OY_CHANNEL_BROADCAST_PACKET_MAX||("OY_BLOCK_SYNC"===e||"OY_BLOCK_DIVE"===e)&&O.length>OY_BLOCK_PACKET_MAX||"OY_CHANNEL_BROADCAST"!==e&&"OY_BLOCK_SYNC"!==e&&"OY_BLOCK_DIVE"!==e&&O.length>OY_LOGIC_ALL_MAX))return oy_log("Almost sent an excessively sized data sequence for flag "+e+", go tell Bruno",1),!1;let E=!1;if(oy_peer_check(_)&&(E=!oy_data_measure(!0,_,O.length)),!0===E&&!1===n&&-1===OY_LOGIC_EXCEPT_TYPE.indexOf(e))return oy_log("Cooling off, skipping "+e+" to "+oy_short(_)),!0;OY_NODES[_][0].send(O),"OY_BLOCK_SYNC"!==e&&"OY_BLOCK_SYNC_CHALLENGE"!==e&&"OY_BLOCK_SYNC_CHALLENGE_RESPONSE"!==e&&"OY_BLOCK_DIVE"!==e&&oy_log("BEAM["+e+"]["+oy_short(_)+"]")}),!0}function oy_data_soak(_,e){try{if(e.length>OY_DATA_MAX)return oy_log("Node "+oy_short(_)+" sent an excessively sized data sequence, will punish and cease session"),oy_node_punish(_,"OY_PUNISH_DATA_LARGE"),!1;let o=JSON.parse(e);if(o&&"object"==typeof o){if("OY_BLOCK_SYNC"!==o[0]&&"OY_BLOCK_SYNC_CHALLENGE"!==o[0]&&"OY_BLOCK_SYNC_CHALLENGE_RESPONSE"!==o[0]&&"OY_BLOCK_DIVE"!==o[0]&&oy_log("SOAK["+o[0]+"]["+oy_short(_)+"]"),!oy_data_direct(o[0])){if(o[1][0].length>OY_MESH_HOP_MAX)return oy_log("Peer "+oy_short(_)+" sent a data sequence with too many hops, will remove and punish"),oy_peer_remove(_,"OY_PUNISH_PASSPORT_HOP"),!1;let O=o[1][0][o[1][0].length-1];if(O!==oy_short(_))return oy_log("Peer "+oy_short(_)+" lied on the passport, will remove and punish"),oy_peer_remove(O,"OY_PUNISH_PASSPORT_MISMATCH"),!1;if(-1!==o[1][0].indexOf(OY_SELF_SHORT))return oy_log("Peer "+oy_short(_)+" sent a data sequence we already processed, will remove and punish"),oy_peer_remove(_,"OY_PUNISH_PASSPORT_ALREADY"),!1;if("object"==typeof o[1][0]&&o[1][0].length>1&&oy_peer_find(o[1][0][0]))return!0;if(-1!==OY_LOGIC_ALL_TYPE.indexOf(o[0])){let O=Date.now()/1e3;if(!oy_peer_check(_)&&void 0===OY_ORIGINS[_])return!1;if("OY_CHANNEL_BROADCAST"===o[0]&&e.length>OY_CHANNEL_BROADCAST_PACKET_MAX||("OY_BLOCK_SYNC"===o[0]||"OY_BLOCK_DIVE"===o[0])&&e.length>OY_BLOCK_PACKET_MAX||"OY_CHANNEL_BROADCAST"!==o[0]&&"OY_BLOCK_SYNC"!==o[0]&&"OY_BLOCK_DIVE"!==o[0]&&e.length>OY_LOGIC_ALL_MAX)return oy_log("Peer "+oy_short(_)+" sent a data sequence that is too large for "+o[0]+", will remove and punish"),oy_peer_remove(_,"OY_PUNISH_LOGIC_LARGE"),!1;if(4!==o[1][1].length)return oy_log("Peer "+oy_short(_)+" sent OY_LOGIC_ALL with an invalid route_dynamic, will remove and punish"),oy_peer_remove(_,"OY_PUNISH_LOGIC_LARGE"),!1;if("OY_BLOCK_COMMAND"===o[0]){if(null===OY_BLOCK_DYNAMIC[0])return!0;if(-1!==OY_BLOCK_DYNAMIC[0].indexOf(o[1][1]))return!0;OY_BLOCK_DYNAMIC[0].push(o[1][1])}else if("OY_BLOCK_SYNC"===o[0]){if(null===OY_BLOCK_DYNAMIC[1])return!0;if(-1!==OY_BLOCK_DYNAMIC[1].indexOf(o[1][1]))return!0;OY_BLOCK_DYNAMIC[1].push(o[1][1])}else if("OY_BLOCK_SYNC_CHALLENGE"===o[0]){if(null===OY_BLOCK_DYNAMIC[2])return!0;if(-1!==OY_BLOCK_DYNAMIC[2].indexOf(o[1][1]))return!0;OY_BLOCK_DYNAMIC[2].push(o[1][1])}else if("OY_BLOCK_DIVE"===o[0]){if(null===OY_BLOCK_DYNAMIC[3])return!0;if(-1!==OY_BLOCK_DYNAMIC[3].indexOf(o[1][1]))return!0;OY_BLOCK_DYNAMIC[3].push(o[1][1])}else{if(-1!==OY_ROUTE_DYNAMIC.indexOf(o[1][1]))return!0;for(OY_ROUTE_DYNAMIC.push(o[1][1]);OY_ROUTE_DYNAMIC.length>OY_ROUTE_DYNAMIC_KEEP;)OY_ROUTE_DYNAMIC.shift()}if("OY_CHANNEL_BROADCAST"===o[0]&&"OY_CHANNEL_PING"!==o[1][3]&&o[1][5]!==OY_KEY_BRUNO){if(void 0!==OY_CHANNEL_DYNAMIC[o[1][5]]&&O-OY_CHANNEL_DYNAMIC[o[1][5]]<OY_CHANNEL_ALLOWANCE)return oy_log("Peer "+oy_short(_)+" sent a channel broadcast that breached allowance, will punish"),oy_node_punish(_,"OY_PUNISH_BROADCAST_BREACH"),!1;OY_CHANNEL_DYNAMIC[o[1][5]]=O}}}return o}}catch(_){oy_log("Data validation exception occurred: "+_)}return oy_log("Node "+oy_short(_)+" failed validation"),!1}function oy_data_deposit(_,e,o,O){return"function"!=typeof O&&(O=function(){}),OY_DB.oy_data.get(_+e).then(n=>{void 0!==n?O(!0):Math.random()>OY_MESH_DEPOSIT_CHANCE?O(!1):OY_DB.oy_data.put({oy_data_key:_+e,oy_data_time:Date.now/1e3|0,oy_data_value:o}).then(function(){O(!0),oy_log("Stored handle "+_+" at nonce "+e)}).catch(function(){O(!1),oy_db_error()})}),!0}function oy_data_deposit_get(_,e,o){OY_DB.oy_data.get(_+e).then(_=>{void 0===_.oy_data_value?o(!1):o(_.oy_data_value)}).catch(oy_db_error)}function oy_data_deposit_purge(){OY_DB.oy_data.orderBy("oy_data_time").limit(OY_DATA_PURGE).toArray().then(_=>{for(let e in _)OY_DB.oy_data.delete(_[e].oy_key)}).catch(oy_db_error),oy_log("Purged "+OY_DATA_PURGE+" handles from deposit")}function oy_channel_check(_){return 40===_.length}function oy_channel_top(_,e,o){let O,n=Date.now()/1e3|0;O=!1===o?e[0]:o,void 0===OY_CHANNEL_TOP[_]&&(OY_CHANNEL_TOP[_]={}),void 0===OY_CHANNEL_TOP[_][O]?OY_CHANNEL_TOP[_][O]=[n,-1,e,!!o]:(OY_CHANNEL_TOP[_][O][0]=n,OY_CHANNEL_TOP[_][O][2]=e,OY_CHANNEL_TOP[_][O][3]=!!o)}function oy_channel_top_count(_){let e=0,o=0;if(void 0!==OY_CHANNEL_TOP[_])for(let O in OY_CHANNEL_TOP[_])!0===OY_CHANNEL_TOP[_][O][3]?e++:o++;return[e,o]}function oy_channel_approved(_,e){return void 0!==OY_BLOCK_TEMP[2][_]&&(-1!==OY_BLOCK_TEMP[2][_][2].indexOf(e)||-1!==OY_BLOCK_TEMP[2][_][3].indexOf(e))}function oy_channel_verify(_,e){let o=Date.now()/1e3;return null===OY_BLOCK_TEMP_HASH?(e(null),null):oy_channel_approved(_[2],_[5])&&_[6]<=o+OY_MESH_BUFFER[0]&&_[6]>o-OY_MESH_EDGE?(oy_key_verify(_[5],_[4],_[6]+_[7]+_[3],function(_){e(_)}),null):(e(!1),null)}function oy_channel_broadcast(_,e,o,O,n,t){let E,Y=Date.now()/1e3;E="OY_CHANNEL_PING"===e?e:LZString.compressToUTF16(e);let r=oy_channel_top_count(_);oy_key_sign(o,Y+r[0]+E,function(l){let L=[[],oy_rand_gen(),_,E,l,O,Y,r[0]];oy_channel_verify(L,function(E){if(!0===E){let E=oy_hash_gen(l);"function"==typeof t&&(OY_CHANNEL_ECHO[_+L[1]]=[Y+OY_MESH_EDGE,E,t,[]]),void 0!==OY_CHANNEL_LISTEN[_]&&OY_CHANNEL_LISTEN[_][0]===o&&OY_CHANNEL_LISTEN[_][1]===O&&(OY_CHANNEL_LISTEN[_][3]=Y),oy_data_route("OY_LOGIC_ALL","OY_CHANNEL_BROADCAST",L);let r=L.slice();r[3]=e,"function"==typeof n&&n(E,r)}})})}function oy_channel_listen(_,e,o,O){void 0!==o&&void 0!==O||(o=null,O=null),OY_CHANNEL_LISTEN[_]=[o,O,e,-1],void 0===OY_CHANNEL_KEEP[_]&&(OY_CHANNEL_KEEP[_]={}),OY_DB.oy_channel.where("oy_channel_id").equals(_).each(function(e){OY_CHANNEL_KEEP[_][e.oy_broadcast_hash]=e.oy_broadcast_payload})}function oy_channel_mute(_){delete OY_CHANNEL_LISTEN[_],delete OY_CHANNEL_KEEP[_],delete OY_CHANNEL_TOP[_],delete OY_CHANNEL_RENDER[_]}function oy_channel_commit(_,e,o){OY_DB.oy_channel.put({oy_broadcast_hash:e,oy_channel_id:_,oy_broadcast_payload:o}).catch(oy_db_error)}function oy_akoya_transfer(_,e,o,O,n){oy_block_command(_,["OY_AKOYA_SEND",-1,e,o=Math.floor(o*OY_AKOYA_DECIMALS),O],n)}function oy_block_command(_,e,o){let O=function(){document.removeEventListener("oy_block_trigger",O,!1),oy_chrono(function(){e[1]=Date.now()/1e3;let O=JSON.stringify(e);void 0!==o&&(OY_BLOCK_CONFIRM[oy_hash_gen(O)]=o),oy_key_sign(_,O,function(_){oy_block_command_verify([e,_],function(o){if(!0===o){let o=oy_hash_gen(O),n=[[],null,e,_];OY_BLOCK_COMMAND[o]=n,"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(0,!0);for(let _=0;_<=300;_+=50)setTimeout(function(){let _=n.slice();_[1]=oy_rand_gen(),oy_data_route("OY_LOGIC_ALL","OY_BLOCK_COMMAND",_)},_)}})})},OY_BLOCK_LAUNCHTIME)};document.addEventListener("oy_block_trigger",O,!1)}function oy_block_command_verify(_,e){void 0===_[0][0]||void 0===OY_BLOCK_COMMANDS[_[0][0]]?e(!1):oy_key_verify(_[0][2],_[1],JSON.stringify(_[0]),function(o){e(!0===o&&OY_BLOCK_COMMANDS[_[0][0]][0](_[0]))})}function oy_block_sync_verify(_,e){0===_.length?e(!0):oy_block_command_verify(_.pop(),function(o){!0===o?oy_block_sync_verify(_,e):e(!1)})}function oy_block_sync_hop(_,e,o,O,n,t,E,Y){if(0===_.length||null===OY_BLOCK_ROSTER_AVG)return E();if(performance.now()-t>OY_BLOCK_HOP_CALCTIME){for(let e in _)void 0!==OY_BLOCK_ROSTER[_[e]]&&OY_BLOCK_ROSTER[_[e]][1]++;return E()}void 0!==Y&&oy_shuffle_double(_,e);let r=_.pop(),l=e.pop();return(void 0===OY_BLOCK_ROSTER[r]||OY_BLOCK_ROSTER[r][1]>OY_BLOCK_ROSTER_AVG*OY_BLOCK_STABILITY_ROSTER)&&n++,!(n>O&&OY_BLOCK_STABILITY_KEEP.length>=OY_BLOCK_STABILITY_TRIGGER)&&(void 0===OY_BLOCK_ROSTER[r]?(oy_block_sync_hop(_,e,o,O,n,t,E),!1):void oy_key_verify(OY_BLOCK_ROSTER[r][0],l,o,function(Y){!0===Y&&(OY_BLOCK_ROSTER[r][1]++,oy_block_sync_hop(_,e,o,O,n,t,E))}))}function oy_block_stability(_){let e=function(_){return _.reduce(function(_,e){return _+e},0)/_.length},o=e(_),O=_.map(function(_){let e=_-o;return e*e});return Math.sqrt(e(O))}function oy_block_time(){return 10*Math.floor(Date.now()/1e4)}function oy_block_time_first(_){let e=oy_block_time(),o=10;return e/10%2==0&&(o=0),!0===_?e+20-o:e-o}function oy_block_reset(){OY_BLOCK_HASH=null,OY_BLOCK_SIGN=null,OY_BLOCK_UPTIME=null,OY_BLOCK_WEIGHT=null,OY_BLOCK_STABILITY=0,OY_BLOCK_STABILITY_ROSTER=parseInt(OY_BLOCK_STABILITY_START+""),OY_BLOCK_STABILITY_KEEP=[OY_BLOCK_RANGE_MIN],OY_BLOCK_DYNAMIC=[null,null,null,null],OY_BLOCK_COMMAND={},OY_BLOCK_COMMAND_KEY={},OY_BLOCK_SYNC={},OY_BLOCK_DIVE={},OY_BLOCK_CHALLENGE={},OY_BLOCK_DIVE_SET=[],OY_BLOCK_DIVE_TRACK=0,OY_BLOCK_ROSTER={},OY_BLOCK_ROSTER_AVG=null,OY_BLOCK=[[null,[]],{},{},{},{}],OY_ORIGINS={},OY_CLONES={},OY_CLONE_UPTIME=null,OY_CLONE_BUILD=[],OY_MESH_RANGE=0,OY_CHALLENGE_TRIGGER=null,OY_BLACKLIST={};for(let _ in OY_PEERS)"oy_aggregate_node"!==_&&oy_peer_remove(_);oy_log("MESHBLOCK RESET"),document.dispatchEvent(OY_BLOCK_RESET),oy_boost()}function oy_block_loop(){let _=oy_block_time();if(oy_chrono(oy_block_loop,OY_BLOCK_LOOP),_!==OY_BLOCK_TIME&&_/10%2==0){OY_BLOCK_TIME=_,OY_BLOCK_NEXT=_+20,OY_BLOCK_DYNAMIC=[[],null,null,null],OY_BLOCK_COMMAND={},document.dispatchEvent(OY_BLOCK_INIT),OY_BLOCK_TIME===OY_BLOCK_SEEDTIME&&((OY_BLOCK=[[null,[]],{},{},{},{}])[2][OY_KEY_BRUNO]=1e6*OY_AKOYA_DECIMALS,OY_BLOCK[2]["6SMQSTFOYwECyJUbT4sIaUr3ZgtAI0cUnSC50oADLNY6NnFd0B3m0etogvlJ8rjiQgVKeAtVepyHsmMiVFs7UI"]=1e6*OY_AKOYA_DECIMALS,OY_BLOCK[2]["6PpZ_Rkylq1kBxDsmEBtrpbu7NR9zCYoybybectEMcoy0cR88Jj0zKaGLroFA3ubSJMdPfMIk0HW7Jw6FdVMSU"]=1e6*OY_AKOYA_DECIMALS,OY_BLOCK[2].yg8s2bpiH48jn7m0sLmoAYRP0yLWKXmxyktJ2rvp7msag5qhcV4yBI3zbkn2JoD42R36rLkmgwHePFynxxPqlw=1e6*OY_AKOYA_DECIMALS,OY_BLOCK_HASH=oy_hash_gen(JSON.stringify(OY_BLOCK)));let e="OY_NULL",o=[],O={},n=[],t=[],E=!0;null!==OY_BLOCK_UPTIME&&OY_BLOCK_TIME-OY_BLOCK_UPTIME>=OY_BLOCK_DIVE_BUFFER&&(e=(" "+OY_BLOCK_DIVE_REWARD).slice(1)),oy_chrono(function(){let n=Date.now()/1e3;OY_BLOCK_DYNAMIC[0]=null,OY_BLOCK_DYNAMIC[1]=[],OY_BLOCK_DYNAMIC[2]=[],OY_CLONE_BUILD=[],"OY_NULL"===OY_BLOCK_DIVE_REWARD&&(OY_BLOCK_DIVE_TRACK=0);for(let _ in OY_CLONES)(0===OY_CLONES[_][1]||2===OY_CLONES[_][1]||n>=OY_CLONES[_][0])&&delete OY_CLONES[_];if(null===OY_BLOCK_HASH)return OY_MESH_RANGE=0,OY_CHALLENGE_TRIGGER=null,OY_BLOCK_CHALLENGE={},oy_log("MESHBLOCK SKIP: "+_),E=!1,!1;if(null===OY_BLOCK_UPTIME&&OY_PEER_COUNT>0&&(OY_BLOCK_UPTIME=n),null!==OY_BLOCK[0][0]&&OY_BLOCK[0][0]!==_-20)return oy_block_reset(),oy_log("MESHBLOCK MISSTEP"),E=!1,!1;if(0===OY_PEER_COUNT&&0===Object.keys(OY_ORIGINS).length&&n-OY_BLOCK_SEEDTIME>OY_BLOCK_SEED_BUFFER)return oy_block_reset(),oy_log("MESHBLOCK DROP [ORIGIN]"),E=!1,!1;if(oy_chrono(function(){let _;for(_ in OY_PEERS){if("oy_aggregate_node"===_)continue;let e=n-OY_PEERS[_][1],o=n-OY_PEERS[_][2];e>=OY_PEER_KEEPTIME||o>=OY_PEER_LATENCYTIME?void 0===OY_ENGINE[0][_]?(oy_log("Initiating latency test with peer "+oy_short(_)+", time_diff_last: "+e.toFixed(2)+"/"+OY_PEER_KEEPTIME+", time_diff_latency: "+o.toFixed(2)+"/"+OY_PEER_LATENCYTIME),oy_latency_test(_,"OY_PEER_ROUTINE",!0)?OY_ENGINE[0][_]=n:oy_log("Latency test with peer "+oy_short(_)+" was unable to launch")):n-OY_ENGINE[0][_]>OY_LATENCY_MAX&&(oy_log("Found non-responsive peer "+oy_short(_)+" with latency lag: "+(n-OY_ENGINE[0][_]).toFixed(4)+", will punish"),oy_node_punish(_,"OY_PUNISH_LATENCY_LAG")):delete OY_ENGINE[0][_]}},100),Math.floor((Date.now()-3e4)/1e7)!==Math.floor((Date.now()-1e4)/1e7))for(OY_BLOCK[1]={},OY_BLOCK[0][1].push(OY_BLOCK_HASH);OY_BLOCK[0][1].length>OY_BLOCK_HASH_KEEP;)OY_BLOCK[0][1].shift();OY_BLOCK[0][0]=_,OY_BLOCK_COMMAND_KEY={};for(let _ in OY_BLOCK_COMMAND)o.push([OY_BLOCK_COMMAND[_][2],OY_BLOCK_COMMAND[_][3]]),O[_]=OY_BLOCK_COMMAND[_][2];o.sort(function(_,e){return _[0]-e[0]}),o=LZString.compressToUTF16(JSON.stringify(o)),OY_BLOCK_SYNC={},OY_BLOCK_SYNC_HASH=oy_hash_gen(o),oy_chrono(function(){let _=Date.now()/1e3;if(OY_PEER_COUNT<OY_BLOCK_PEERS_MIN||_-OY_BLOCK_TIME<OY_BLOCK_SECTORS[0][0]||_-OY_BLOCK_TIME>=OY_BLOCK_SECTORS[0][0]+OY_MESH_BUFFER[0]+(OY_BLOCK_SECTORS[1][0]*OY_BLOCK_DENSITY-OY_MESH_BUFFER[0])+2*OY_MESH_BUFFER[0])return!1;oy_key_sign(OY_SELF_PRIVATE,_+OY_BLOCK_SYNC_HASH+e,function(O){oy_key_sign(OY_SELF_PRIVATE,oy_short(O),function(n){oy_data_route("OY_LOGIC_ALL","OY_BLOCK_SYNC",[[],oy_rand_gen(),[n],_,O,o,OY_SELF_PUBLIC,e]),o=null,"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(1,!0)})})},OY_MESH_BUFFER[1]+Math.floor(Math.random()*(OY_BLOCK_SECTORS[1][1]*OY_BLOCK_DENSITY-OY_MESH_BUFFER[1])))},OY_BLOCK_SECTORS[0][1]),oy_chrono(function(){if(!1===E)return!1;if(OY_BLOCK_DYNAMIC[1]=null,OY_BLOCK_DYNAMIC[2]=null,OY_BLOCK_DYNAMIC[3]=[],null===OY_BLOCK_HASH)return oy_block_reset(),oy_log("MESHBLOCK CANCEL: "+_),E=!1,!1;for(let _ in OY_BLOCK_ROSTER)(void 0===OY_BLOCK_SYNC[OY_BLOCK_ROSTER[_][0]]||!0!==OY_BLOCK_SYNC[OY_BLOCK_ROSTER[_][0]][0])&&Math.random()>OY_BLOCK_ROSTER_PERSIST&&delete OY_BLOCK_ROSTER[_];let o={},Y=0,r=0,l=0;for(let _ in OY_BLOCK_SYNC)if(!0===OY_BLOCK_SYNC[_][0]){let e=oy_short(_);void 0===OY_BLOCK_ROSTER[e]?(r++,l++,OY_BLOCK_ROSTER[e]=[_,0]):(r+=OY_BLOCK_ROSTER[e][1],l++,OY_BLOCK_ROSTER[e][1]=0),Y++;for(let e in OY_BLOCK_SYNC[_][3])void 0===o[e]?o[e]=[1,OY_BLOCK_SYNC[_][3][e]]:o[e][0]++}OY_BLOCK_ROSTER_AVG=0===l?null:r/l;for(let _ in O)void 0===o[_]?o[_]=[1,O[_]]:o[_][0]++;Y=Math.ceil(Y*OY_BLOCK_CONSENSUS);for(let _ in o)o[_][0]>=Y&&(n.push([_,o[_][1]]),delete o[_]);n.sort(function(_,e){if(_[1][1]===e[1][1]){let o=_[0].toLowerCase(),O=e[0].toLowerCase();return o<O?-1:o>O?1:0}return _[1][1]-e[1][1]}),"OY_NULL"!==e&&t.push([e,OY_SELF_PUBLIC]);for(let _ in OY_BLOCK_SYNC)!0===OY_BLOCK_SYNC[_][0]&&"OY_NULL"!==OY_BLOCK_SYNC[_][2][7]&&t.push([OY_BLOCK_SYNC[_][2][7],_]);OY_BLOCK_DIVE={},OY_BLOCK_DIVE_SET=[],oy_chrono(function(){let _=Date.now()/1e3;if(OY_PEER_COUNT<OY_BLOCK_PEERS_MIN||OY_BLOCK_TIME-OY_BLOCK_UPTIME<OY_BLOCK_DIVE_BUFFER||_-OY_BLOCK_TIME<OY_BLOCK_SECTORS[0][0]+OY_BLOCK_SECTORS[1][0]||_-OY_BLOCK_TIME>=OY_BLOCK_SECTORS[0][0]+OY_BLOCK_SECTORS[1][0]+OY_MESH_BUFFER[0]+(OY_BLOCK_SECTORS[0][0]*OY_BLOCK_DENSITY-OY_MESH_BUFFER[0])+2*OY_MESH_BUFFER[0])return!1;t=LZString.compressToUTF16(JSON.stringify(t)),oy_key_sign(OY_SELF_PRIVATE,_+oy_hash_gen(t),function(e){oy_data_route("OY_LOGIC_ALL","OY_BLOCK_DIVE",[[],oy_rand_gen(),_,e,t,OY_SELF_PUBLIC]),t=null,"function"==typeof OY_BLOCK_MAP&&OY_BLOCK_MAP(2,!0)})},OY_MESH_BUFFER[1]+Math.floor(Math.random()*(OY_BLOCK_SECTORS[0][1]*OY_BLOCK_DENSITY-OY_MESH_BUFFER[1])))},OY_BLOCK_SECTORS[0][1]+OY_BLOCK_SECTORS[1][1]),oy_chrono(function(){if(!1===E)return!1;if(OY_BLOCK_DYNAMIC[3]=null,null===OY_BLOCK_HASH)return oy_block_reset(),oy_log("MESHBLOCK CANCEL: "+_),E=!1,!1;for(OY_MESH_RANGE=OY_BLOCK_DIVE_SET.length,OY_BLOCK_STABILITY_KEEP.push(OY_MESH_RANGE);OY_BLOCK_STABILITY_KEEP.length>OY_BLOCK_STABILITY_LIMIT;)OY_BLOCK_STABILITY_KEEP.shift();if(OY_BLOCK_STABILITY=OY_BLOCK_STABILITY_KEEP.length<OY_BLOCK_STABILITY_TRIGGER?0:oy_block_stability(OY_BLOCK_STABILITY_KEEP),OY_BLOCK_STABILITY_ROSTER=OY_BLOCK_STABILITY_KEEP.length<OY_BLOCK_STABILITY_TRIGGER?OY_BLOCK_STABILITY_START:Math.max(OY_BLOCK_STABILITY_MIN,OY_BLOCK_STABILITY),OY_MESH_RANGE<OY_BLOCK_RANGE_MIN&&Date.now()/1e3-OY_BLOCK_SEEDTIME>OY_BLOCK_SEED_BUFFER)return oy_block_reset(),oy_log("MESHBLOCK DROP [RANGE_MIN]"),E=!1,!1;OY_CHALLENGE_TRIGGER=null;let o=Math.ceil(OY_MESH_RANGE*OY_BLOCK_CONSENSUS),O=[];for(let _ in OY_BLOCK_DIVE)for(let e in OY_BLOCK_DIVE[_])OY_BLOCK_DIVE[_][e]>=o&&O.push(_);OY_BLOCK_NEW={},OY_BLOCK_DIVE={},OY_BLOCK_DIVE_SET=[];let t=0,Y=0;for(let _ in OY_BLOCK[2]){t+=OY_BLOCK[2][_];let e=OY_BLOCK[2][_];OY_BLOCK[2][_]-=OY_AKOYA_FEE,OY_BLOCK[2][_]=Math.max(OY_BLOCK[2][_],0),Y+=e-OY_BLOCK[2][_],OY_BLOCK[2][_]<=0&&delete OY_BLOCK[2][_]}if(O.length>0){let _=Math.floor(Y/O.length);if(_>0)for(let o in O)e===O[o]&&(OY_BLOCK_DIVE_TRACK+=_),void 0===OY_BLOCK[2][O[o]]?OY_BLOCK[2][O[o]]=_:OY_BLOCK[2][O[o]]+=_}for(let _ in n)if("OY_AKOYA_SEND"===n[_][1][0]&&void 0!==OY_BLOCK[2][n[_][1][2]]&&OY_BLOCK[2][n[_][1][2]]>=n[_][1][3]){void 0===OY_BLOCK[2][n[_][1][4]]&&(OY_BLOCK[2][n[_][1][4]]=0);let e=OY_BLOCK[2][n[_][1][2]],o=OY_BLOCK[2][n[_][1][4]];OY_BLOCK[2][n[_][1][2]]-=n[_][1][3],OY_BLOCK[2][n[_][1][4]]+=n[_][1][3],OY_BLOCK[2][n[_][1][2]]+OY_BLOCK[2][n[_][1][4]]!==e+o?(OY_BLOCK[2][n[_][1][2]]=e,OY_BLOCK[2][n[_][1][4]]=o):(OY_BLOCK[2][n[_][1][2]]<=0&&delete OY_BLOCK[2][n[_][1][2]],OY_BLOCK[2][n[_][1][4]]<=0&&delete OY_BLOCK[2][n[_][1][4]],OY_BLOCK[1][n[_][0]]=n[_][1],OY_BLOCK_NEW[n[_][0]]=n[_][1])}let r=0;for(let _ in OY_BLOCK[2])r+=OY_BLOCK[2][_];if(r>t||r>OY_AKOYA_MAX_SUPPY)return!1;OY_BLOCK_CHALLENGE={};for(let _ in OY_PEERS)"oy_aggregate_node"!==_&&(OY_BLOCK_CHALLENGE[_]=!0);let l=JSON.stringify(OY_BLOCK);OY_BLOCK_HASH=oy_hash_gen(l),OY_BLOCK_WEIGHT=new Blob([l]).size,OY_CLONE_UPTIME=Date.now()/1e3,oy_log("NEW MESHBLOCK HASH "+OY_BLOCK_HASH),document.dispatchEvent(OY_BLOCK_TRIGGER),oy_chrono(function(){if(null===OY_BLOCK_HASH)return!1;oy_key_sign(OY_SELF_PRIVATE,OY_MESH_DYNASTY+OY_BLOCK_HASH,function(_){for(let e in OY_PEERS)"oy_aggregate_node"!==e&&oy_data_beam(e,"OY_PEER_CHALLENGE",_)})},OY_BLOCK_PROTECTTIME),oy_chrono(function(){if(null===OY_BLOCK_HASH)return!1;for(let _ in OY_BLOCK_CHALLENGE)oy_peer_remove(_,"OY_PUNISH_BLOCK_HASH"),delete OY_BLOCK_CHALLENGE[_],oy_log("Removed and punished peer "+oy_short(_)+" who failed meshblock challenge")},OY_BLOCK_CHALLENGETIME),oy_chrono(function(){if(null===OY_BLOCK_HASH)return!1;if(null!==OY_CLONE_UPTIME&&OY_CLONE_UPTIME>=OY_CLONE_UPTIME_MIN&&OY_PEER_COUNT>=OY_BLOCK_PEERS_MIN&&Object.keys(OY_CLONES).length>0){let _=null,e=-1;for(let o in OY_CLONES)if(!(Date.now()/1e3>OY_CLONES[o][0]||1!==OY_CLONES[o][1])){if(null===_){_=[];for(let o=0;o<l.length;o+=OY_CLONE_CHUNK)_.push(l.slice(o,o+OY_CLONE_CHUNK)),e++}for(let O in _)oy_data_beam(o,"OY_CLONE_PUSH",[e,O,_[O]]);OY_CLONES[o][1]=2}}},OY_BLOCK_CLONETIME);for(let _ in OY_BLOCK_CONFIRM)OY_BLOCK_CONFIRM[_](void 0!==OY_BLOCK[1][_]);for(OY_BLOCK_CONFIRM={};OY_BOOST.length>OY_BOOST_KEEP;)OY_BOOST.shift();oy_local_set("oy_boost",OY_BOOST),oy_local_set("oy_boost_expire",(Date.now()/1e3|0)+OY_BOOST_EXPIRETIME)},OY_BLOCK_SECTORS[2][1]);let Y=new XMLHttpRequest;Y.onreadystatechange=function(){4===this.readyState&&200===this.status&&(OY_BLOCK_TEMP=JSON.parse(this.responseText),OY_BLOCK_TEMP_HASH=oy_hash_gen(JSON.stringify(OY_BLOCK_TEMP)),document.dispatchEvent(OY_BLOCK_TRIGGER_TEMP))},Y.open("POST","https://top.oyster.org/oy_block_update.php",!0),Y.send()}}function oy_engine(_){if(!0===OY_ENGINE_KILL)return OY_ENGINE_KILL=!1,!0;if(!0===OY_READY&&(null===OY_CONN||!1!==OY_CONN.disconnected))return oy_log("Engine found connection handler dead, will reboot INIT and kill engine chain"),OY_INIT=0,OY_READY=!1,oy_init(),!0;let e=Date.now()/1e3;void 0===_&&(_=[0,e]),OY_PEER_COUNT<OY_PEER_MAX&&e-_[0]>OY_NODE_ASSIGNTTIME+Math.round(Math.random())&&(_[0]=e,oy_log("Engine initiating node_assign, peer count is "+OY_PEER_COUNT+"/"+OY_PEER_MAX),oy_node_assign()),OY_PEER_COUNT>0&&e-_[1]>OY_PEER_REPORTTIME&&(_[1]=e,oy_log("Engine initiating peer_report, peer count is "+OY_PEER_COUNT+"/"+OY_PEER_MAX),oy_peer_report());for(let _ in OY_NODES)e-OY_NODES[_][1]>OY_NODE_EXPIRETIME&&(oy_node_disconnect(_),oy_log("Cleaned up expired connection object for node: "+oy_short(_)));for(let _ in OY_ORIGINS)e>OY_ORIGINS[_]&&(delete OY_ORIGINS[_],oy_log("Cleaned up expired origin session for node: "+oy_short(_)));for(let _ in OY_CLONES)e>OY_CLONES[_]&&(delete OY_CLONES[_],oy_log("Cleaned up expired clone session for node: "+oy_short(_)));for(let _ in OY_WARM)e-OY_WARM[_]>OY_NODE_DELAYTIME&&(oy_peer_check(_)?(oy_log("Engine found peer "+oy_short(_)+" unable to warm up, will remove and punish"),oy_peer_remove(_,"OY_PUNISH_WARM_LAG")):oy_node_punish(_,"OY_PUNISH_WARM_LAG"),delete OY_WARM[_],oy_log("Cleaned up expired warming session for node: "+oy_short(_)));let o=[];for(let _ in OY_CHANNEL_KEEP)for(let O in OY_CHANNEL_KEEP[_])if(null===OY_BLOCK_TEMP_HASH||oy_channel_approved(_,OY_CHANNEL_KEEP[_][O][5])&&!(e-OY_CHANNEL_KEEP[_][O][6]>OY_CHANNEL_EXPIRETIME)){if(void 0!==OY_CHANNEL_LISTEN[_]&&OY_CHANNEL_KEEP[_][O][8].length>=Math.floor(OY_CHANNEL_KEEP[_][O][7]*OY_CHANNEL_CONSENSUS)&&(o.push(O),void 0===OY_CHANNEL_RENDER[_]&&(OY_CHANNEL_RENDER[_]={}),void 0===OY_CHANNEL_RENDER[_][O])){OY_CHANNEL_RENDER[_][O]=!0;let e=OY_CHANNEL_KEEP[_][O].slice();e[6]>1554662400?e[3]=LZString.decompressFromUTF16(e[3]):e[3]=oy_base_decode(e[3]),OY_CHANNEL_LISTEN[_][2](O,e)}}else delete OY_CHANNEL_KEEP[_][O],OY_DB.oy_channel.delete(O),void 0!==OY_CHANNEL_RENDER[_]&&delete OY_CHANNEL_RENDER[_][O],void 0!==OY_CHANNEL_LISTEN[_]&&OY_CHANNEL_LISTEN[_][2](O,null);for(let _ in OY_CHANNEL_TOP){if(void 0===OY_CHANNEL_LISTEN[_])continue;let O=function(O,n){for(let t in OY_CHANNEL_TOP[_])e-OY_CHANNEL_TOP[_][t][0]>OY_CHANNEL_FORGETIME?delete OY_CHANNEL_TOP[_][t]:e-OY_CHANNEL_TOP[_][t][1]>OY_CHANNEL_RECOVERTIME&&(OY_CHANNEL_TOP[_][t][1]=e,oy_data_route("OY_LOGIC_FOLLOW","OY_CHANNEL_RECOVER",[[],OY_CHANNEL_TOP[_][t][2],_,o,O,n,e]))};null===OY_CHANNEL_LISTEN[_][0]?O(null,null):oy_key_sign(OY_CHANNEL_LISTEN[_][0],e+_,function(e){O(e,OY_CHANNEL_LISTEN[_][1])})}for(let _ in OY_CHANNEL_LISTEN)null!==OY_CHANNEL_LISTEN[_][0]&&e-OY_CHANNEL_LISTEN[_][3]>OY_CHANNEL_KEEPTIME&&oy_channel_broadcast(_,"OY_CHANNEL_PING",OY_CHANNEL_LISTEN[_][0],OY_CHANNEL_LISTEN[_][1],function(){},function(){});for(let _ in OY_CHANNEL_ECHO)OY_CHANNEL_ECHO[_][0]<e&&(delete OY_CHANNEL_ECHO[_],oy_log("Cleaned up expired echo session with key: "+oy_short(_)));for(let _ in OY_CHANNEL_DYNAMIC)e-OY_CHANNEL_DYNAMIC[_]>OY_CHANNEL_ALLOWANCE&&(delete OY_CHANNEL_DYNAMIC[_],oy_log("Cleaned up expired channel allowance for public key: "+oy_short(_)));for(let _ in OY_LATENCY)e-OY_LATENCY[_][3]>OY_LATENCY_MAX&&(delete OY_LATENCY[_],oy_log("Cleaned up expired latency session for node: "+oy_short(_)));for(let _ in OY_PEERS_PRE)OY_PEERS_PRE[_]<e&&(delete OY_PEERS_PRE[_],oy_log("Cleaned up expired pre peer session for node: "+oy_short(_)));for(let _ in OY_PROPOSED)OY_PROPOSED[_][0]<e&&(delete OY_PROPOSED[_],oy_log("Cleaned up expired proposal session for node: "+oy_short(_)));for(let _ in OY_BLACKLIST)OY_BLACKLIST[_][1]<e&&(delete OY_BLACKLIST[_],oy_log("Cleaned up expired blacklist flag for node: "+oy_short(_)));oy_chrono(function(){oy_engine(_)},OY_ENGINE_INTERVAL)}function oy_init(_,e,o){if(localStorage.clear(),"function"==typeof o&&(console.log("Console redirected to custom function"),OY_CONSOLE=o),null==e)return 1===OY_INIT?(oy_log("Clashing instance of INIT prevented from running",1),!1):(OY_INIT=1,oy_log("Oyster Mesh initializing..."),document.addEventListener("oy_peers_null",oy_block_reset,!1),oy_key_gen(function(e,o){OY_SELF_PRIVATE=e,OY_SELF_SHORT=oy_short(OY_SELF_PUBLIC=o),OY_PROPOSED={},oy_log("Initiating new P2P session with new ID "+OY_SELF_SHORT),oy_init(_,!0)}),!0);(OY_DB=new Dexie("oy_db")).version(1).stores({oy_local:"oy_local_key",oy_data:"oy_data_key,oy_data_time",oy_channel:"oy_broadcast_hash,oy_channel_id"}),(OY_CONN=new Peer(OY_SELF_PUBLIC,{host:"top.oyster.org",port:8200,path:"/",secure:!0})).on("open",function(e){if(null===e)return!1;OY_READY=!0,oy_log("P2P connection ready with self ID "+oy_short(e)),"function"==typeof _&&_(),oy_local_get("oy_boost_expire",null,function(_){null!==_&&Date.now()/1e3<_?oy_local_get("oy_boost",[],function(_){OY_BOOST=_,_()}):oy_local_set("oy_boost",[])})},null),OY_CONN.on("connection",function(_){_.on("data",function(e){if(oy_node_blocked(_.peer))return oy_node_punish(_.peer,"OY_PUNISH_PEER_BLACKLIST"),!1;let o=oy_data_soak(_.peer,e);return!0===o||(!1===o?(oy_node_punish(_.peer,"OY_PUNISH_DATA_INVALID"),!1):void("OY_LATENCY_RESPONSE"===o[0]?oy_latency_response(_.peer,o[1]):oy_peer_check(_.peer)?(!1===oy_data_measure(!1,_.peer,e.length)&&(oy_log("Peer "+oy_short(_.peer)+" exceeded mesh flow compliance limits, will punish"),oy_node_punish(_.peer,"OY_PUNISH_MESH_FLOW")),oy_peer_process(_.peer,o[0],o[1])):("OY_BLOCK_SYNC"===o[0]||"OY_BLOCK_DIVE"===o[0])&&void 0!==OY_ORIGINS[_.peer]&&Date.now()/1e3<OY_ORIGINS[_.peer]?oy_peer_process(_.peer,o[0],o[1]):!1===oy_data_measure(!1,"oy_aggregate_node",e.length)?oy_log("Node "+oy_short(_.peer)+" pushed aggregate mesh flow compliance beyond limit"):oy_node_negotiate(_.peer,o[0],o[1])))})},null),OY_CONN.on("error",function(_){oy_log("PeerJS Error: "+_.type),"browser-incompatible"===_.type&&"function"==typeof OY_ERROR_BROWSER&&OY_ERROR_BROWSER()},null),oy_chrono(function(){!0===OY_READY?(oy_log("Connection is now ready, sparking engine"),oy_chrono(oy_engine,50),setTimeout(oy_block_loop,1)):(oy_log("Connection was not established before cutoff, re-sparking INIT"),OY_INIT=0,oy_init(_))},OY_READY_RETRY)}let oy_call_detect=document.getElementById("oy.js");if(oy_call_detect){let _=oy_call_detect.getAttribute("payout");oy_public_check(_)&&(OY_PASSIVE_MODE=!0,OY_BLOCK_DIVE_REWARD=_,oy_init(function(){console.log("Oyster is diving for address "+OY_BLOCK_DIVE_REWARD)}))}